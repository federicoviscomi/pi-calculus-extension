
\section{Syntax}

As we did whit $\pi$ calculus, we suppose that we have a countable set of names $\mathbf{N}$, ranged over by lower case letters $a,b, \cdots, z$. This names are used for communication channels and values. Furthermore we have a set of identifiers, ranged over by $A$. We represent the agents or processes by upper case letters $P,Q, \cdots $. A multi $\pi$ process, in addiction to the same actions of a $\pi$ process, can perform also a strong prefix input:
\begin{center}
  $\pi$ ::= $\overline{x}y$ | $x(z)$ | $\underline{x(y)}$ | $\tau$ 
\end{center}
The process are defined, just as original $\pi$ calculus, by the following grammar:
\begin{center}
  \begin{tabular}{l}
    $P,Q$ ::= $0$ | $\pi.P$ | $P|Q$ | $P+Q$ | $(\nu x) P$ | $A(y_{1}, \cdots, y_{n})$
  \end{tabular}
\end{center}
and they have the same intuitive meaning as for the $\pi$ calculus. The strong prefix input allows a process to make an atomic sequence of actions, so that more than one process can synchronize on this sequence. For the moment we allow the strong prefix to be on input names only. Also one can use the strong prefix only as an action prefixing for processes that can make at least a further action. 

Multi $\pi$ calculus is a conservative extension of the $\pi$ calculus in the sense that: any $\pi$ calculus process $p$ is also a multi $\pi$ calculus process and the semantic of $p$ according to the SOS rules of $\pi$ calculus is the same as the semantic of $p$ according to the SOS rules of multi $\pi$ calculus. 
We have to extend the following definition to deal with the strong prefix:
\begin{center}
  \begin{tabular}{ll}
	$B(\underline{x(y)}.Q, I) = \{y,\overline{y}\}\cup B(Q, I)$
      &
	$F(\underline{x(y)}.Q, I) = \{x,\overline{x}\}\cup (F(Q, I)-\{y,\overline{y}\})$
    \\
  \end{tabular}
\end{center}
The scope of the object of a strong input is the process that follows the strong input. For example the scope of a name $x$ in a process $\underline{y(x)}.x(b).P$ is $x(b).P$.

In this setting two process cannot synchronize on a sequence of actions with length greater than one so we cannot have transactional synchronization but we can have multi-party synchronization.




\section{Operational semantic}

\subsection{Early operational semantic with structural congruence}

The semantic of a multi $\pi$ process is labeled transition system such that
\begin{itemize}
  \item 
    the nodes are multi $\pi$ calculus process. The set of node is $\mathbf{P}_{m}$
  \item
    the actions are multi $\pi$ calculus actions. The set of actions is $\mathbf{A}_{m}$, we use $\alpha, \alpha_{1}, \alpha_{2},\cdots $ to range over the set of actions, we use $\sigma, \sigma_{1}, \sigma_{2}, \cdots $ to range over the set $\mathbf{A}_{m}^{+} \cup \{\tau\}$.
  \item
    the transition relations is $\rightarrow\subseteq \mathbf{P}_{m}\times (\mathbf{A}_{m}^{+} \cup \{\tau\})\times \mathbf{P}_{m}$
\end{itemize}

In this case, a label can be a sequence of prefixes, whether in the original $\pi$ calculus a label can be only a prefix. We use the symbol $\cdot$ to denote the concatenation operator.

\begin{definition}
  The \emph{early transition relation with structural congruence} is the smallest relation induced by the rules in table \ref{multipisoloinputearlywith} where $inpSeq$ is a non empty sequence of input actions and $\sigma$ is a sequence of any action.
  \begin{table}
    \begin{tabular}{lll}
	  \hline\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \xrightarrow{\overline{x}y} P
	  }$
	&
	  $\inferrule* [left=\bf{EInp}]{
	  }{
	    x(y).P \xrightarrow{xz} P\{z/y\}
	  }$
	&
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \xrightarrow{\tau} P
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{SInpTau}]{
	      P\{y/z\} \xrightarrow{\tau} P^{'}
	  }{
	    \underline{x(z)}.P \xrightarrow{xy} P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{SInp}]{
	      P\{y/z\} \xrightarrow{ab} P^{'}
% 	    \\
% 	      y\notin fn((\nu z) P)
	  }{
	    \underline{x(z)}.P \xrightarrow{xy \cdot ab} P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{SInpSeq}]{
	      P\{y/z\} \xrightarrow{\sigma} P^{'}
	    \\
	      |\sigma|>1
% 	    \\
% 	      y\notin fn((\nu z) P)
	  }{
	    \underline{x(z)}.P \xrightarrow{xy \cdot \sigma} P^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Sum}]{
	    P \xrightarrow{\sigma} P^{'}
	  }{
	    P+Q \xrightarrow{\sigma} P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{Cong}]{
	      P\equiv P^{'}
	    \\
	      P^{'} \xrightarrow{\alpha} Q
	  }{
	      P \xrightarrow{\alpha} Q
	  }$
	&
	  $\inferrule* [left=\bf{Res}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      z\notin n(\sigma)
	  }{
	    (\nu z) P \xrightarrow{\sigma} (\nu z) P^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{Par}]{
	      P \xrightarrow{\sigma} P^{'}
	  }{
	      P|Q \xrightarrow{\sigma} P^{'}|Q
	  }$
	&
	  $\inferrule* [left=\bf{Opn}]{
	      P \xrightarrow{\overline{x}z} P^{'}
	    \\ 
	      z\neq x
	  }{
	      (\nu z)P \xrightarrow{\overline{x}(z)} P^{'}
	  }$
      \\\\
	  $\inferrule* [left=\bf{ECom}]{
	      P \xrightarrow{xy} P^{'}
	    \\
	      Q \xrightarrow{\overline{x}y} Q^{'}
	  }{
	    P|Q \xrightarrow{\tau} P^{'}|Q^{'}
	  }$
	&
	  $\inferrule* [left=\bf{EComSeq}]{
	      P \xrightarrow{xy\cdot \sigma} P^{'}
	    \\
	      Q \xrightarrow{\overline{x}y} Q^{'}
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q^{'}
	  }$
      \\\\\hline
    \end{tabular}
    \caption{Multi $\pi$ early semantic with structural congruence}
    \label{multipisoloinputearlywith}
  \end{table}
\end{definition}



\begin{example}Multi-party synchronization
  We show an example of a derivation of three processes that synchronize.

  \begin{center}
  $\inferrule* [left=\bf{EComSeq}]{
      \inferrule* [left=\bf{SInp}]{
	\inferrule* [left=\bf{EInp}]{
	}{
	  (x(b).P)\{y/a\} 
	    \xrightarrow{xz} 
	      P\{y/a\}\{z/b\}
	}
      }{
	\underline{x(a)}.(x(b).P) 
	  \xrightarrow{xy \cdot xz} 
	    P\{y/a\}\{z/b\}
      }
    \\
      \inferrule* [left=\bf{Out}]{
      }{
	\overline{x}y.Q 
	  \xrightarrow{\overline{x}y} 
	    Q
      }
  }{
	\underline{x(a)}.x(b).P|\overline{x}y.Q
	  \xrightarrow{xz}
	    P\{y/a\}\{z/b\}|Q
  }$
  \end{center}


  \begin{center}
  $
      \inferrule* [left=\bf{EComSng}]{
	\underline{x(a)}.x(b).P|\overline{x}y.Q
	  \xrightarrow{xz}
	    P\{y/a\}\{z/b\}|Q
	\\
	  \inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}z.R	
	      \xrightarrow{\overline{x}z} 
		R
	  }
      }{
	(\underline{x(a)}.x(b).P|\overline{x}y.Q)|\overline{x}z.R
	  \xrightarrow{\tau}
	    (P\{y/a\}\{z/b\}|Q)|R
      }
  $
  \end{center}
 
\end{example}

\begin{lemma}\label{lemmastrongsequence}
  If $P\xrightarrow{\sigma} Q$ then only one of the following cases hold: 
  \begin{itemize}
    \item 
      $|\sigma|=1$
    \item
      $|\sigma|>1$, the actions in $\sigma$ are input.
  \end{itemize}
\end{lemma}



\subsection{Late operational semantic with structural congruence}

\begin{definition}
  The \emph{late transition relation with structural congruence} is the smallest relation induced by the rules in table \ref{multipisoloinputlatewith}.
  \begin{table}
    \begin{tabular}{lll}
	\multicolumn{3}{l}{\line(1,0){415}}
	\\\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \xrightarrow{\overline{x}y} P
	  }$
	&
	  $\inferrule* [left=\bf{LInp}]{
% 	    w \notin fn(x(y).P)
	  }{
% 	    x(y).P \xrightarrow{x(w)} P\{w/y\}
	    x(y).P \xrightarrow{x(y)} P
	  }$
	&
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \xrightarrow{\tau} P
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{SInp}]{
	      P \xrightarrow{\gamma} P^{'}
% 	    \\
% 	      y\notin fn((\nu z) P)
	  }{
	    \underline{x(z)}.P \xrightarrow{x(z) \cdot \gamma} P^{'}
	  }$
	&
	  $\gamma$ is a non empty sequence of inputs
      \\
      \end{tabular}
	\\
      \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{LComSeq}]{
	      P \xrightarrow{x(y)\cdot \sigma} P^{'}
	    \\
	      Q\xrightarrow{\overline{x}z} Q^{'}
  	    \\
   	      bn(\sigma)\cap fn(Q) = \emptyset
	  }{
	    P|Q \xrightarrow{\sigma\{z/y\}} P^{'}\{z/y\}|Q^{'}
	  }$
	&
	  $\inferrule* [left=\bf{LCom}]{
	      P \xrightarrow{x(y)} P^{'}
	    \\
	      Q\xrightarrow{\overline{x}z} Q^{'}
% 	    \\
% 	      z\notin fn(P)
	  }{
	    P|Q \xrightarrow{\tau} P^{'}\{z/y\}|Q^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Sum}]{
	    P \xrightarrow{\sigma} P^{'}
	  }{
	    P+Q \xrightarrow{\sigma} P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{Cong}]{
	      P\equiv P^{'}
	    \\
	      P^{'} \xrightarrow{\sigma} Q
	  }{
	      P \xrightarrow{\sigma} Q
	  }$
	&
	  $\inferrule* [left=\bf{Opn}]{
	      P \xrightarrow{\overline{x}z} P^{'}
	    \\ 
	      z\neq x
	  }{
	      (\nu z)P \xrightarrow{\overline{x}(z)} P^{'}
	  }$
      \\\\
	  $\inferrule* [left=\bf{Res}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      z\notin n(\alpha)
	  }{
	    (\nu z) P \xrightarrow{\sigma} (\nu z) P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{Par}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      bn(\sigma)\cap fn(Q)=\emptyset
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q
	  }$
	&
	\\\\\multicolumn{3}{l}{\line(1,0){415}}
    \end{tabular}
    \caption{Multi $\pi$ late semantic with structural congruence}
    \label{multipisoloinputlatewith}
  \end{table}
\end{definition}

\begin{example}Multi-party synchronization
  We show an example of a derivation of three processes that synchronize with the late semantic. The three processes are $\underline{x(a)}.x(b).P$, $\overline{x}y.Q$ and $\overline{x}z.R$. We assume modulo $\alpha$ conversion that:
  \begin{center}
      $a\notin fn(x(b))\cup fn (\underline{x(a)}.x(b).P)$
  \end{center}
  and
  \begin{center}
      $c\notin fn(\overline{x}y.Q)$
  \end{center}

   \begin{center}
  $\inferrule* [left=\bf{LComSeq}]{
      \inferrule* [left=\bf{SInp}]{
	\inferrule* [left=\bf{LInp}]{
	}{
	  x(b).P \xrightarrow{x(b)} P
	}
      }{
	\underline{x(a)}.x(b).P
	  \xrightarrow{x(a) \cdot x(b)} 
	    P
      }
    \\
      \inferrule* [left=\bf{Out}]{
      }{
	\overline{x}y.Q \xrightarrow{\overline{x}y} Q
      }
  }{
	\underline{x(a)}.x(b).P|\overline{x}y.Q
	  \xrightarrow{x(b)}
	    P\{y/a\}|Q
  }$
  \end{center}

  \begin{center}
  $
      \inferrule* [left=\bf{LCom}]{
	\underline{x(a)}.x(b).P|\overline{x}y.Q
	  \xrightarrow{x(b)}
	    P\{y/a\}|Q
	\\
	  \inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}z.R	
	      \xrightarrow{\overline{x}z} 
		R
	  }
      }{
	(\underline{x(a)}.x(b).P|\overline{x}y.Q)|\overline{x}z.R
	  \xrightarrow{\tau}
	    (P\{y/a\}|Q)\{z/b\}|R=(P\{y/a\}\{z/b\}|Q)|R
      }
  $
  \end{center}


\end{example}



\subsection{Low level semantic}
This section contains the definition of an alternative semantic for multi $\pi$. First we define a low level version of the multi $\pi$ calculus(here with strong prefixing on input only), we call this language low multi $\pi$. The low multi $\pi$ is the multi $\pi$ enriched with a marked or intermediate process $*P$:
\begin{center}
   \begin{tabular}{l}
     $P,Q$ ::= $0$ | $\pi.P$ | $P|Q$ | $P+Q$ | $(\nu x) P$ | $A$ | $*P$
   \\\\
     $\pi$ ::= $\overline{x}y$ | $x(y)$ | $\underline{x(y)}$ | $\tau$ 
   \end{tabular}
\end{center}
\begin{definition}
  The low level transition relation is the smallest relation induced by the rules in table \ref{lowleveltransitionrelationinput} in which $P$ stands for a process without mark, $L$ stands for a process with mark and $S$ can stand for both. 
  \begin{table}
    \begin{tabular}{lll}
      \hline\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \stackrel{\overline{x}y}{\longmapsto} P
	  }$
	  &
	  $\inferrule* [left=\bf{EInp}]{
	  }{
	    x(y).P \stackrel{xz}{\longmapsto} P\{z/y\}
	  }$
	  &
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \stackrel{\tau}{\longmapsto} P
	  }$
      \\\\
	  $\inferrule* [left=\bf{StarInp}]{
	      P \stackrel{xy}{\longmapsto} S^{'}
	  }{
	      *P \stackrel{xy}{\longmapsto} S^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{SInpLow}]{
%	      y\notin fn(P)-\{z\}
	  }{
	    \underline{x(z)}.P \stackrel{xy}{\longmapsto} * P\{y/z\}
	  }$
	  &
	  $\inferrule* [left=\bf{StarEps}]{
	      P \stackrel{\epsilon}{\longmapsto} S^{'}
	  }{
	      *P \stackrel{\epsilon}{\longmapsto} S^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Com1}]{
	      P \stackrel{\overline{x}y}{\longmapsto} P^{'}
	    \\
	      Q \stackrel{xy}{\longmapsto} Q^{'}
	  }{
	    P|Q \stackrel{\tau}{\longmapsto} P^{'}|Q^{'}
	  }$
	  &
	  &
      \\\\
	  $\inferrule* [left=\bf{Com2L}]{
	      L_{1} \stackrel{xy}{\longmapsto} L_{2}
	    \\
	      P \stackrel{\overline{x}y}{\longmapsto} Q
	  }{
	    L_{1}|P \stackrel{\epsilon}{\longmapsto} L_{2}|Q
	  }$
	&
	  $\inferrule* [left=\bf{Com2R}]{
	      P \stackrel{\overline{x}y}{\longmapsto} Q
	    \\
	      L_{1} \stackrel{xy}{\longmapsto} L_{2}
	  }{
	    P|L_{1} \stackrel{\epsilon}{\longmapsto} Q|L_{2}
	  }$
	  &
      \\\\
	  $\inferrule* [left=\bf{Com3L}]{
	      P \stackrel{xy}{\longmapsto} L
	    \\
	      Q \stackrel{\overline{x}y}{\longmapsto} Q^{'}
	  }{
	    P|Q \stackrel{\epsilon}{\longmapsto} L|Q^{'}
	  }$
	&
	  $\inferrule* [left=\bf{Com3R}]{
	      Q \stackrel{\overline{x}y}{\longmapsto} Q^{'}	      
	    \\
	      P \stackrel{xy}{\longmapsto} L
	  }{
	    Q|P \stackrel{\epsilon}{\longmapsto} Q^{'}|L
	  }$
	  &
      \\\\
	  $\inferrule* [left=\bf{Com4L}]{
	      L \stackrel{xy}{\longmapsto} P
	    \\
	      Q \stackrel{\overline{x}y}{\longmapsto} Q^{'}
	  }{
	    L|Q \stackrel{\tau}{\longmapsto} P|Q^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Com4R}]{
	      Q \stackrel{\overline{x}y}{\longmapsto} Q^{'}
	    \\
	      L \stackrel{xy}{\longmapsto} P
	  }{
	    L|Q \stackrel{\tau}{\longmapsto} P|Q^{'}
	  }$
	  &
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Res}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
	    \\
	      y\notin n(\gamma)
	  }{
	    (\nu y) S \stackrel{\gamma}{\longmapsto} (\nu y) S^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Opn}]{
	      P \stackrel{\overline{x}y}{\longmapsto} Q
	    \\ 
	      y\neq x
	  }{
	      (\nu y)P \stackrel{\overline{x}(y)}{\longmapsto} Q
	  }$
	  &
	  $\inferrule* [left=\bf{Cong}]{
	      P\equiv P^{'}
	    \\
	      P^{'} \stackrel{\gamma}{\longmapsto} S
	  }{
	      P \stackrel{\gamma}{\longmapsto} S
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Par1L}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
% 	    \\ 
% 	      bn(\gamma)\cap fn(Q)=\emptyset
	  }{
	      S|Q \stackrel{\gamma}{\longmapsto} S^{'}|Q
	  }$
	&
	  $\inferrule* [left=\bf{Par1R}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
% 	    \\ 
% 	      bn(\gamma)\cap fn(Q)=\emptyset
	  }{
	      Q|S \stackrel{\gamma}{\longmapsto} Q|S^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Sum}]{
	    P \stackrel{\gamma}{\longmapsto} S
	  }{
	    P+Q \stackrel{\gamma}{\longmapsto} S
	  }$

      \\\\\hline
    \end{tabular}
    \caption{Low multi $\pi$ early semantic with structural congruence}
    \label{lowleveltransitionrelationinput}
  \end{table}
\end{definition}



\begin{lemma}\label{multiinpconstraintswithmarked}
  For all unmarked processes $P,Q$ and marked processes $L_{1}, L_{2}$.
  \begin{itemize}
    \item
      if $P\stackrel{\alpha}{\longmapsto}L_{1}$ or $L_{1}\stackrel{\alpha}{\longmapsto}L_{2}$ then $\alpha$ can only be an input or an $\epsilon$
    \item
      if $L_{1}\stackrel{\alpha}{\longmapsto}P$ then $\alpha$ is an input or a $\tau$
    \item
      if $P\stackrel{\alpha}{\longmapsto}Q$ then $\alpha$ is not an $\epsilon$
  \end{itemize}
\end{lemma}


  
\begin{definition}\label{low}
  Let $P, Q$ be unmarked processes and $L_{1}, \cdots, L_{k-1}$ marked processes. We define the derivation relation $\rightarrow_{s}$ in the following way:
  \begin{center}
    $\inferrule* [left=\bf{Low}]{
	P \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} Q
      \\
	k\geq 1
    }{
      P \xrightarrow{\gamma_{1} \cdots \gamma_{k}}_{s}  Q
    }$
  \end{center}
  We need to be precise about the concatenation operator $\cdot$ since we have introduced the new label $\epsilon$. Let $a$ be an action such that $a\neq \tau$ and $a\neq \epsilon$ then the following rules hold:
  \begin{center}
      \begin{tabular}{lll}
	  $\epsilon \cdot a = a \cdot \epsilon = a$
	&
	  $\epsilon \cdot \epsilon = \epsilon$
	&
	  $\tau \cdot \epsilon = \epsilon \cdot \tau = \tau$
	\\
	  $\tau \cdot a = a \cdot \tau = a$
	&
	  $\tau \cdot \tau = \tau$
	&
      \end{tabular}
  \end{center}
\end{definition}

\begin{example}Multi-party synchronization
  We show an example of a derivation of three processes that synchronize.
 
  \begin{center}$
    \inferrule* [left=\bf{Par1L}]{
      \inferrule* [left=\bf{Com3L}]{
	\inferrule* [left=\bf{SInpLow}]{
	}{
	  \underline{x(a)}.x(b).P
	    \stackrel{xy}{\longmapsto}
	      *(x(b).P\{y/a\})
	}
      \\
	\inferrule* [left=\bf{Out}]{
	}{
	  \overline{x}y.Q \stackrel{\overline{x}y}{\longmapsto} Q
	}
      }{
	\underline{x(a)}.x(b).P|\overline{x}y.Q
	  \stackrel{\epsilon}{\longmapsto}
	    *(x(b).P\{y/a\})|Q
      }
  }{
	(\underline{x(a)}.x(b).P|\overline{x}y.Q) | \overline{x}z.R
	  \stackrel{\epsilon}{\longmapsto}
	    (*(x(b).P\{y/a\})|Q)|\overline{x}z.R
  }
  $\end{center}

  \begin{center}$
    \inferrule* [left=\bf{Par1L}]{
      \inferrule*[left=\bf{Star}]{
	\inferrule* [left=\bf{EInp}]{
	}{
	  x(b).P\{y/a\} \stackrel{xz}{\longmapsto} P\{y/a\}\{z/b\}
	}
      }{
	*(x(b).P\{y/a\}) \stackrel{xz}{\longmapsto} P\{y/a\}\{z/b\}      
      }
    }{
      *(x(b).P\{y/a\}) | Q \stackrel{xz}{\longmapsto} P\{y/a\}\{z/b\} | Q
    }
  $\end{center}

  \begin{center}$
    \inferrule* [left=\bf{Com4L}]{
      *(x(b).P\{y/a\}) | Q \stackrel{xz}{\longmapsto} P\{y/a\}\{z/b\} | Q
    \\
      \inferrule* [left=\bf{Out}]{
      }{
	\overline{x}z.R	
	  \stackrel{\overline{x}z}{\longmapsto}
	    R
      }
    }{
	(\underline{x(a)}.x(b).P|\overline{x}y.Q)|\overline{x}z.R
	  \stackrel{\tau}{\longmapsto}
	    (P\{y/a\}\{z/b\}|Q)|R
    }
  $\end{center}

\end{example}










\begin{proposition}\label{equivalencehightolowinput}
  Let $\rightarrow$ be the relation defined in table \ref{multipisoloinputearlywith}. If $P\xrightarrow{\sigma} Q$ then there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
  \begin{center}
    \begin{tabular}{lll}
      $P \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
    &
      and
    &
      $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \sigma$  
    \end{tabular}
  \end{center}
  \begin{proof}
    The proof is by induction on the depth of the derivation tree of $P\xrightarrow{\sigma} Q$:
    \begin{description}
      \item[base case]
    \end{description}
	If the depth is one then the rule used have to be one of: $EInp$, $Out$, $Tau$. These rules are also in table \ref{lowleveltransitionrelationinput} so we can derive $P \stackrel{\sigma}{\longmapsto}Q$.
    \begin{description}
      \item[inductive case]
    \end{description}
	If the depth is greater than one then the last rule used in the derivation can be:
	\begin{description}
	  \item[$SInpSeq$]
	    the last part of the derivation tree looks like this:
	    \begin{center}
	      $\inferrule* [left=\bf{SInpSeq}]{
		  P_{1}\{y/z\} \xrightarrow{\sigma} Q
		\\
		  |\sigma|>1
	      }{
		\underline{x(z)}.P_{1} \xrightarrow{xy \cdot \sigma} Q
	      }$	      
	    \end{center}
	    for inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	    \begin{center}
	      \begin{tabular}{lll}
		$P_{1}\{y/z\} \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	      &
		and
	      &
		$\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \sigma$
	      \end{tabular}
	    \end{center}
	    then a proof of the conclusion follows from:
	    \begin{center}
	      \begin{tabular}{ll}
		$\inferrule* [left=\bf{SInpLow}]{
 		}{
 		  \underline{x(z)}.P_{1} \stackrel{xy}{\longmapsto} *P_{1}\{y/z\}
 		}$
	      &
		$\inferrule* [left=\bf{Star}]{
 		  P_{1}\{y/z\} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
 		}{
 		  *P_{1}\{y/z\} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
 		}$
	      \end{tabular}
	    \end{center}
	    where $Star$ means $StarInp$ or $StarEps$, note that $\gamma_{1}$ is an input or an $epsilon$ because of \ref{lemmastrongsequence}.
	  \item[$SInp$] this case is similar to the previous.
	  \item[$SInpTau$] this case is similar to the previous observing that $xy \cdot \tau = xy$.
	  \item[$Sum$]
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{Sum}]{
	    P_{1} \xrightarrow{\sigma} Q
	  }{
	    P_{1}+P_{2} \xrightarrow{\sigma} Q
	  }$
	\end{center}
	for the inductive hypothesis there exist $L_{1}$, $\cdots$, $L_{k}$ and $\gamma_{1}$, $\cdots$, $\gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \sigma$  
	  \end{tabular}
	\end{center}
	A proof of the conclusion is:
	\begin{center}
	  $\inferrule* [left=\bf{Sum}]{
	      P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	    }{
	      P_{1}+P_{2} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	    }
	  $
	\end{center}
      \item[$Cong$] this case is similar to the previous.
      \item[$ECom$] 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{ECom}]{
	      P_{1} \xrightarrow{xy} P_{1}^{'}
	    \\
	      Q_{1} \xrightarrow{\overline{x}y} Q_{1}^{'}
	  }{
	    P_{1}|Q_{1} \xrightarrow{\tau} P_{1}^{'}|Q_{1}^{'}
	  }$
	\end{center}
	for inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = xy$
	  \end{tabular}
	\end{center}
	and there exist $R_{1}, \cdots, R_{h}$ and $\delta_{1}, \cdots, \delta_{h+1}$ with $h\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $Q_{1} \stackrel{\delta_{1}}{\longmapsto} R_{1}  \stackrel{\delta_{2}}{\longmapsto} R_{2} \cdots R_{h-1} \stackrel{\delta_{h}}{\longmapsto} R_{h} \stackrel{\delta_{h+1}}{\longmapsto} Q_{1}^{'}$ 
	  &
	    and
	  &
	    $\delta_{1} \cdot \ldots \cdot \delta_{h+1} = \overline{x}y$
	  \end{tabular}
	\end{center}
	For lemma \ref{multiinpconstraintswithmarked} there cannot be an output action in a transition involving marked processes so $h$ must be $0$ and $Q_{1} \stackrel{\delta_{1}}{\longmapsto} Q_{1}^{'}$ with $\delta_{1}=\overline{x}y$. We can have three different cases now: 
	\begin{description}
	  \item[$\gamma_{1}=xy$]
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1}^{'}
			      \stackrel{\epsilon}{\longmapsto} L_{2}|Q_{1}^{'}
		  \cdots
				\stackrel{\epsilon}{\longmapsto} L_{k}|Q_{1}^{'}
				\stackrel{\tau}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the first transition with rule $Com3L$, whether for the other transition we use the rule $Par1L$.
	  \item[$\gamma_{i}=xy$]
	    A proof of the conclusion is:
	    \begin{center}
	      $
		  P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1} 
		  \cdots
			      \stackrel{\epsilon}{\longmapsto} L_{i-1}|Q_{1} 
			      \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}
			      \stackrel{\epsilon}{\longmapsto} L_{i+1}|Q_{1}^{'}
		  \cdots 
			      \stackrel{\epsilon}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\tau}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the transaction $ L_{i-1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}$ with rule $Com2L$, whether for the other transactions  we use the rule $Par1L$.
	  \item[$\gamma_{k+1}=xy$] similar.
	\end{description}
      \item[$Res$]
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{Res}]{
	      P_{1} \xrightarrow{\sigma} Q_{1}
	    \\
	      z\notin n(\sigma)
	  }{
	    (\nu z) P_{1} \xrightarrow{\sigma} (\nu z) Q_{1}
	  }$
	\end{center}
	for the inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q_{1}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$
	  \end{tabular}
	\end{center}
	We can apply the rule $Res$ to each of the previous transitions because 
	\begin{center}
	  $z\notin n(\sigma)$ implies $z\notin n(\gamma_{i})$ for each $i$
	\end{center}
	and then get a proof of the conclusion:
	\begin{center}
	  $(\nu z)P_{1} \stackrel{\gamma_{1}}{\longmapsto} (\nu z)L_{1}  \stackrel{\gamma_{2}}{\longmapsto} (\nu z)L_{2} \cdots (\nu z)L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} (\nu z)L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} (\nu z)Q_{1}$
	\end{center}
      \item[$Par$] this case is similar to the previous.
      \item[$EComSeq$] 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{EComSeq}]{
	      P_{1} \xrightarrow{xy \cdot \sigma} P_{1}^{'}
	    \\
	      Q_{1} \xrightarrow{\overline{x}y} Q_{1}^{'}
	  }{
	    P_{1}|Q_{1} \xrightarrow{\sigma} P_{1}^{'}|Q_{1}^{'}
	  }$
	\end{center}
	for inductive hypothesis there exist $L_{1}$, $\cdots$, $L_{k}$ and $\gamma_{1}$, $\cdots$, $\gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = xy \cdot \sigma$  
	  \end{tabular}
	\end{center}
	For inductive hypothesis and lemma \ref{multiinpconstraintswithmarked} $Q_{1} \stackrel{\overline{x}y}{\longmapsto} Q_{1}^{'}$. We can have two different cases now depending on where the first $xy$ is:
	\begin{description}
	  \item[$\gamma_{1}=xy$]
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1}^{'}
			      \stackrel{\gamma_{2}}{\longmapsto} L_{2}|Q_{1}^{'}
		  \cdots
			      \stackrel{\gamma_{k}}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the first transition with rule $Com3L$, whether for the other transactions we use the rule $Par1L$. Since $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = xy \cdot \sigma$ and $\gamma_{1}=xy$ then $\epsilon \cdot \gamma_{2}\cdot \ldots \cdot \gamma_{k+1}=\sigma$
	  \item[$\gamma_{i}=xy$]
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1} 
		  \cdots
			      \stackrel{\epsilon}{\longmapsto} L_{i-1}|Q_{1} 
			      \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}
			      \stackrel{\gamma_{i+1}}{\longmapsto} L_{i+1}|Q_{1}^{'}
		  \cdots 
			      \stackrel{\gamma_{k}}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the transition $ L_{i-1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}$ with rule $Com2L$, whether for the other transactions of the premises we use the rule $Par1L$.
	  \item[$\gamma_{k+1}=xy$] cannot happen because $\sigma$ is not empty.
	\end{description}
    \end{description}
  \end{proof}
\end{proposition}






\begin{proposition}
  Let $\rightarrow$ be the relation defined in table \ref{multipisoloinputearlywith}. Let $\alpha$ be an action. If $P \stackrel{\alpha}{\longmapsto} Q$ then $P\xrightarrow{\alpha} Q$.
  \begin{proof}
    The proof is by induction the depth of the derivation of $P \stackrel{\alpha}{\longmapsto} Q$:
    \begin{description}
      \item[base case]
	in this case the derivation of this transition has depth one. The last(and only) rule used can be: $Out$, $EInp$ or $Tau$; these rules are also in table \ref{multipisoloinputearlywith} so we can derive $P\xrightarrow{\alpha} Q$. 
      \item[inductive case]
	in this case the last rule in the derivation can be: $Sum$, $Com1$, $Res$, $Par1L$, $Par1R$, $Cong$, $Opn$:
	\begin{description}
	  \item[$Com1$]\hfill \\
	    \begin{center}
	      $\inferrule* [left=\bf{Com1}]{
		  P_{1} \stackrel{xy}{\longmapsto} Q_{1}
		\\
		  P_{2} \stackrel{\overline{x}y}{\longmapsto} Q_{2}
	      }{
		P_{1}|P_{2} \stackrel{\tau}{\longmapsto} Q_{1}|Q_{2}
	      }$ 
	    \end{center}
	    for inductive hypothesis $P_{1} \xrightarrow{xy} Q_{1}$ and $P_{2} \xrightarrow{\overline{x}y} Q_{2}$ so for rule $Com$ $P_{1}|P_{2} \xrightarrow{\tau} Q_{1}|Q_{2}$
	  \item[$Sum$]\hfill \\
	    \begin{center}
	      $\inferrule* [left=\bf{Sum}]{
		P_{1} \stackrel{\alpha}{\longmapsto} Q
	      }{
		P_{1}+P_{2} \stackrel{\alpha}{\longmapsto} Q
	      }$ 
	    \end{center}
	    for inductive hypothesis $P_{1} \xrightarrow{\alpha} Q$ and for rule $Sum$ $P_{1}+P_{2} \xrightarrow{\alpha} Q$.
	  \item[$Res$] the first transition is:
	    \begin{center}
	      $\inferrule* [left=\bf{Res}]{
		  P_{1} \stackrel{\alpha}{\longmapsto} Q_{1}
		\\
		  z\notin n(\gamma_{1})
	      }{
		(\nu z) P_{1} \stackrel{\alpha}{\longmapsto} (\nu z)Q_{1}
	      }$ 
	    \end{center}		
	    for inductive hypothesis $P_{1} \xrightarrow{\alpha} Q_{1}$ and for rule $Res$ $(\nu z)P_{1} \xrightarrow{\alpha} (\nu z)Q_{1}$.
	 \item[$others$] other cases are similar.
      \end{description}	    
    \end{description}	    
  \end{proof}
\end{proposition}


% \subsection{Late operational semantic without structural congruence}
% 
% \begin{definition}
%   The \emph{late transition relation without structural congruence} is the smallest relation induced by the rules in table \ref{multipisoloinputlatewithout}.
%   \begin{table}
%     \begin{tabular}{lll}
% 	\hline\\
%      	  $\inferrule* [left=\bf{Out}]{
% 	  }{
% 	    \overline{x}y.P \xrightarrow{\overline{x}y} P
% 	  }$
% 	&
%      	  $\inferrule* [left=\bf{LInp}]{
% 	    w \notin (fn(P)-\{z\})
% 	  }{
% 	    x(z).P \xrightarrow{x(w)} P\{w/z\}
% 	  }$
% 	&
%      	  $\inferrule* [left=\bf{Tau}]{
% 	  }{
% 	    \tau.P \xrightarrow{\tau} P
% 	  }$
%       \\
%     \end{tabular}
%     \\
%     \begin{tabular}{ll}
%       \\
% 	  $\inferrule* [left=\bf{SInp}]{
% 	      P\{w/z\} \xrightarrow{\sigma} P^{'}
% 	    \\
% 	      w \notin (fn(P)-\{z\})
% 	  }{
% 	    \underline{x(y)}.P \xrightarrow{x(w) \cdot \sigma} P^{'}
% 	  }$
% 	&
% 	  $\sigma$ is a non empty sequence of inputs
%       \\
%     \end{tabular}
%     \\
%     \begin{tabular}{ll}
%       \\
% 	  $\inferrule* [left=\bf{LComSeq}]{
% 	      P \xrightarrow{x(y)\cdot \sigma} P^{'}
% 	    \\
% 	      Q\xrightarrow{\overline{x}z} Q^{'}
% 	    \\
% 	      bn(\sigma)\cap fn(Q)=\emptyset
% 	  }{
% 	    P|Q \xrightarrow{\sigma\{z/y\}} P^{'}\{z/y\}|Q^{'}
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{LCom}]{
% 	      P \xrightarrow{x(y)} P^{'}
% 	    \\
% 	      Q\xrightarrow{\overline{x}z} Q^{'}
% 	  }{
% 	    P|Q \xrightarrow{\tau} P^{'}\{z/y\}|Q^{'}
% 	  }$
%       \\
%     \end{tabular}
%     \\
%     \begin{tabular}{ll}
%       \\
% 	  $\inferrule* [left=\bf{Sum}]{
% 	    P \xrightarrow{\sigma} P^{'}
% 	  }{
% 	    P+Q \xrightarrow{\sigma} P^{'}
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{Opn}]{
% 	      P \xrightarrow{\overline{x}z} P^{'}
% 	    \\ 
% 	      z\neq x
% 	    \\
% 	      w\notin fn(P^{'}-\{y\})
% 	  }{
% 	      (\nu z)P \xrightarrow{\overline{x}(z)} P^{'}\{z/w\}
% 	  }$
%       \\\\
% 	  $\inferrule* [left=\bf{Res}]{
% 	      P \xrightarrow{\sigma} P^{'}
% 	    \\
% 	      z\notin n(\alpha)
% 	  }{
% 	    (\nu z) P \xrightarrow{\sigma} (\nu z) P^{'}
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{Par}]{
% 	      P \xrightarrow{\sigma} P^{'}
% 	    \\
% 	      bn(\sigma)\cap fn(Q)=\emptyset
% 	  }{
% 	    P|Q \xrightarrow{\sigma} P^{'}|Q
% 	  }$
%       \\
%     \end{tabular}
%     \\
%     \begin{tabular}{ll}
%       \\
% 	  $\inferrule* [left=\bf{Close}]{
% 	      P \xrightarrow{x(w)} P^{'}
% 	    \\
% 	      Q \xrightarrow{\overline{x}(w)} Q^{'}
% 	  }{
% 	      P|Q \xrightarrow{\tau} (\nu w)(P^{'}|Q^{'})
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{CloseSeq}]{
% 	      P \xrightarrow{x(w) \cdot \sigma} P^{'}
% 	    \\
% 	      Q \xrightarrow{\overline{x}(w)} Q^{'}
% 	  }{
% 	      P|Q \xrightarrow{\sigma} (\nu w)(P^{'}|Q^{'})
% 	  }$
%       \\\\\hline
%     \end{tabular}
%     \caption{Multi $\pi$ late semantic without structural congruence}
%     \label{multipisoloinputlatewithout}
%   \end{table}
% \end{definition}
% 
% \begin{example}Multi-party synchronization
%   We show an example of a derivation of three processes that synchronize with the late semantic. The three processes are $\underline{x(a)}.x(b).P$, $\overline{x}y.Q$ and $\overline{x}z.R$. We assume that:
%   \begin{center}
%       $b\notin fn(\underline{x(a)}.x(b).P|\overline{x}y.Q)$
%   \end{center}
% 
%   \begin{center}
%   $
%       \inferrule* [left=\bf{LCom}]{
% 	\underline{x(a)}.x(b).P|\overline{x}y.Q
% 	  \xrightarrow{x(b)}
% 	    P\{y/a\}|Q
% 	\\
% 	  \inferrule* [left=\bf{Out}]{
% 	  }{
% 	    \overline{x}z.R	
% 	      \xrightarrow{\overline{x}z} 
% 		R
% 	  }
%       }{
% 	(\underline{x(a)}.x(b).P|\overline{x}y.Q)|\overline{x}z.R
% 	  \xrightarrow{\tau}
% 	    (P\{y/a\}|Q)\{z/b\}|R
%       }
%   $
%   \end{center}
%   
%   \begin{center}
%   $\inferrule* [left=\bf{LComSeq}]{
%       \inferrule* [left=\bf{SLInp}]{
% 	\inferrule* [left=\bf{LInp}]{
% 	}{
% 	  x(b).P \xrightarrow{x(b)} P
% 	}
%       }{
% 	\underline{x(a)}.x(b).P
% 	  \xrightarrow{x(a) \cdot x(b)} 
% 	    P
%       }
%     \\
%       \inferrule* [left=\bf{Out}]{
%       }{
% 	\overline{x}y.Q 
% 	  \xrightarrow{\overline{x}y} 
% 	    Q
%       }
%   }{
%     \underline{x(a)}.x(b).P
%       | \overline{x}y.Q
%     \xrightarrow{x(b)}
% 	    P\{y/a\}|Q
%   }$
%   \end{center}
% 
% \end{example}
% 
% 
% In the following example we assume that all bound variables have different names.
% 
% 
% \begin{example} Scope intrusion without strong prefixing.
%   \begin{center}
%     $\overline{y}x.P|(\nu x)(y(z).Q) \xrightarrow{\tau} P|(\nu w)(Q\{w/x\}\{x/z\})$
%   \end{center}
%   This cannot be proved without explicit $\alpha$ conversion.
% \end{example}
% 
% \begin{example} Scope intrusion with strong prefixing.
%   \begin{center}
%     $(\nu x)(\nu b)\underline{y(z)}.a(c).P
%       | y(x).Q
%       | a(b).R
%     \xrightarrow{\tau} 
%       ((\nu x^{'})(\nu b^{'})P\{x^{'}/x\}\{x/z\}
% 	|Q)\{b^{'}/b\}\{b/c\} 
% 	| R$
%   \end{center}
%   This cannot be proved without explicit $\alpha$ conversion.
% \end{example}
% 
% \begin{example} Scope extrusion without strong prefixing.
%   $x\notin fn(Q)$  
%   \begin{center}
%   $\inferrule* [left=\bf{Cls}]{
%       \inferrule* [left=\bf{Opn}]{
% 	\inferrule* [left=\bf{Out}]{
% 	}{
% 	  \overline{y}x.P
% 	  \xrightarrow{\overline{y}x} 
% 	    P
% 	}
%       }{
% 	(\nu x)
% 	  (\overline{y}x.P)
% 	  \xrightarrow{\overline{y}(x)} 
% 	    P
%       }
%     \\
%       \inferrule* [left=\bf{LInp}]{
%       }{
% 	y(z).Q
% 	  \xrightarrow{y(x)} 
% 	    Q\{x/z\}
%       }
%   }{
%     (\nu x)
%       (\overline{y}x.P)
%       | y(z).Q 
%     \xrightarrow{\tau} 
%       (\nu x)
%       (	  
% 	P
%       | 
% 	Q\{x/z\}
%       )
%   }$
%   \end{center}
% \end{example}
% 
% \begin{example} Scope extrusion with strong prefixing.
%   \begin{center}
%     $\underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
%       | (\nu z_{1})\overline{y}z_{1}.Q 
%       | \overline{a}b.R
%       | (\nu z_{2})\overline{y}z_{2}.S
%     \xrightarrow{\tau} 
%       (\nu z_{2})(
%  	  (\nu z_{1})(
%  	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
%  	    | Q
%  	  )
%  	  | R
% 	  | S
% 	)$
%   \end{center}
%   \begin{center}
%   $\inferrule* [left=\bf{ClsSeq}]{
%       \inferrule* [left=\bf{SInp}]{
% 	\inferrule* [left=\bf{SInp}]{
% 	  \inferrule* [left=\bf{LInp}]{
% 	  }{
% 	    (y(x_{2}).P)\{x_{1}/z_{1}\}
% 	      \xrightarrow{y(z_{2})} 
% 		P\{x_{1}/z_{1}\}\{x_{2}/z_{2}\}
% 	  }
% 	}{
% 	  (\underline{a(b)}.y(x_{2}).P)\{x_{1}/z_{1}\}
% 	    \xrightarrow{a(b) \cdot y(z_{2})} 
% 	      P\{x_{1}/z_{1}\}\{x_{2}/z_{2}\}
% 	}
%       }{
% 	\underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% 	  \xrightarrow{y(z_{1}) \cdot a(b) \cdot y(z_{2})} 
% 	    P\{x_{1}/z_{1}\}\{x_{2}/z_{2}\}
%       }
%     \\
%       \inferrule* [left=\bf{Opn}]{
%       }{
% 	(\nu z_{1})\overline{y}z_{1}.Q 
% 	  \xrightarrow{y(z_{1})} 
% 	    Q
%       }
%   }{
%     \underline{y(x_{1})}.\underline{a(b)}.y(z_{2}).P
% 	| (\nu z_{1})\overline{y}z_{1}.Q 
%     \xrightarrow{a(b) \cdot y(x_{2})} 
% 	  (\nu z_{1})(
% 	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
% 	    | Q
% 	  )
%   }$
%   \end{center}
% 
%   \begin{center}
%   $\inferrule* [left=\bf{ClsSeq}]{
%       \underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% 	| (\nu z_{1})\overline{y}z_{1}.Q 
%       \xrightarrow{a(b) \cdot y(z_{2})} 
% 	  (\nu z_{1})(
% 	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
% 	    | Q
% 	  )
%     \\
%       \inferrule* [left=\bf{Out}]{
%       }{
% 	\overline{a}b.R
% 	  \xrightarrow{\overline{a}b} 
% 	    R
%       }
%   }{
%     \underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% 	| (\nu z_{1})\overline{y}z_{1}.Q 
% 	| \overline{a}b.R
%     \xrightarrow{y(z_{2})} 
%  	  (\nu z_{1})(
%  	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
%  	    | Q
%  	  )
%  	  | R
% %     \underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% % 	| (\nu z_{1})\overline{y}z_{1}.Q 
% %  	| \overline{a}b.R
% %  	| (\nu z_{2})\overline{y}z_{2}.S
% %     \xrightarrow{\tau} 
% %       (\nu z_{2})[(
% % 	  (\nu z_{1})(
% % 	    P\{z_{1}/x_{1}\}
% % 	    | Q
% % 	  )
% % 	  | R
% % 	)\{z_{2}/x_{2}\}
% % 	| S
% %       ]
%   }$
%   \end{center}
% 
%   \begin{center}
%   $\inferrule* [left=\bf{Cls}]{
%       \underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% 	| (\nu z_{1})\overline{y}z_{1}.Q 
% 	| \overline{a}b.R
%       \xrightarrow{y(z_{2})} 
%  	  (\nu z_{1})(
%  	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
%  	    | Q
%  	  )
%  	  | R
%     \\
%       \inferrule* [left=\bf{Opn}]{
% 	\inferrule* [left=\bf{Out}]{
% 	}{
% 	  \overline{y}z_{2}.S
% 	    \xrightarrow{\overline{y}z_{2}} 
% 	      S
% 	}
%       }{
% 	(\nu z_{2})\overline{y}z_{2}.S
% 	  \xrightarrow{\overline{y}(z_{2})} 
% 	    S
%       }
%   }{
%     \underline{y(x_{1})}.\underline{a(b)}.y(x_{2}).P
% 	| (\nu z_{1})\overline{y}z_{1}.Q 
% 	| \overline{a}b.R
% 	| (\nu z_{2})\overline{y}z_{2}.S
%     \xrightarrow{\tau} 
% 	(\nu z_{2})(
%  	  (\nu z_{1})(
%  	    P\{z_{1}/x_{1}\}\{x_{2}/z_{2}\}
%  	    | Q
%  	  )
%  	  | R
% 	  | S
% 	)
%   }$
%   \end{center}
% 
% \end{example}

\section{Normal form}

In the following section the symbol $\rightarrow$ will refer to the late semantic with structural congruence of multi $\pi$ calculus with strong input which is illustrated in table \ref{multipisoloinputlatewith}. Also we consider a structural congruence without the rules $P|0\equiv 0$ and $P+0\equiv 0$. For the purpose of clarity the rule of structural congruence are repeated in this secition.


\begin{definition}
  \emph{structural congruence $\equiv$} is the smallest relation on processes that satisfies the axioms in table \ref{structuralCongrunce}
  \begin{table}
    \begin{tabular}{ll}
      \multicolumn{2}{l}{\line(1,0){415}}\\
	$\inferrule* [left=\bf{SumAsc1}]{}{M_{1}+(M_{2}+M_{3})\equiv (M_{1}+M_{2})+M_{3}}$ &$\inferrule* [left=\bf{ParAsc1}]{}{P_{1}|(P_{2}|P_{3})\equiv (P_{1}|P_{2})|P_{3}}$
      \\
	$\inferrule* [left=\bf{SumAsc2}]{}{(M_{1}+M_{2})+M_{3}\equiv M_{1}+(M_{2}+M_{3})}$ &$\inferrule* [left=\bf{ParAsc2}]{}{(P_{1}|P_{2})|P_{3}\equiv P_{1}|(P_{2}|P_{3})}$ 
      \\
	 & 
      \\
      \end{tabular}
      \\
      \begin{tabular}{lll}
      \\
	$\inferrule* [left=\bf{ParCom}]{}{P_{1}|P_{2}\equiv P_{2}|P_{1}}$ &
	$\inferrule* [left=\bf{ResCom}]{}{(\nu x) (\nu y) P \equiv (\nu y) (\nu x) P}$ &
	$\inferrule* [left=\bf{SumCom}]{}{M_{1}+M_{2}\equiv M_{2}+M_{1}}$
      \\
      \end{tabular}
      \\
      \begin{tabular}{ll}
      \\
	$\inferrule* [left=\bf{ScpExtPar1}]{z\notin fn(P_{1})}{(\nu z) (P_{1}|P_{2}) \equiv P_{1}|(\nu z) P_{2}}$ & $\inferrule* [left=\bf{ScpExtPar2}]{z\notin fn(P_{1})}{P_{1}|(\nu z) P_{2} \equiv (\nu z) (P_{1}|P_{2})}$ 
      \\
	$\inferrule* [left=\bf{ScpExtSum1}]{z\notin fn(P_{1})}{(\nu z) (P_{1}+P_{2}) \equiv P_{1}+(\nu z) P_{2}}$ & $\inferrule* [left=\bf{ScpExtSum2}]{z\notin fn(P_{1})}{P_{1}+(\nu z) P_{2} \equiv (\nu z) (P_{1}+P_{2})}$ 
      \\
      \end{tabular}
      \\
      \begin{tabular}{lll}
      \\
	$\inferrule* [left=\bf{Ide}]{A(\tilde{x})\stackrel{def}{=}P}{A(\tilde{w})\equiv P\{\tilde{w}/\tilde{x}\}}$&
	$\inferrule* [left=\bf{Trans}]{P \equiv Q \\ Q \equiv R}{P \equiv R}$&
	  $\inferrule* [left=\bf{Alp}] {
	    P \equiv_{\alpha} Q
	  }{
	    P\equiv Q
	  }$

      \\
	$\inferrule* [left=\bf{Cong1}]{P \equiv Q}{C[P] \equiv C[Q]}$&$\inferrule* [left=\bf{Cong2}]{P_{1} \equiv Q_{1} \\ P_{2} \equiv Q_{2}}{C[P_{1}, P_{2}] \equiv C[Q_{1}, Q_{2}]}$&
      \\
      \\\multicolumn{3}{l}{\line(1,0){415}}
    \end{tabular}
    \caption{Structural congruence axioms}
    \label{structuralCongrunce}
  \end{table}
\end{definition}

\begin{proposition}
  $\equiv$ as defined in table \ref{structuralCongrunce} is a congruence and an equivalence relation.
  \begin{proof}
    $\equiv$ is a congruence thanks to rules $Cong1$ and $Cong2$. Reflexivity holds for rule $Alp$. Symmetry holds because all the rules are symmetric or have a symmetric counterpart. Transitivity holds because of rule $Trans$.
  \end{proof}
\end{proposition}

\begin{lemma}
  If $P \equiv Q$ then there is a proof of $P \equiv Q$ that does not use the rule $Trans$.
\end{lemma}

\begin{definition}
  $\twoheadrightarrow$ is the smallest relation induced by the all the rules in table \ref{multipisoloinputlatewith} except $Cong$. 
\end{definition}

\begin{proposition}\label{moveCongDown}
  If $P\xrightarrow{\sigma} Q$ then there exists a process $R$ such that: $R\stackrel{\sigma}{\twoheadrightarrow}Q$ and $P\equiv R$
  \begin{proof}
    We show that we can move the rule $Cong$ down the inference tree of $P\xrightarrow{\sigma} Q$. So a derivation of $P\xrightarrow{\sigma} Q$ can translate into a derivation of $P\xrightarrow{\sigma} Q$ which uses the rule $Cong$ only as its last rule.
    \begin{description}
      \item[$SInp$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{SInp}]{
	    \inferrule* [left=\bf{Cong}]{
		P \equiv R
	      \\
		R \xrightarrow{\gamma} Q
	    }{
	      P \xrightarrow{\gamma} Q
	    }
	  }{
	    \underline{x(z)}.P \xrightarrow{x(z) \cdot \gamma} Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	    \inferrule* {
	      P \equiv R
	    }{
	      \underline{x(z)}.P \equiv \underline{x(z)}.R
	    }
	  \\
	    \inferrule* [left=\bf{SInp}]{
	      R \xrightarrow{\gamma} Q
	    }{
	      \underline{x(z)}.R \xrightarrow{x(z) \cdot \gamma} Q
	    }
	  }{
	    \underline{x(z)}.P \xrightarrow{x(z) \cdot \gamma} Q
	  }$
	\end{center}
      \item[$Sum$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{Sum}]{
	    \inferrule* [left=\bf{Cong}]{
		P \equiv R
	      \\
		R \xrightarrow{\gamma} Q
	    }{
	      P \xrightarrow{\gamma} Q
	    }
	  }{
	    P+S \xrightarrow{\gamma} Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	    \inferrule* {
	      P \equiv R
	    }{
	      P+S \equiv R+S
	    }
	  \\
	    \inferrule* [left=\bf{Sum}]{
	      R \xrightarrow{\gamma} Q
	    }{
	      R+S \xrightarrow{\gamma} Q
	    }
	  }{
	    P+S \xrightarrow{\gamma} Q
	  }$
	\end{center}
      \item[$Cong$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      P \equiv R
	    \\
	      \inferrule* [left=\bf{Cong}]{
		  R \equiv S
		\\
		  S \xrightarrow{\gamma} Q
	      }{
		R \xrightarrow{\gamma} Q
	      }
	  }{
	    P \xrightarrow{\gamma} Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	    \inferrule* {
		P \equiv R
	      \\
		R \equiv S
	    }{
	      P \equiv S
	    }
	  \\
	    S \xrightarrow{\gamma} Q
	  }{
	    P \xrightarrow{\gamma} Q
	  }$
	\end{center}
      \item[$Par$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{Par}]{
	      \inferrule* [left=\bf{Cong}]{
		  P \equiv R
		\\
		  R \xrightarrow{\gamma} Q
	      }{
		P \xrightarrow{\gamma} Q
	      }
	    \\
	      bn(\gamma)\cap fn(S)=\emptyset
	  }{
	    P|S \xrightarrow{\gamma} Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      \inferrule* {
		P \equiv R
	      }{
		P|S \equiv R|S
	      }
	    \\
	      \inferrule* [left=\bf{Par}]{
		  R \xrightarrow{\gamma} Q
		\\
		  bn(\gamma)\cap fn(S)=\emptyset
	      }{
		R|S \xrightarrow{\gamma} Q
	      }
	  }{
	    P|S \xrightarrow{\gamma} Q
	  }$
	\end{center}
      \item[$LComSeq$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{LComSeq}]{
	      \inferrule* [left=\bf{Cong}]{
		  P_{1} \equiv R_{1}
		\\
		  R_{1} \xrightarrow{x(y) \cdot \sigma} Q_{1}
	      }{
		P_{1} \xrightarrow{x(y) \cdot \sigma} Q_{1}
	      }
	    \\
	      \inferrule* [left=\bf{Cong}]{
		  P_{2} \equiv R_{2}
		\\
		  R_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }{
		P_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }
% 	    \\
% 	      bn(\sigma) \cap fn(P_{2}) = \emptyset
	  }{
	    P_{1}|P_{2} \xrightarrow{\gamma\{z/y\}} Q_{1}\{z/y\}|Q_{2}
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      \inferrule* {
		  P_{1} \equiv R_{1}
		\\
		  P_{2} \equiv R_{2}
	      }{
		P_{1}|P_{2} \equiv R_{1}|R_{2}
	      }
	    \\
	      \inferrule* [left=\bf{LComSeq}]{
		  R_{1} \xrightarrow{x(y) \cdot \sigma} Q_{1}
		\\
		  R_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }{
		R_{1}|R_{2} \xrightarrow{\sigma\{z/y\}} Q_{1}\{z/y\}|Q_{2}
	      }
	  }{
	    P_{1}|P_{2} \xrightarrow{\gamma\{z/y\}} Q_{1}\{z/y\}|Q_{2}
	  }$
	\end{center}
      \item[$LCom$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{LCom}]{
	      \inferrule* [left=\bf{Cong}]{
		  P_{1} \equiv R_{1}
		\\
		  R_{1} \xrightarrow{x(y)} Q_{1}
	      }{
		P_{1} \xrightarrow{x(y)} Q_{1}
	      }
	    \\
	      \inferrule* [left=\bf{Cong}]{
		  P_{2} \equiv R_{2}
		\\
		  R_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }{
		P_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }
	  }{
	    P_{1}|P_{2} \xrightarrow{\tau} Q_{1}\{z/y\}|Q_{2}
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      \inferrule* {
		  P_{1} \equiv R_{1}
		\\
		  P_{2} \equiv R_{2}
	      }{
		P_{1}|P_{2} \equiv R_{1}|R_{2}
	      }
	    \\
	      \inferrule* [left=\bf{LCom}]{
		  R_{1} \xrightarrow{x(y)} Q_{1}
		\\
		  R_{2} \xrightarrow{\overline{x}z} Q_{2}
	      }{
		R_{1}|R_{2} \xrightarrow{\tau} Q_{1}\{z/y\}|Q_{2}
	      }
	  }{
	    P_{1}|P_{2} \xrightarrow{\tau} Q_{1}\{z/y\}|Q_{2}
	  }$
	\end{center}
      \item[$Res$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{Res}]{
	      \inferrule* [left=\bf{Cong}]{
		  P \equiv R
		\\
		  R \xrightarrow{\gamma} Q
	      }{
		P \xrightarrow{\gamma} Q
	      }
	    \\
	      z\notin n(\gamma)
	  }{
	    (\nu z)P \xrightarrow{\gamma} (\nu z)Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      \inferrule* {
		P \equiv R
	      }{
		(\nu z)P \equiv (\nu z)R
	      }
	    \\
	      \inferrule* [left=\bf{Res}]{
		  R \xrightarrow{\gamma} Q
		\\
		  z\notin n(\gamma)
	      }{
		(\nu z)R \xrightarrow{\gamma} (\nu z)Q
	      }
	  }{
	    (\nu z)P \xrightarrow{\gamma} (\nu z)Q
	  }$
	\end{center}
      \item[$Opn$]\hfill \\
	\begin{center}
	  $\inferrule* [left=\bf{Opn}]{
	      \inferrule* [left=\bf{Cong}]{
		  P \equiv R
		\\
		  R \xrightarrow{\overline{x}y} Q
	      }{
		P \xrightarrow{\overline{x}y} Q
	      }
	    \\
	      y\neq x
	  }{
	    (\nu y)P \xrightarrow{\overline{x}(y)} Q
	  }$
	\end{center}
	become
	\begin{center}
	  $\inferrule* [left=\bf{Cong}]{
	      \inferrule* {
		P \equiv R
	      }{
		(\nu y)P \equiv (\nu y)R
	      }
	    \\
	      \inferrule* [left=\bf{Opn}]{
		  R \xrightarrow{\overline{x}y} Q
		\\
		  y\neq x
	      }{
		(\nu y)R \xrightarrow{\overline{x}(y)} Q
	      }
	  }{
	    (\nu y)P \xrightarrow{\overline{x}(y)} Q
	  }$
	\end{center}
    \end{description}
  \end{proof}
\end{proposition}


\begin{lemma}[Inversion lemma for structural congruence]\label{inversionlemmamultiinplatewhith}
  :\begin{description}
    \item[$Output$]
      $\overline{x}y.P \equiv R$ then $R$ is in the form $\overline{x}y.S$ such that $P\equiv S$
    \item[$Tau$]
      $\tau.P \equiv R$ then $R$ is in the form $\tau.S$ such that $P\equiv S$
    \item[$Sum$]
      $P+Q \equiv R$ then $R$ is in the form $A+B$ such that $(P\equiv A\; \wedge\; Q\equiv B)$ or $(P\equiv B\; \wedge\; Q\equiv A)$ NON FUNZIONA PERCHE' C'E' LO SCOPE EXTRUSION ANCHE PER LA SOMMA!
  \end{description}
  DA CONTINUARE
  \begin{proof}
  We can assume that the property of being a congruence amounts to having these rules:
  \begin{center}
    \begin{tabular}{ll}
	$\inferrule* [left=\bf{Congr1}]{
	  P\equiv Q
	}{
	  C[P]\equiv C[Q]
	}$
      &
	$\inferrule* [left=\bf{Congr2}]{
	    P_{1}\equiv Q_{1}
	  \\
	    P_{2}\equiv Q_{2}
	}{
	  C[P_{1}, P_{2}]\equiv C[Q_{1}, Q_{2}]
	}$
    \end{tabular}
  \end{center}
  \begin{description}
    \item[$Output$] the only rules that can be applied to a process whose top level is an output are: the $\alpha$ conversion rule, $Congr1$ and $Congr2$.
    \item[$Tau$] similar.
    \item[$Summation$] the only rules that can be applied to a process whose top level is a sum are: the $\alpha$ conversion rule, $Congr1$, $Congr2$ and the commutativity of sum.

  \end{description}
  \end{proof}
\end{lemma}

% \begin{definition}
%   Let $(\nu x)Q$ be an occurrence in a process $P$, i.e., there is a context $C[\_]$ such that $C[(\nu x)Q]=P$. We say that this occurrence is \emph{guarded} if it occurs inside a prefix. Otherwise we say that the occurrence is \emph{unguarded}. More formally the occurrence is \emph{guarded} if there are two contexts $C[\_], D[\_]$ and an action prefixing $\alpha$ such that $P=D[\alpha.C[(\nu x)Q]]$
% \end{definition}

\begin{definition}
  Let $(\nu x)Q$ be an occurrence in a process $P$, i.e., there is a context $C[\_]$ such that $C[(\nu x)Q]=P$. We say that this occurrence is \emph{guarded} if it occurs right inside a prefix. Otherwise we say that the occurrence is \emph{unguarded}. More formally the occurrence $(\nu x)Q$ is \emph{guarded} in $P$ if there is a context $C[\_]$, an action prefixing $\alpha$ and names $\tilde{y}$ such that $P=C[\alpha.(\nu \tilde{y})(\nu x)Q]$
\end{definition}

\begin{definition}
  We say that a process is in \emph{normal form} if all bound names are distinct and all unguarded restrictions are at the top level, i.e., of the form $(\nu \tilde{x})P$ where $P$ has no unguarded restrictions, note that $\tilde{x}$ can eventually be empty.
\end{definition}

\begin{lemma}\label{existenceOfNormalForm}
  Every process is structurally congruent to a process in normal form.
  \begin{proof}
    Let $P$ be a process. We have to show that there exists a process $N$ such that $P \equiv N$ and $N$ is in normal form. We prove this by structural induction on $P$:
    \begin{description}
      \item[$0$] 
	in this case $P=0$ is already in normal form.
      \item[$\alpha.P_{1}$] 
	for inductive hypothesis there exists a process $N$ such that $P_{1} \equiv N$ and $N$ is in normal form. Then $\alpha.P_{1} \equiv \alpha.N$ and $\alpha.N$ is in normal form.
      \item[$P_{1}+P_{2}$]
	for inductive hypothesis there exist processes $N_{1}$ and $N_{2}$ such that $P_{1} \equiv N_{1}$, $P_{2} \equiv N_{2}$ and $N_{1}, N_{2}$ are in normal form. If $N_{1}$ or $N_{2}$ have unguarded restrictions at the top level then $N_{1}+N_{2}$ is not in normal form but we can move the restrictions up to the top level using $\alpha$ equivalence and the rule 
	\begin{center}
	  \begin{tabular}{ll}
	      $(\nu x)(P+Q) \equiv P + (\nu x)Q$ 
	    &
	      if $x\notin fn(P)$
	  \end{tabular}
	\end{center}
	and we get something that is in normal form and structurally equivalent to $N_{1}+N_{2}$ and so to $P_{1}+P_{2}$.
      \item[$P_{1}|P_{2}$] similar.
      \item[$(\nu x)P_{1}$] 
	for inductive hypothesis there exists a process $N$ such that $P_{1} \equiv N$ and $N$ is in normal form. $(\nu x)N$ is in normal form and it is structurally congruent to $P$.
    \end{description}
  \end{proof}
\end{lemma}


\begin{lemma}\label{mapToNormalForm}
  $P \xrightarrow{\gamma} Q$, $P\equiv N$, $N$ is in normal form then $N \xrightarrow{\gamma} M$, $Q\equiv M$, $M$ is in normal form and the depth of the inference tree of $N \xrightarrow{\gamma} M$ is not greater than the depth of the inference tree of $P \xrightarrow{\gamma} Q$.
  \begin{proof}
    The proof is by induction on the derivation of $P\equiv N$. The last rule used can be:
    \begin{description}
      \item[$\alpha\; conversion$] 
	?? ???
    \end{description}
  \end{proof}
\end{lemma}

\begin{lemma}
  If $P \xrightarrow{\gamma} Q$ then there exist processes $N,M$ in normal form such that $P\equiv N$, $N \xrightarrow{\gamma} M$, $Q\equiv M$ and the inference tree of $N \xrightarrow{\gamma} M$ is not deeper than the one of $P \xrightarrow{\gamma} Q$.
  \begin{proof}
    this lemma follows from lemma \ref{existenceOfNormalForm} and lemma \ref{mapToNormalForm}
  \end{proof}
\end{lemma}

\begin{lemma}[Inversion lemma for structural congruence for normal form]\label{inversionLemmaStructNorm}
  
\end{lemma}

\begin{proposition}\label{moveCongDownNorm}
  Suppose that we replace the rules $LInp$ and $SInp$ with the following:
  \begin{center}
    $\inferrule* [left=\bf{Inp}]{
      n \geq 0
    }{
      \underline{x_{1}(y_{1})}.\; \ldots\; .\underline{x_{n}(y_{n})}.z(w).P 
	\xrightarrow{\widetilde{x(y)} \cdot z(w)} 
	  P
    }$
  \end{center}
  then the semantic does not change. Also if $P\xrightarrow{\sigma} Q$ then there exist processes $N,R$ such that: $P \equiv N\stackrel{\sigma}{\twoheadrightarrow} R \equiv M$ and $N$ is in normal form.
  SARA' VERO?
  \begin{proof}
    The proof is an induction on the depth of $P\xrightarrow{\sigma} Q$. The last rule used can be:
    \begin{description}
      \item[$Tau$] 
	$P=\tau.P_{1} \xrightarrow{\tau} P_{1}=Q$. For lemma \ref{existenceOfNormalForm} there exists a normal form $N$ such that $\tau.P_{1}\equiv N$. For lemma \ref{inversionLemmaStructNorm} $N=\tau.N_{1}$ and $P_{1}\equiv N_{1}$. So for rule $Tau$: $P \equiv \tau.N_{1}\xrightarrow{\tau} N_{1} \equiv Q$ 
      \item[$Inp$]
	$P=\underline{x_{1}(y_{1})}.\; \ldots\; .\underline{x_{n}(y_{n})}.z(w).P_{1}
	  \xrightarrow{x_{1}(y_{1})\cdot \ldots \cdot x_{n}(y_{n})\cdot z(w)} 
	    P_{1}=Q$. For lemma \ref{existenceOfNormalForm} there exists a normal form $N$ such that $P\equiv N$. For lemma \ref{inversionLemmaStructNorm} $N=\underline{x_{1}(y_{1})}.\; \ldots\; .\underline{x_{n}(y_{n})}.z(w).N_{1}$ and $P_{1}\equiv N_{1}$. For rule $Inp$: 
	    $P\equiv \underline{x_{1}(y_{1})}.\; \ldots\; .\underline{x_{n}(y_{n})}.z(w).N_{1}
	      \xrightarrow{x_{1}(y_{1})\cdot \ldots \cdot x_{n}(y_{n})\cdot z(w)} 
		N_{1}\equiv Q$
      \item[$Out$] 
	similar.
      \item[$Sum$]
	$P=P_{1}+P_{2} \xrightarrow{\gamma} P_{1}^{'}=Q$. non si puo' applicare l'ipotesi induttiva alle premesse della regola sum.
    \end{description}
  \end{proof}
\end{proposition}

\begin{definition}
  The \emph{late transition relation for normal forms} is the smallest relation induced by the rules in table \ref{multipiInpNorm}, written $\rightarrow_{n}$. Every process in the head of transition in the premise of a rule in table \ref{multipiInpNorm} is assumed to be in normal form. Also when we write $(\nu \tilde{x})P$ is a normal form, it means that $P$ has no restriction at the top level.
  \begin{table}
    \begin{tabular}{lll}
	\multicolumn{3}{l}{\line(1,0){415}}
	\\\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.N \xrightarrow{\overline{x}y}_{n} N
	  }$
	&
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \xrightarrow{\tau}_{n} P
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{l}
      \\
	  $\inferrule* [left=\bf{Inp}]{
	      n \geq 0
	  }{
	    \underline{x_{1}(y_{1})}.\; \ldots\; .\underline{x_{n}(y_{n})}.z(w).N
	      \xrightarrow{x_{1}(y_{1})\cdot \ldots \cdot x_{n}(y_{n})\cdot z(w)}_{n}
		N
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{l}
      \\
	  $\inferrule* [left=\bf{LComSeq1}]{
	      (\nu \tilde{a})P \xrightarrow{x(y)\cdot \sigma}_{n} (\nu \tilde{b})P^{'}
	    \\
	      (\nu \tilde{c})Q \xrightarrow{\overline{x}z}_{n} (\nu \tilde{d})Q^{'}
  	    \\
   	      bn(\sigma)\cap fn(Q) = \emptyset
	  }{
	    (\nu \tilde{a} \tilde{c}) (P|Q) \xrightarrow{\sigma\{z/y\}}_{n} (\nu \tilde{b} \tilde{d})(P^{'}\{z/y\}|Q^{'})
	  }$
	\\
	  $\inferrule* [left=\bf{LCom1}]{
	      (\nu \tilde{a}) P \xrightarrow{x(y)}_{n} (\nu \tilde{b})P^{'}
	    \\
	      (\nu \tilde{c}) Q\xrightarrow{\overline{x}z}_{n} (\nu \tilde{d})Q^{'}
	  }{
	    (\nu \tilde{a} \tilde{b})(P|Q) \xrightarrow{\tau}_{n} (\nu \tilde{c} \tilde{d})(P^{'}\{z/y\}|Q^{'})
	  }$
      \\
	  $\inferrule* [left=\bf{LComSeq2}]{
	      (\nu \tilde{a})P \xrightarrow{\overline{x}z}_{n} (\nu \tilde{b})P^{'}
	    \\
	      (\nu \tilde{c})Q \xrightarrow{x(y)\cdot \sigma}_{n} (\nu \tilde{d})Q^{'}
  	    \\
   	      bn(\sigma)\cap fn(Q) = \emptyset
	  }{
	    (\nu \tilde{a} \tilde{c}) (P|Q) \xrightarrow{\sigma\{z/y\}}_{n} (\nu \tilde{b} \tilde{d})(P^{'}\{z/y\}|Q^{'})
	  }$
	\\
	  $\inferrule* [left=\bf{LCom2}]{
	      (\nu \tilde{a}) P \xrightarrow{\overline{x}z}_{n} (\nu \tilde{b})P^{'}
	    \\
	      (\nu \tilde{c}) Q\xrightarrow{x(y)}_{n} (\nu \tilde{d})Q^{'}
	  }{
	    (\nu \tilde{a} \tilde{b})(P|Q) \xrightarrow{\tau}_{n} (\nu \tilde{c} \tilde{d})(P^{'}\{z/y\}|Q^{'})
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{l}
      \\
	  $\inferrule* [left=\bf{Sum1}]{
	      (\nu \tilde{a}) P \xrightarrow{\sigma}_{n} (\nu \tilde{b})P^{'}
	    \\
	      (\nu \tilde{c})Q\; normal\; form
	  }{
	    (\nu \tilde{a} \tilde{c}) (P+Q) \xrightarrow{\sigma}_{n} (\nu \tilde{b} \tilde{c})P^{'}
	  }$
	\\
	  $\inferrule* [left=\bf{Sum2}]{
	      (\nu \tilde{a})P\; normal\; form
	    \\
	      (\nu \tilde{b}) Q \xrightarrow{\sigma}_{n} (\nu \tilde{c})Q^{'}
	  }{
	    (\nu \tilde{a} \tilde{c}) (P+Q) \xrightarrow{\sigma}_{n} (\nu \tilde{b} \tilde{c})Q^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{Res}]{
	      (\nu \tilde{a})P \xrightarrow{\sigma}_{n} (\nu \tilde{b})P^{'}
	    \\
	      z\notin n(\alpha)
	  }{
	    (\nu z \tilde{a}) P \xrightarrow{\sigma}_{n} (\nu z \tilde{b}) P^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Opn}]{
	      (\nu \tilde{a})P \xrightarrow{\overline{x}z}_{n} P^{'}
	    \\ 
	      z\neq x
	  }{
	      (\nu z \tilde{a})P \xrightarrow{\overline{x}(z)}_{n} P^{'}
	  }$
      \\
      \end{tabular}
	\\
      \begin{tabular}{l}
      \\
	  $\inferrule* [left=\bf{Par1}]{
	      (\nu \tilde{a}) P \xrightarrow{\sigma}_{n} (\nu \tilde{b})P^{'}
	    \\
	      bn(\sigma)\cap fn(Q)=\emptyset
	    \\
	      (\nu \tilde{c})Q\; normal\; form
	  }{
	    (\nu \tilde{a} \tilde{c})(P|Q) \xrightarrow{\sigma}_{n} (\nu \tilde{b} \tilde{c})(P^{'}|Q)
	  }$
      \\
	  $\inferrule* [left=\bf{Par2}]{
	      (\nu \tilde{a})P\; normal\; form
	    \\
	      bn(\sigma)\cap fn((\nu \tilde{a})P)=\emptyset
	    \\
	      (\nu \tilde{b}) Q \xrightarrow{\sigma}_{n} (\nu \tilde{c})Q^{'}
	  }{
	    (\nu \tilde{a} \tilde{c})(P|Q) \xrightarrow{\sigma}_{n} (\nu \tilde{b} \tilde{c})(P|Q^{'})
	  }$
	\\\\\multicolumn{1}{l}{\line(1,0){415}}
    \end{tabular}
    \caption{Multi $\pi$ late semantic for normal forms}
    \label{multipiInpNorm}
  \end{table}
\end{definition}

\begin{lemma}\label{moveCongDownNorm2}
  $P\xrightarrow{\gamma}Q$ imply $P\equiv N \xrightarrow{\gamma}_{n} M\equiv Q$ for some processes $N$ and $M$ in normal form. Also $N \xrightarrow{\gamma}_{n} M$ imply $N \xrightarrow{\gamma} M$
\end{lemma}



\section{Strong bisimilarity and equivalence}

\subsection{Strong bisimilarity}

In the following $\widetilde{x(y)}=x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})$ and $\tilde{x}= x_{1}\cdot \ldots \cdot x_{n}$.

\begin{definition}\label{strongLateBisimulation}
  A \emph{strong bisimulation} is a simmetric binary relation $\mathbf{S}$ on multi $\pi$ processes such that for all $P\mathbf{S}Q$:
   \begin{itemize}
     \item 
       $P \xrightarrow{\alpha} P^{'}$, $bn(\alpha)$ is fresh and $\alpha$ is not an input nor a sequence of inputs then there exists some $Q^{'}$ such that $Q \xrightarrow{\alpha} Q^{'}$ and $P^{'}\mathbf{S}Q^{'}$
     \item
       $P \xrightarrow{\widetilde{x(y)}} P^{'}$ where $\gamma$ is a possibly empty sequence of inputs and $\tilde{y}$ is fresh then there exists some $Q^{'}$ such that $Q \xrightarrow{\widetilde{x(y)}} Q^{'}$ and for all $\tilde{w}$, $P^{'}\{\tilde{w}/\tilde{y}\}\mathbf{S}Q^{'}\{\tilde{w}/\tilde{y}\}$
  \end{itemize}
  $P$ and $Q$ are strongly bisimilar, written $P \dot{\sim} Q$, if they are related by a strong bisimulation.
\end{definition}


Is this definition a proper extension of the one in \cite{parrow}? The only way to tell is by showing some example of process that we intuitively want to be bisimilar.
\begin{example}:
  \begin{center}
    \begin{tabular}{lll}
	$P=\underline{a(u)}.b(v).0$
      &
	$P \dot{\sim} Q$ 
      &
	$\underline{a(x)}.b(v).(\nu y)\overline{y}u.0=Q$
    \end{tabular}
  \end{center}
  This is because for all $u\in \mathbf{N}-\{b\}$ and for all $v\in \mathbf{N}-\{u\}$: $P \xrightarrow{a(u) \cdot b(v)} 0$. For all $x\in \mathbf{N}-\{b,u\}$ and for all $v\in \mathbf{N}-\{u,x,y\}$:$Q \xrightarrow{a(x) \cdot b(v)} 0$. Taking $z,w$ fresh in $P$ and $Q$ means: $z,w\in \mathbf{N}-\{a,b,u\}$, so both $P$ and $Q$ can make the transition $\xrightarrow{a(z) \cdot b(w)}$ and arrive to $0$.
\end{example}

% \begin{definition}
%   We say that $P$ and $Q$ are \emph{strongly bisimular up to structural congruence} written $\dot{\sim}^{\equiv}$ if:
%    \begin{itemize}
%      \item 
%        $P \xrightarrow{\alpha} P^{'}$, $bn(\alpha)$ is fresh and $\alpha$ is not an input nor a sequence of inputs then there exist processes $Q^{'},Q^{''},P^{''}$ such that $Q \xrightarrow{\alpha} Q^{'}$ and $P^{'} \equiv P^{''} \dot{\sim} Q^{''} \equiv Q^{'}$
%      \item
%        $P \xrightarrow{x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})} P^{'}$ where $\gamma$ is a possibly empty sequence of inputs and $y_{1} \cdot \ldots \cdot y_{n}$ is fresh then there exist processes $Q^{'}, Q^{''}, P^{''}$ such that $Q \xrightarrow{x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})} Q^{'}$ and for all $w_{1}\cdot \ldots \cdot w_{n}$, $P^{'}\{w_{1}/y_{1}, \ldots, w_{n}/y_{n}\} \equiv P^{''} \dot{\sim} Q^{''} \equiv Q^{'}\{w_{1}/y_{1}, \ldots, w_{n}/y_{n}\}$
%   \end{itemize}
% \end{definition}

% \begin{proposition}
%   $P \dot{\sim}_{E}^{up} Q$ imply $P \dot{\sim}_{E} Q$.
%   \begin{proof}
%     Let $\mathbf{S}$ be a bisimulation up to $\dot{\sim}_{E}$ such that $P \mathbf{S} Q$. It can be proved that $\dot{\sim}_{E} \mathbf{S} \dot{\sim}_{E}$ is a bisimulation: let $A \dot{\sim}_{E} B \mathbf{S} C \dot{\sim}_{E} D$
%     \begin{center}
%       \begin{tabular}{l}
% 	$A \xrightarrow{\gamma} A^{'}$ $\wedge$ $A \dot{\sim}_{E} B$ $\wedge$ definition \ref{strongEarlyBisimulation} 
%       
% 	$\Rightarrow \exists B^{'}:$ $B \xrightarrow{\gamma} B^{'}$ $\wedge$ $A^{'}\dot{\sim}_{E} B^{'}$
%       \\
% 	$B \mathbf{S} C$ $\wedge$ definition \ref{strongEarlyBisimulationUpTo}
%       
% 	$\Rightarrow \exists C^{'} C^{''} B^{''}:$ $C \xrightarrow{\gamma} C^{'}$ $\wedge$ $B^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} C^{'}$
%       \\
% 	$C \xrightarrow{\gamma} C^{'}$ $\wedge$ $C \dot{\sim}_{E} D$ $\wedge$ definition \ref{strongEarlyBisimulation} 
%       
% 	$\Rightarrow \exists D^{'}:$ $D \xrightarrow{\gamma} D^{'}$ $\wedge$ $C^{'}\mathbf{S} D^{'}$
%       \\
% 	$A^{'} \dot{\sim}_{E} B^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} C^{'} \dot{\sim}_{E} D^{'}$ $\wedge$ transitivity of $\dot{\sim}_{E}$
% 	$\Rightarrow$ $A^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} D^{'}$
%       \end{tabular}
%     \end{center}
%     It is easy to see that the simmetric also holds.
%   \end{proof}
% \end{proposition}

\begin{definition}\label{strongLateBisimulationUpTo}
  Let $\mathbf{R}$ be a strong late bisimulation. A \emph{strong bisimulation up to $\mathbf{R}$} is a simmetric binary relation $\mathbf{S}$ on multi $\pi$ processes such that for all $P\mathbf{S}Q$:
   \begin{itemize}
     \item 
       $P \xrightarrow{\alpha} P^{'}$, $bn(\alpha)$ is fresh and $\alpha$ is not an input nor a sequence of inputs then there exist processes $Q^{'}, Q^{''}, P^{''}$ such that $Q \xrightarrow{\alpha} Q^{'}$ and $P^{'} \mathbf{R} P^{''} \mathbf{S} Q^{''} \mathbf{R} Q^{'}$
     \item
       $P \xrightarrow{x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})} P^{'}$ where $\gamma$ is a possibly empty sequence of inputs and $y_{1} \cdot \ldots \cdot y_{n}$ is fresh then there exists some $Q^{'}$ such that $Q \xrightarrow{x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})} Q^{'}$ and for all $w_{1}\cdot \ldots \cdot w_{n}$  $P^{'}\{w_{1}/y_{1}, \ldots, w_{n}/y_{n}\} \mathbf{R} \mathbf{S} \mathbf{R} Q^{'}\{w_{1}/y_{1}, \ldots, w_{n}/y_{n}\}$
  \end{itemize}
  $P$ and $Q$ are strongly bisimilar up to $\mathbf{R}$, written $P \dot{\sim}^{\mathbf{R}} Q$, if they are related by a strong bisimulation up to $\mathbf{R}$.
\end{definition}


\begin{proposition}
  $P \dot{\sim}^{\mathbf{R}} Q$ imply $P \dot{\sim} Q$.
   \begin{proof}
     Let $\mathbf{S}$ be a bisimulation up to $\mathbf{R}$ such that $P \mathbf{S} Q$. It can be proved that $\mathbf{R} \mathbf{S} \mathbf{R}$ is a bisimulation: let $A \mathbf{R} B \mathbf{S} C \mathbf{R} D$ and let $\gamma$ be a non input action
     \begin{center}
       \begin{tabular}{l}
 	$A \xrightarrow{\gamma} A^{'}$ $\wedge$ $A \mathbf{R} B$ $\wedge$ definition \ref{strongLateBisimulation}
       
 	$\Rightarrow \exists B^{'}:$ $B \xrightarrow{\gamma} B^{'}$ $\wedge$ $A^{'} \mathbf{R} B^{'}$
       \\
 	$B \mathbf{S} C$ $\wedge$ definition \ref{strongLateBisimulationUpTo}
       
 	$\Rightarrow \exists C^{'} C^{''} B^{''}:$ $C \xrightarrow{\gamma} C^{'}$ $\wedge$ $B^{'} \mathbf{R} B^{''} \mathbf{S} C^{''} \mathbf{R} C^{'}$
       \\
 	$C \xrightarrow{\gamma} C^{'}$ $\wedge$ $C \mathbf{R} D$ $\wedge$ definition \ref{strongLateBisimulation} 
       
	$\Rightarrow \exists D^{'}:$ $D \xrightarrow{\gamma} D^{'}$ $\wedge$ $C^{'}\mathbf{R} D^{'}$
       \\
	$A^{'} \mathbf{R} B^{'} \mathbf{R} B^{''} \mathbf{S} C^{''} \mathbf{R} C^{'} \mathbf{R} D^{'}$ $\wedge$ transitivity of $\mathbf{R}$
	$\Rightarrow$ $A^{'} \mathbf{R} B^{''} \mathbf{S} C^{''} \mathbf{R} D^{'}$
      \end{tabular}
    \end{center}
    It is easy to see that the simmetric also holds. For the other case: let $x_{1}(y_{1}) \cdot \ldots \cdot x_{n}(y_{n})= \tilde{x}(\tilde{y})$
     \begin{center}
       \begin{tabular}{l}
 	$A \xrightarrow{\tilde{x}(\tilde{y})} A^{'}$ $\wedge$ $A \mathbf{R} B$ $\wedge$ definition \ref{strongLateBisimulation}
       
 	$\Rightarrow \exists B^{'}:$ $B \xrightarrow{\tilde{x}(\tilde{y})} B^{'}$ and for all $\tilde{w}:A^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} B^{'}\{\tilde{w}/\tilde{y}\}$
       \\
 	$B \mathbf{S} C$ $\wedge$ definition \ref{strongLateBisimulationUpTo}
       
 	$\Rightarrow \exists C^{'}:$ $C \xrightarrow{\tilde{x}(\tilde{y})} C^{'}$ $\wedge$ $B^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} \mathbf{S} \mathbf{R} C^{'}\{\tilde{w}/\tilde{y}\}$
       \\
 	$C \xrightarrow{\tilde{x}(\tilde{y})} C^{'}$ $\wedge$ $C \mathbf{R} D$ $\wedge$ definition \ref{strongLateBisimulation} 
       
	$\Rightarrow \exists D^{'}:$ $D \xrightarrow{\tilde{x}(\tilde{y})} D^{'}$ $\wedge$ $C^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} D^{'}\{\tilde{w}/\tilde{y}\}$
       \\
	$A^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} B^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} \mathbf{S} \mathbf{R} C^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} D^{'}\{\tilde{w}/\tilde{y}\}$ $\wedge$ transitivity of $\mathbf{R}$
	$\Rightarrow$ $A^{'}\{\tilde{w}/\tilde{y}\} \mathbf{R} \mathbf{S} \mathbf{R} D^{'}\{\tilde{w}/\tilde{y}\}$
      \end{tabular}
    \end{center}
    It is easy to see that the simmetric also holds.
   \end{proof}
\end{proposition}

\begin{proposition}
  Structural congruence is a strong bisimulation.
  \begin{proof}
    Let $P\equiv Q$. If $P\xrightarrow{\sigma}P^{'}$ then for symmetry of $\equiv$ and rule $Cong$: $Q\xrightarrow{\sigma}P^{'}$. If $Q\xrightarrow{\sigma}Q^{'}$ then for rule $Cong$: $P\xrightarrow{\sigma}Q^{'}$
  \end{proof}
\end{proposition}

\begin{proposition}
  $\dot{\sim}$ is preserved by all operators except input prefix.
  \begin{proof}
    We have to try each operator in turn and prove that $\dot{\sim}^{\equiv}$ is preserved:
    \begin{description}
      \item[Output prefix]
    \end{description}
	Let $P \dot{\sim} Q$ and let $\overline{x}y.P \xrightarrow{\alpha} P^{'}$. The last rule used in the derivation of this transition can be:
	\begin{description}
	  \item[$Out$]
	    $\overline{x}y.P \xrightarrow{\overline{x}y} P$ and $\overline{x}y.Q \xrightarrow{\overline{x}y} Q$ and $P \dot{\sim} Q$
	  \item[$Cong$]
	    For lemma \ref{inversionlemmamultiinplatewhith} a process structurally congruent to $\overline{x}y.P$ must be in the form $\overline{x}y.R$ where $P \equiv R$ so $\overline{x}y.P \xrightarrow{\overline{x}y} R$.
	\end{description}
    \begin{description}
      \item[Tau prefix] similar.
    \end{description}
    \begin{description}
      \item[Input prefix] FARE UN ESEMPIO A PARTE DEL PERCH NON FUNZIONA
    \end{description}
    \begin{description}
      \item[Strong input] FARE UN ESEMPIO A PARTE DEL PERCH NON FUNZIONA	
    \end{description}
    \begin{description}
      \item[Summation]
    \end{description}
	Let $P \dot{\sim} Q$ and let $P+R \xrightarrow{\gamma} P^{'}$. The last rule used in the derivation of this transition can be:
	\begin{description}
	  \item[$Sum$]
	    $P+R \xrightarrow{\gamma} P^{'}$ because $P \xrightarrow{\gamma} P^{'}$ so $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'} \dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$
	  \item[$Cong$]
	    For proposition \ref{moveCongDown} we can assume that only the last rule used to prove $P+R \xrightarrow{\gamma} P^{'}$ is $Cong$ so
	    \begin{center}
	      $\inferrule* [left=\bf{Cong}]{
		  P+R\equiv S
		\\
		  S \stackrel{\gamma}{\twoheadrightarrow} P^{'}
	      }{
		P+R \xrightarrow{\gamma} P^{'}
	      }$
	    \end{center}
	    we proceed by cases on the last rule used in the derivation of $P+R\equiv S$:
	    \begin{description}
	      \item[$Cong2$]
		$S$ is $A+B$, $P \equiv A$ and $R \equiv B$. Then $A+B \stackrel{\gamma}{\twoheadrightarrow} P^{'}$, the last rule used in this derivation must be $Sum$ so $A \stackrel{\gamma}{\twoheadrightarrow} P^{'}$. 
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
		      P\equiv A
		    \\
		      A \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		  }{
		    P \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
		Since $P\dot{\sim}Q$ we have $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'} \dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$. For rule $Sum$: $Q+R \xrightarrow{\gamma} Q^{'}$
	      \item[$SumCom$]
		$S$ is $R+P$. Then $R+P \stackrel{\gamma}{\twoheadrightarrow} P^{'}$, the last rule used in this derivation must be $Sum$ so $R \stackrel{\gamma}{\twoheadrightarrow} P^{'}$. 
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
		      Q+R\equiv R+Q
		    \\
			\inferrule* [left=\bf{Sum}]{
			    R \stackrel{\gamma}{\twoheadrightarrow} P^{'}
			}{
			  R+Q \xrightarrow{\gamma} P^{'}
			}
		  }{
		    Q+R \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
	      \item[$Alp$]
		$S$ is $\alpha$ equivalent to $P+R$ so $S=S_{1}+S_{2}$ such that $S_{1}\equiv_{\alpha}P$ and $S_{2}\equiv_{\alpha}R$. Then  $S_{1}+S_{2} \stackrel{\gamma}{\twoheadrightarrow} P^{'}$, the last rule used in this derivation must be $Sum$ so $S_{1} \stackrel{\gamma}{\twoheadrightarrow} P^{'}$. 
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
			    P\equiv_{\alpha}S_{1}
			  \\
			    S_{1} \stackrel{\gamma}{\twoheadrightarrow} P^{'}
			}{
			  P \xrightarrow{\gamma} P^{'}
			}$
		\end{center}
		Since $P\dot{\sim}Q$ we have $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'} \dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$. For rule $Sum$: $Q+R \xrightarrow{\gamma} Q^{'}$
	      \item[$ScpExtSum2$]\hfill \\
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
		      \inferrule* {
			x \notin fn(P)
		      }{
			P+(\nu x)R\equiv (\nu x)(P+R)
		      }
		    \\
		      (\nu x)(P+R) \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		  }{
		    P+R \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
		the last rule used in the derivation of $(\nu x)(P+R) \stackrel{\gamma}{\twoheadrightarrow} P^{'}$ can be:
		\begin{description}
		  \item[$Res$]\hfill \\ 
		    \begin{center}
		      $\inferrule* [left=\bf{Res}]{
			  \inferrule* [left=\bf{Sum}]{
			    P \stackrel{\gamma}{\twoheadrightarrow} P^{''}
			  }{
			    P+R \stackrel{\gamma}{\twoheadrightarrow} P^{''}
			  }
			\\
			  x\notin n(\gamma)
		      }{
			(\nu x)(P+R) \stackrel{\gamma}{\twoheadrightarrow} (\nu x)P^{''}
		      }$
		    \end{center}
		    $P \dot{\sim} Q$ and $P \stackrel{\gamma}{\twoheadrightarrow} P^{''}$ imply $Q \xrightarrow{\gamma} Q^{''}$ and $P^{''} \dot{\sim} Q^{''}$ or $P^{''}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{''}\{\tilde{w}/\tilde{y}\}$. For rules $Res$ and $Sum$: $Q+(\nu x)R \xrightarrow{\gamma} (\nu x)Q^{''}$.
		  \item[$Opn$]
		\end{description}
	      \item[$SumAsc1(1)$]\hfill \\
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
		      \inferrule* [left=\bf{SumAsc1}] {
		      }{
			(P_{1}+P_{2})+R \equiv P_{1}+(P_{2}+R)
		      }
		    \\
		      \inferrule* [left=\bf{Sum}] {
			P_{1} \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		      }{
			P_{1}+(P_{2}+R) \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		      }
		  }{
		    (P_{1}+P_{2})+R \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
		$P_{1} \stackrel{\gamma}{\twoheadrightarrow} P^{'}$ imply $P=P_{1}+P_{2} \stackrel{\gamma}{\twoheadrightarrow} P^{'}$ so for bisimilarity $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'}\dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$. For rule $Sum$: $Q+R \xrightarrow{\gamma} Q^{'}$.
	      \item[$SumAsc1(2)$]\hfill \\
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
		      \inferrule* [left=\bf{SumAsc1}] {
		      }{
			(P+R_{1})+R_{2} \equiv P+(R_{1}+R_{2})
		      }
		    \\
		      \inferrule* [left=\bf{Sum}] {
			P \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		      }{
			P+(R_{1}+R_{2}) \stackrel{\gamma}{\twoheadrightarrow} P^{'}
		      }
		  }{
		    (P+R_{1})+R_{2} \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
		$P \stackrel{\gamma}{\twoheadrightarrow} P^{'}$ so for bisimilarity $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'}\dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$. For rule $Sum$: $Q+R \xrightarrow{\gamma} Q^{'}$.
	      \item[$SumAsc2(2)$]\hfill \\
		\begin{center}
		  $\inferrule* [left=\bf{Cong}]{
			P_{1}+(P_{2}+R) \equiv (P_{1}+P_{2})+R
		    \\
		      \inferrule* [left=\bf{Sum}] {
			\inferrule* [left=\bf{Sum}]{
			  P_{1} \stackrel{\gamma}{\twoheadrightarrow} P^{'}
			}{
			  P=P_{1}+P_{2} \xrightarrow{\gamma} P^{'}
			}
		      }{
			(P_{1}+P_{2})+R \xrightarrow{\gamma} P^{'}
		      }
		  }{
		    P_{1}+(P_{2}+R) \xrightarrow{\gamma} P^{'}
		  }$
		\end{center}
		$P \stackrel{\gamma}{\twoheadrightarrow} P^{'}$ so for bisimilarity $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'}\dot{\sim} Q^{'}$ or $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$. For rule $Sum$: $Q+R \xrightarrow{\gamma} Q^{'}$.
	    \end{description}
	\end{description}
    \begin{description}
      \item[Restriction] 
    \end{description}
	The relation 
	\begin{center}
	  $Res(\dot{\sim})=\{((\nu x)P,(\nu x)Q): P\dot{\sim}Q\}\cup \dot{\sim}$ 
	\end{center}
	is a strong bisimulation. There are some cases to consider depending on rule applicable to $(\nu x)P$:
	\begin{description}
	  \item[$Res(1)$]
	    let $\tilde{y}$ be fresh in $P,Q$.
	    \begin{center}
	      $\inferrule* [left=\bf{Res}]{
		  P \xrightarrow{\widetilde{x(y)}} P^{'}
		\\
		  z \notin n(\widetilde{x(y)})
	      }{
		(\nu z)P \xrightarrow{\widetilde{x(y)}} (\nu z)P^{'}
	      }$
	    \end{center}
	    $P \xrightarrow{\widetilde{x(y)}} P^{'}$ and $P\dot{\sim}Q$ imply $Q \xrightarrow{\widetilde{x(y)}} Q^{'}$ and for all $\tilde{w}$: $P^{'}\{\tilde{w}/\tilde{y}\} \dot{\sim} Q^{'}\{\tilde{w}/\tilde{y}\}$ which imply $(\nu z)(P^{'}\{\tilde{w}/\tilde{y}\}) Res(\dot{\sim}) (\nu z)(Q^{'}\{\tilde{w}/\tilde{y}\})$. Under the hypothesis that $z\notin \tilde{w}$: $z \notin n(\widetilde{x(y)})$ imply $(\nu z)(P^{'}\{\tilde{w}/\tilde{y}\})=((\nu z) P^{'})\{\tilde{w}/\tilde{y}\}$. Nevertheless we have to prove that also for $z\in \tilde{w}$ and $z \notin n(\widetilde{x(y)})$: $((\nu z)P^{'})\{\tilde{w}/\tilde{y}\} Res(\dot{\sim}) ((\nu z)Q^{'})\{\tilde{w}/\tilde{y}\}$.
	    COME ?!?!?!?!
	  \item[$Res(2)$]
	    let $\gamma$ be a non input action 
	    \begin{center}
	      $\inferrule* [left=\bf{Res}]{
		  P \xrightarrow{\gamma} P^{'}
		\\
		  z \notin n(\gamma)
	      }{
		(\nu z)P \xrightarrow{\gamma} (\nu z)P^{'}
	      }$
	    \end{center}
	    $P \xrightarrow{\gamma} P^{'}$ and $P\dot{\sim}Q$ imply $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'} \dot{\sim} Q^{'}$ which in turn imply $(\nu z)P^{'} Res(\dot{\sim}) (\nu z)Q^{'}$.
	  \item[$Opn$]
	    let $\tilde{y}$ be fresh in $P,Q$.
	    \begin{center}
	      $\inferrule* [left=\bf{Opn}]{
		  P \xrightarrow{\overline{x}y} P^{'}
	      }{
		(\nu y)P \xrightarrow{\overline{x}(y)} P^{'}
	      }$
	    \end{center}
	    $P \xrightarrow{\overline{x}y} P^{'}$ and $P\dot{\sim}Q$ imply $Q \xrightarrow{\overline{x}y} Q^{'}$ and $P^{'} \dot{\sim} Q^{'}$ which imply that $((\nu z)P^{'}, (\nu z)Q^{'})$ is in $Res(\dot{\sim})$.
	  \item[$Cong(1)$]
	    for lemma \ref{moveCongDownNorm2} we can assume that the proof tree of $(\nu x)P \xrightarrow{\widetilde{x(y)}} P^{'}$ ends in the following way:
	    \begin{center}
	      $\inferrule* [left=\bf{Cong}]{
		  (\nu z)P \equiv R
		\\
		  R \xrightarrow{\widetilde{x(y)}}_{n} P^{'}
	      }{
		(\nu z)P \xrightarrow{\widetilde{x(y)}} P^{'}
	      }$
	    \end{center}
	    where $R$ is in normal form and the top level of $R$ is not a restriction. At this point the last rule of a derivation of $R \xrightarrow{\widetilde{x(y)}}_{n} P^{'}$ can be: 
	    \begin{description}	
	      \item[$Inp$] 
		this case does not exist because $(\nu a)B \not \equiv c(d).E$
	      \item[$LComSeq$]\hfill \\
		\begin{center}
		  $\inferrule* [left=\bf{LComSeq1}]{
			  (\nu \tilde{a})R_{1} \xrightarrow{x(y)\cdot \sigma}_{n} (\nu \tilde{b})R_{1}^{'}
			\\
			  (\nu \tilde{c})R_{2} \xrightarrow{\overline{x}z}_{n} (\nu \tilde{d})R_{2}^{'}
			\\
			  bn(\sigma)\cap fn(Q) = \emptyset
		      }{
			(\nu \tilde{a} \tilde{c}) (R_{1}|R_{2}) \xrightarrow{\sigma\{z/y\}}_{n} (\nu \tilde{b} \tilde{d})(R_{1}^{'}|R_{2}^{'})
		      }$
		\end{center}
		$(\nu z)P \equiv (\nu \tilde{a} \tilde{c}) (R_{1}|R_{2})$ and $\sigma\{z/y\}=\widetilde{x(y)}$.
	      \item[$Sum1,2$]
	      \item[$Res$]
	      \item[$Par1,2$]
	    \end{description}
	\end{description}
    \begin{description}
      \item[Parallel] ?
    \end{description}
  \end{proof}
\end{proposition}


% 
% \subsection{Strong equivalence and distinctions}
% \subsection{Properties of strong bisimilarity}
% \subsection{Properties of strong $D-$ equivalence}