
\section{Syntax}
As we did whit $\pi$ calculus, we suppose that we have a countable set of names $\mathbb{N}$, ranged over by lower case letters $a,b, \cdots, z$. This names are used for communication channels and values. Furthermore we have a set of identifiers, ranged over by $A$. We represent the agents or processes by upper case letters $P,Q, \cdots $. A multi $\pi$ process, in addiction to the same actions of a $\pi$ process, can perform also a strong prefix output:
\begin{center}
  $\pi$ ::= $\overline{x}y$ | $x(z)$ | $\underline{\overline{x}y}$ | $\tau$ 
\end{center}
The process are defined, just as original $\pi$ calculus, by the following grammar:
\begin{center}
  \begin{tabular}{l}
    $P,Q$ ::= $0$ | $\pi.P$ | $P|Q$ | $P+Q$ | $(\nu x) P$ | $A(y_{1}, \cdots, y_{n})$
  \end{tabular}
\end{center}
and they have the same intuitive meaning as for the $\pi$ calculus. The strong prefix output allows a process to make an atomic sequence of actions, so that more than one process can synchronize on this sequence. For the moment we allow the strong prefix to be on output names only. Also one can use the strong prefix only as an action prefixing for processes that can make at least a further action. 

Multi $\pi$ calculus is a conservative extension of the $\pi$ calculus in the sense that: any $\pi$ calculus process $p$ is also a multi $\pi$ calculus process and the semantic of $p$ according to the SOS rules of $\pi$ calculus is the same as the semantic of $p$ according to the SOS rules of multi $\pi$ calculus. 

We have to extend the following definition to deal with the strong prefix:
\begin{center}
  \begin{tabular}{ll}
	$B(\underline{\overline{x}y}.Q, I) = B(Q,I)$
      &
	$F(\underline{\overline{x}y}.Q, I) = \{x,\overline{x},y,\overline{y}\}\cup F(Q, I)$
    \\
  \end{tabular}
\end{center}


\section{Operational semantic}
\subsection{Early operational semantic with structural congruence}

The semantic of a multi $\pi$ process is labeled transition system such that
\begin{itemize}
  \item 
    the nodes are multi $\pi$ calculus process. The set of node is $\mathbb{P}_{m}$
  \item
    the actions are multi $\pi$ calculus actions. The set of actions is $\mathbb{A}_{m}$, we use $\alpha, \alpha_{1}, \alpha_{2},\cdots $ to range over the set of actions, we use $\sigma, \sigma_{1}, \sigma_{2}, \cdots $ to range over the set $\mathbb{A}_{m}^{+} \cup \{\tau\}$. Note that $\sigma$ is a non empty sequence of actions.
  \item
    the transition relations is $\rightarrow\subseteq \mathbb{P}_{m}\times (\mathbb{A}_{m}^{+} \cup \{\tau\})\times \mathbb{P}_{m}$
\end{itemize}

In this case, a label can be a sequence of prefixes, whether in the original $\pi$ calculus a label can be only a prefix. We use the symbol $\cdot$ to denote the concatenation operator.

\begin{definition}
  The \emph{early transition relation} is the smallest relation induced by the rules in table \ref{multipiearlywith}. 
% The relation $opn$ is defined in table \ref{opn}.
  \begin{table}
    \begin{tabular}{lll}
      \hline\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \xrightarrow{\overline{x}y} P
	  }$
	&
	  $\inferrule* [left=\bf{EInp}]{
	  }{
	    x(y).P \xrightarrow{xz} P\{z/y\}
	  }$
	&
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \xrightarrow{\tau} P
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{SOutSeq}]{
	      P \xrightarrow{\sigma} Q
	    \\
	      |\sigma|>1
	  }{
	    \underline{\overline{x}y}.P \xrightarrow{\overline{x}y \cdot \sigma} Q
	  }$
	&
	  $\inferrule* [left=\bf{SOut}]{
	      P \xrightarrow{\alpha} Q
	    \\
	      \alpha\; output
	  }{
	    \underline{\overline{x}y}.P \xrightarrow{\overline{x}y \cdot \alpha} Q
	  }$
	&
	  $\inferrule* [left=\bf{SOutTau}]{
	    P \xrightarrow{\tau} Q
	  }{
	    \underline{\overline{x}y}.P \xrightarrow{\overline{x}y} Q
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{EComSng}]{
	      P \xrightarrow{\overline{x}y} P^{'}
	    \\
	      Q \xrightarrow{xy} Q^{'}
	  }{
	    P|Q \xrightarrow{\tau} P^{'}|Q^{'}
	  }$
	&
	  $\inferrule* [left=\bf{EComSeq}]{
	      P \xrightarrow{\overline{x}y\cdot \sigma} P^{'}
	    \\
	      Q\xrightarrow{xy} Q^{'}
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q^{'}
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{Cong}]{
	      P\equiv P^{'}
	    \\
	      P^{'} \xrightarrow{\sigma} Q
	  }{
	      P \xrightarrow{\sigma} Q
	  }$
	&
	  $\inferrule* [left=\bf{Par}]{
	    P \xrightarrow{\sigma} P^{'}
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q
	  }$
      \\\\
	  $\inferrule* [left=\bf{Sum}]{
	    P \xrightarrow{\sigma} P^{'}
	  }{
	    P+Q \xrightarrow{\sigma} P^{'}
	  }$
% 	  $\inferrule* [left=\bf{OpnSeq}]{
% 	      P \xrightarrow{\sigma} P^{'}
% 	    \\ 
% 	      \exists \overline{x}z\in \sigma: x\neq z
% 	  }{
% 	      (\nu z)P \xrightarrow{opn(\sigma,z)} P^{'}
% 	  }$
	&
	  $\inferrule* [left=\bf{Res}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      z\notin n(\alpha)
	  }{
	    (\nu) z P \xrightarrow{\sigma} (\nu) z P^{'}
	  }$
      \\\\\hline
    \end{tabular}
    \caption{Multi $\pi$ early semantic with structural congruence}
    \label{multipiearlywith}
  \end{table}


%   \begin{table}
%     \begin{tabular}{lll}
%       \hline\\
% 	  $\inferrule* {
% 	      x\neq z
% 	  }{
% 	      opn(\overline{x}z,z)=\overline{x}(z)
% 	  }$
% 	&
% 	  $\inferrule* {
% 	      x\neq z
% 	  }{
% 	      opn(\overline{x}z\cdot \sigma,z)=\overline{x}(z)\cdot opn(\sigma,z)
% 	  }$
% 	&
%       \\\\
% 	  $\inferrule* {
% 	    y\neq z
% 	  }{
% 	      opn(\overline{x}y,z)=\overline{x}y
% 	  }$
% 	&
% 	  $\inferrule* {
% 	    y\neq z
% 	  }{
% 	      opn(\overline{x}y\cdot \sigma,z)=\overline{x}y\cdot opn(\sigma,z)
% 	  }$
% 	&
%       \\\\\hline
%     \end{tabular}
%     \caption{relation $opn$}
%     \label{opn}
%   \end{table}


\end{definition}


\begin{lemma}\label{lemmastrongsequenceoutonly}
  If $P\xrightarrow{\sigma} Q$ then only one of the following cases hold: 
  \begin{itemize}
    \item 
      $|\sigma|=1$
    \item
      $|\sigma|>1$ and all the actions are output.
  \end{itemize}
\end{lemma}




\begin{example}Multi-party synchronization.
  We show an example of a derivation of three processes that synchronize.
\begin{center}
$\inferrule* [left=\bf{Res}]{
    x\notin n(\tau)
   \\
    \inferrule* [left=\bf{EComSeq}]{
	  \underline{\overline{x}y}.\overline{x}y.0|x(y).0
	    \xrightarrow{\overline{x}y}
	      0|0
      \\
	\inferrule* [left=\bf{Inp}]{
	}{
	  x(y).0	
	    \xrightarrow{xy} 
	      0
	}
    }{
      ((\underline{\overline{x}y}.\overline{x}y.0|x(y).0)|x(y).0)
	\xrightarrow{\tau}
	  ((0|0)|0)
    }
  }{
    (\nu x)((\underline{\overline{x}y}.\overline{x}y.0|x(y).0)|x(y).0)
      \xrightarrow{\tau}
	(\nu x)((0|0)|0)
}$
\end{center}

\begin{center}
$\inferrule* [left=\bf{EComSng}]{
  \inferrule* [left=\bf{SOut}]{
    \inferrule* [left=\bf{Out}]{
    }{
      \overline{x}y.0
	\xrightarrow{\overline{x}y}
	  0
    }
  }{
    \underline{\overline{x}y}.\overline{x}y.0
      \xrightarrow{\overline{x}y\cdot \overline{x}y}
	0
  }
  \\
    x(y).0 \xrightarrow{xy} 0
}{
  \underline{\overline{x}y}.\overline{x}y.0|x(y).0
    \xrightarrow{\overline{x}y}
      0|0
}$
\end{center}

\end{example}

\begin{example}Transactional synchronization
  In this setting two process cannot synchronize on a sequence of actions with length greater than one. This is because of the rules $EComSng$ and $EComSeq$.
\end{example}








\subsection{Low level semantic}
This section contains the definition of an alternative semantic for multi $\pi$. First we define a low level version of the multi $\pi$ calculus(here with strong prefixing on output only), we call this language low multi $\pi$. The low multi $\pi$ is the multi $\pi$ enriched with a marked or intermediate process $*P$:
\begin{center}
   \begin{tabular}{l}
     $P,Q$ ::= $0$ | $\pi.P$ | $P|Q$ | $P+Q$ | $(\nu x) P$ | $A$ | $*P$
   \\\\
     $\pi$ ::= $\overline{x}y$ | $x(y)$ | $\underline{\overline{x}y}$ | $\tau$ 
   \end{tabular}
\end{center}
\begin{definition}
  The low level transition relation is the smallest relation induced by the rules in table \ref{lowleveltransitionrelationearlyoutonly} in which $P$ stands for a process without mark, $L$ stands for a process with mark and $S$ can stand for both. 
  \begin{table}
    \begin{tabular}{lll}
      \hline\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \stackrel{\overline{x}y}{\longmapsto} P
	  }$
	  &
	  $\inferrule* [left=\bf{EInp}]{
	  }{
	    x(y).P \stackrel{xz}{\longmapsto} P\{z/y\}
	  }$
	  &
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \stackrel{\tau}{\longmapsto} P
	  }$
      \\
    \end{tabular}
    \\
    \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{SOutLow}]{
	  }{
	    \underline{\overline{x}y}.P \stackrel{\overline{x}y}{\longmapsto} * P
	  }$
	  &
	  $\inferrule* [left=\bf{StarEps}]{
	      S \stackrel{\epsilon}{\longmapsto} S^{'}
	  }{
	      *S \stackrel{\epsilon}{\longmapsto} S^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{StarOut}]{
	      S \stackrel{\overline{x}y}{\longmapsto} S^{'}
	  }{
	      *S \stackrel{\overline{x}y}{\longmapsto} S^{'}
	  }$
      \\
    \end{tabular}
    \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{Com1}]{
	      P \stackrel{\overline{x}y}{\longmapsto} P^{'}
	    \\
	      Q \stackrel{xy}{\longmapsto} Q^{'}
	  }{
	    P|Q \stackrel{\tau}{\longmapsto} P^{'}|Q^{'}
	  }$
	  &
       \\\\
	  $\inferrule* [left=\bf{Com2L}]{
	      L_{1} \stackrel{\overline{x}y}{\longmapsto} L_{1}^{'}
	    \\
	      P \stackrel{xy}{\longmapsto} Q
	  }{
	    L_{1}|P \stackrel{\epsilon}{\longmapsto} L_{1}^{'}|Q
	  }$
	  &
	  $\inferrule* [left=\bf{Com2R}]{
	      P \stackrel{xy}{\longmapsto} Q
	    \\
	      L_{1} \stackrel{\overline{x}y}{\longmapsto} L_{1}^{'}
	  }{
	    P|L_{1} \stackrel{\epsilon}{\longmapsto} Q|L_{1}^{'}
	  }$
      \\\\
	  $\inferrule* [left=\bf{Com3L}]{
	      P \stackrel{\overline{x}y}{\longmapsto} L
	    \\
	      Q \stackrel{xy}{\longmapsto} Q^{'}
	  }{
	    P|Q \stackrel{\epsilon}{\longmapsto} L|Q^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Com3R}]{
	      P \stackrel{xy}{\longmapsto} P^{'}
	    \\
	      Q \stackrel{\overline{x}y}{\longmapsto} L
	  }{
	    P|Q \stackrel{\epsilon}{\longmapsto} P^{'}|L
	  }$
       \\\\
	  $\inferrule* [left=\bf{Com4L}]{
	      L \stackrel{\overline{x}y}{\longmapsto} Q
	    \\
	      P \stackrel{xy}{\longmapsto} P^{'}
	  }{
	    L|P \stackrel{\tau}{\longmapsto} Q|P^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Com4R}]{
	      P \stackrel{xy}{\longmapsto} P^{'}
	    \\
	      L \stackrel{\overline{x}y}{\longmapsto} Q
	  }{
	    P|L \stackrel{\tau}{\longmapsto} P^{'}|Q
	  }$
      \\
    \end{tabular}
    \\
    \begin{tabular}{lll}
      \\
	  $\inferrule* [left=\bf{Res}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
	    \\
	      y\notin n(\gamma)
	  }{
	    (\nu y) S \stackrel{\gamma}{\longmapsto} (\nu y) S^{'}
	  }$
	  &
	  $\inferrule* [left=\bf{Sum}]{
	    P \stackrel{\gamma}{\longmapsto} S
	  }{
	    P+Q \stackrel{\gamma}{\longmapsto} S
	  }$
	  &
	  $\inferrule* [left=\bf{Cong}]{
	      P\equiv P^{'}
	    \\
	      P^{'} \stackrel{\gamma}{\longmapsto} S
	  }{
	      P \stackrel{\gamma}{\longmapsto} S
	  }$

      \\
    \end{tabular}
    \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{Par1L}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
% 	    \\ 
% 	      bn(\gamma)\cap fn(Q)=\emptyset
	  }{
	      S|Q \stackrel{\gamma}{\longmapsto} S^{'}|Q
	  }$
	  &
	  $\inferrule* [left=\bf{Par1R}]{
	      S \stackrel{\gamma}{\longmapsto} S^{'}
% 	    \\ 
% 	      bn(\gamma)\cap fn(Q)=\emptyset
	  }{
	      Q|S \stackrel{\gamma}{\longmapsto} Q|S^{'}
	  }$

% 	  $\inferrule* [left=\bf{Opn}]{
% 	      S \xrightarrow{\overline{x}y} S^{'}
% 	  }{
% 	      (\nu y)P \xrightarrow{\overline{x}(y)} P^{'}
% 	  }$
%       \\\\\\
% 	  $\inferrule* [left=\bf{Par2L}]{
% 	     P \stackrel{\gamma}{\longmapsto} L
% % 	    \\ 
% % 	      bn(\gamma)\cap fn(Q)=\emptyset
% 	  }{
% 	      P|Q \stackrel{\gamma}{\longmapsto} L|*Q
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{Par2R}]{
% 	     P \stackrel{\gamma}{\longmapsto} L
% % 	    \\ 
% % 	      bn(\gamma)\cap fn(Q)=\emptyset
% 	  }{
% 	      Q|P \stackrel{\gamma}{\longmapsto} *Q|L
% 	  }$
%       \\\\
% 	  $\inferrule* [left=\bf{Par3L}]{
% 	      L_{1} \stackrel{\gamma}{\longmapsto} L_{1}^{'}
% % 	    \\ 
% % 	      bn(\gamma)\cap fn(L_{2})=\emptyset
% 	  }{
% 	      L_{1}|L_{2} \stackrel{\gamma}{\longmapsto} L_{1}^{'}|L_{2}
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{Par3R}]{
% 	      L_{2} \stackrel{\gamma}{\longmapsto} L_{2}^{'}
% % 	    \\ 
% % 	      bn(\gamma)\cap fn(L_{2})=\emptyset
% 	  }{
% 	      L_{1}|L_{2} \stackrel{\gamma}{\longmapsto} L_{1}|L_{2}^{'}
% 	  }$
      \\\\\hline
    \end{tabular}
    \caption{Low multi $\pi$ early semantic with structural congruence}
    \label{lowleveltransitionrelationearlyoutonly}
  \end{table}
\end{definition}

\begin{lemma}\label{multioutconstraintswithmarked}
  For all unmarked processes $P,Q$ and marked processes $L, L_{1}, L_{2}$.
  \begin{itemize}
    \item
      if $L_{1}\stackrel{\alpha}{\longmapsto}L_{2}$ or  $P\stackrel{\alpha}{\longmapsto}L$ then $\alpha$ can only be an output or an $\epsilon$
    \item
      if $L\stackrel{\alpha}{\longmapsto}P$ then $\alpha$ can only be an output or a $\tau$
    \item
      if $P\stackrel{\alpha}{\longmapsto}Q$ then $\alpha$ cannot be an $\epsilon$
  \end{itemize}
\end{lemma}


\begin{definition}
  Let $P, Q$ be unmarked processes and $L_{1}, \cdots, L_{k-1}$ marked processes. We define the derivation relation $\rightarrow_{s}$ in the following way:
  \begin{center}
    $\inferrule* [left=\bf{Low}]{
	P \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} Q
      \\
	k\geq 1
    }{
      P \xrightarrow{\gamma_{1} \cdots \gamma_{k}}_{s}  Q
    }$
  \end{center}
  We need to be precise about the concatenation operator $\cdot$ since we have introduced the new label $\epsilon$. Let $a$ be an action such that $a\neq \tau$ and $a\neq \epsilon$ then the following rules hold:
  \begin{center}
      \begin{tabular}{lll}
	  $\epsilon \cdot a = a \cdot \epsilon = a$
	&
	  $\epsilon \cdot \epsilon = \epsilon$
	&
	  $\tau \cdot \epsilon = \epsilon \cdot \tau = \tau$
	\\
	  $\tau \cdot a = a \cdot \tau = a$
	&
	  $\tau \cdot \tau = \tau$
	&
      \end{tabular}
  \end{center}
\end{definition}


\begin{example}Multi-parti synchronization
  \begin{center}
    $\inferrule* [left=\bf{Par1L}]{
      \inferrule* [left=\bf{Par1L}]{
	\inferrule* [left=\bf{Com3L}]{
	  \inferrule* [left=\bf{SOutLow}]{
	  }{
	    \underline{\overline{x}a}.\overline{x}b.\overline{x}c.P \stackrel{\overline{x}a}{\longmapsto} * \underline{\overline{x}b}.\overline{x}c.P
	  }
	\\
	  \inferrule* [left=\bf{Inp}]{
	  }{
	    x(d).Q \xrightarrow{xa} Q\{a/d\}
	  }
      }{
	\underline{\overline{x}a}.\underline{\overline{x}b}.\overline{x}c.P | x(d).Q 
	  \stackrel{\epsilon}{\longmapsto}
	    * \underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\}
      }
    }{
	\underline{\overline{x}a}.\underline{\overline{x}b}.\overline{x}c.P | x(d).Q | x(e).R
	  \stackrel{\epsilon}{\longmapsto}
	    * \underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\} | x(e).R
    }}{
	\underline{\overline{x}a}.\underline{\overline{x}b}.\overline{x}c.P | x(d).Q | x(e).R | x(f).S
	  \stackrel{\epsilon}{\longmapsto}
	    * \underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\} | x(e).R | x(f).S
    }$
  \end{center}

  \begin{center}
    $\inferrule* [left=\bf{Par1L}]{
      \inferrule* [left=\bf{Com2L}]{
      \inferrule* [left=\bf{Par1L}]{
	\inferrule* [left=\bf{StarOut}]{
	  \inferrule* [left=\bf{SOutLow}]{
	  }{
	    \underline{\overline{x}b}.\overline{x}c.P \stackrel{\overline{x}b}{\longmapsto} *\overline{x}c.P
	  }
	}{
	  * \underline{\overline{x}b}.\overline{x}c.P \stackrel{\overline{x}b}{\longmapsto} *\overline{x}c.P
	}
      }{
	* \underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\}  \stackrel{\overline{x}b}{\longmapsto} * \overline{x}c.P | Q\{a/d\} 
      }
      \\
      \inferrule* [left=\bf{EInp}]{
      }{
	x(e).R  \stackrel{xb}{\longmapsto} R\{b/e\}
      }
    }{
      *\underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\} | x(e).R  \stackrel{\epsilon}{\longmapsto} * \overline{x}c.P | Q\{a/d\} | R\{b/e\}
    }}{
      *\underline{\overline{x}b}.\overline{x}c.P | Q\{a/d\} | x(e).R | x(f).S 
	\stackrel{\epsilon}{\longmapsto} 
	  * \overline{x}c.P | Q\{a/d\} | R\{b/e\} | x(f).S
    }$
  \end{center}

  \begin{center}
    $\inferrule* [left=\bf{Com4L}]{
      \inferrule* [left=\bf{Par1L}]{
      \inferrule* [left=\bf{Par1L}]{
	\inferrule* [left=\bf{StarOut}]{
	  \inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}c.P \stackrel{\overline{x}c}{\longmapsto} P
	  }
	}{
	  * \overline{x}c.P \stackrel{\overline{x}c}{\longmapsto} P
	}
      }{
	*\overline{x}c.P | Q\{a/d\}  \stackrel{\overline{x}c}{\longmapsto} P | Q\{a/d\} 
      }}{
	*\overline{x}c.P | Q\{a/d\} | R\{b/e\}  \stackrel{\overline{x}c}{\longmapsto} P | Q\{a/d\} | R\{b/e\}
      }
      \\
      \inferrule* [left=\bf{EInp}]{
      }{
	x(f).S  \stackrel{xc}{\longmapsto} R\{c/f\}
      }
    }{
      *\overline{x}c.P | Q\{a/d\} | R\{b/e\} | x(f).S  \stackrel{\tau}{\longmapsto} P | Q\{a/d\} | R\{b/e\} | S\{c/f\}
    }$
  \end{center}


\end{example}












\begin{proposition}\label{equivalencehightolow}
  Let $\rightarrow$ be the relation defined in table \ref{multipiearlywith}. If $P\xrightarrow{\sigma} Q$ then there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
  \begin{center}
    \begin{tabular}{lll}
      $P \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
    &
      and
    &
      $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \sigma$  
    \end{tabular}
  \end{center}
  \begin{proof}
    The proof is by induction on the depth of the derivation tree of $P\xrightarrow{\sigma} Q$:
    \begin{description}
      \item[base case]
    \end{description}
	If the depth is one then the rule used has to be one of: $EInp$, $Out$, $Tau$. These rules are also in table \ref{lowleveltransitionrelationearlyoutonly} so we can derive $P \stackrel{\sigma}{\longmapsto}Q$.
    \begin{description}
      \item[inductive case]
    \end{description}
	If the depth is greater than one then the last rule used in the derivation can be:
	\begin{description}
	  \item[$SOutSeq$]: 
	    the last part of the derivation tree looks like this:
	    \begin{center}
	      $\inferrule* [left=\bf{SOutSeq}]{
		  P_{1} \xrightarrow{\sigma} Q
		\\
		  |\sigma|>1
	      }{
		\underline{\overline{x}y}.P_{1} \xrightarrow{\overline{x}y \cdot \sigma} Q
	      }$	      
	    \end{center}
	    for inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	    \begin{center}
	      \begin{tabular}{lll}
		$P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	      &
		and
	      &
		$\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$
	      \end{tabular}
	    \end{center}
	    then a proof of the conclusion follows from:
	    \begin{center}
	      \begin{tabular}{ll}
		$\inferrule* [left=\bf{SOutLow}]{
 		}{
 		  \underline{\overline{x}y}.P_{1} \stackrel{\overline{x}y}{\longmapsto} *P_{1}
 		}$
	      &
		$\inferrule* [left=\bf{Star}]{
 		  P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
 		}{
 		  *P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
 		}$
	      \end{tabular}
	    \end{center}
	  \item[$SOut$]: this case is similar to the previous.
	  \item[$SOutTau$]: this case is similar to the previous observing that $\overline{x}y \cdot \tau = \overline{x}y$.
	  \item[$Sum$]: 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{Sum}]{
	    P_{1} \xrightarrow{\sigma} Q
	  }{
	    P_{1}+P_{2} \xrightarrow{\sigma} Q
	  }$
	\end{center}
	for the inductive hypothesis there exist $L_{1}$, $\cdots$, $L_{k}$ and $\gamma_{1}$, $\cdots$, $\gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$  
	  \end{tabular}
	\end{center}
	A proof of the conclusion is:
	\begin{center}
	  $\inferrule* [left=\bf{Sum}]{
	      P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	    }{
	      P_{1}+P_{2} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	    }
	  $
	\end{center}
      \item[$Cong$]: this case is similar to the previous.
      \item[$EComSng$]: 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{Com}]{
	      P_{1} \xrightarrow{\overline{x}y} P_{1}^{'}
	    \\
	      Q_{1} \xrightarrow{xy} Q_{1}^{'}
	  }{
	    P_{1}|Q_{1} \xrightarrow{\tau} P_{1}^{'}|Q_{1}^{'}
	  }$
	\end{center}
	for inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \overline{x}y$
	  \end{tabular}
	\end{center}
	and there exist $R_{1}, \cdots, R_{h}$ and $\delta_{1}, \cdots, \delta_{h+1}$ with $h\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $Q_{1} \stackrel{\delta_{1}}{\longmapsto} R_{1}  \stackrel{\delta_{2}}{\longmapsto} R_{2} \cdots R_{h-1} \stackrel{\delta_{h}}{\longmapsto} R_{h} \stackrel{\delta_{h+1}}{\longmapsto} Q_{1}^{'}$ 
	  &
	    and
	  &
	    $\delta_{1} \cdot \ldots \cdot \delta_{h+1} = xy$
	  \end{tabular}
	\end{center}
	For lemma \ref{multioutconstraintswithmarked} there cannot be an input action in a transition involving marked processes so $h$ must be $0$ and $Q_{1} \stackrel{\delta_{1}}{\longmapsto} Q_{1}^{'}$ with $\delta_{1}=xy$. Just one of the $\gamma$s is $\overline{x}y$ and the others are $\epsilon$ or $\tau$. We can have three different cases now: 
	\begin{description}
	  \item[$\gamma_{1}=\overline{x}y$]:
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\tau}{\longmapsto} L_{1}|Q_{1}^{'}
			      \stackrel{\epsilon}{\longmapsto} L_{2}|Q_{1}^{'}
		  \cdots
				\stackrel{\epsilon}{\longmapsto} L_{k}|Q_{1}^{'}
				\stackrel{\tau}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the first transition with rule $Com3L$, whether for the other transition we use the rule $Par1L$.
	  \item[$\gamma_{i}=\overline{x}y$]:
	    A proof of the conclusion is:
	    \begin{center}
	      $
		  P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1} 
		  \cdots
			      \stackrel{\epsilon}{\longmapsto} L_{i-1}|Q_{1} 
			      \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}
			      \stackrel{\epsilon}{\longmapsto} L_{i+1}|Q_{1}^{'}
		  \cdots 
			      \stackrel{\epsilon}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\tau}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the transaction $ L_{i-1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}$ with rule $Com2L$, whether for the other transactions  we use the rule $Par1L$.
	  \item[$\gamma_{k+1}=\overline{x}y$] similar.
	\end{description}
      \item[$Res$]: 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{Res}]{
	      P_{1}\; \xrightarrow{\sigma}\; Q_{1}
	    \\
	      z\notin n(\sigma)
	  }{
	    (\nu z) P_{1} \;\xrightarrow{\sigma} (\nu z) Q_{1}
	  }$
	\end{center}
	for the inductive hypothesis there exist $L_{1}, \cdots, L_{k}$ and $\gamma_{1}, \cdots, \gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q_{1}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$
	  \end{tabular}
	\end{center}
	We can apply the rule $Res$ to each of the previous transitions because 
	\begin{center}
	  $z\notin n(\sigma)$ implies $z\notin n(\gamma_{i})$ for each $i$
	\end{center}
	and then get a proof of the conclusion:
	\begin{center}
	  $(\nu z)P_{1} \stackrel{\gamma_{1}}{\longmapsto} (\nu z)L_{1}  \stackrel{\gamma_{2}}{\longmapsto} (\nu z)L_{2} \cdots (\nu z)L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} (\nu z)L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} (\nu z)Q_{1}$
	\end{center}
      \item[$Par$]: this case is similar to the previous.
      \item[$EComSeq$]: 
	the last part of the derivation tree looks like this:
	\begin{center}
	  $\inferrule* [left=\bf{EComSeq}]{
	      P_{1} \xrightarrow{\overline{x}y \cdot \sigma} P_{1}^{'}
	    \\
	      Q_{1} \xrightarrow{xy} Q_{1}^{'}
	  }{
	    P_{1}|Q_{1} \xrightarrow{\sigma} P_{1}^{'}|Q_{1}^{'}
	  }$
	\end{center}
	for inductive hypothesis there exist $L_{1}$, $\cdots$, $L_{k}$ and $\gamma_{1}$, $\cdots$, $\gamma_{k+1}$ with $k\geq 0$ such that 
	\begin{center}
	  \begin{tabular}{lll}
	    $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}$ 
	  &
	    and
	  &
	    $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \overline{x}y \cdot \sigma$  
	  \end{tabular}
	\end{center}
	For inductive hypothesis and lemma \ref{multioutconstraintswithmarked} $Q_{1} \stackrel{xy}{\longmapsto} Q_{1}^{'}$. We can have two different cases now depending on where the first $\overline{x}y$ is:
	\begin{description}
	  \item[$\gamma_{1}=\overline{x}y$]:
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1}^{'}
			      \stackrel{\gamma_{2}}{\longmapsto} L_{2}|Q_{1}^{'}
		  \cdots
			      \stackrel{\gamma_{k}}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the first transition with rule $Com3L$, whether for the other transactions we use the rule $Par1L$. Since $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} = \overline{x}y \cdot \sigma$ and $\gamma_{1}=\overline{x}y$ then $\epsilon \cdot \gamma_{2}\cdot \ldots \cdot \gamma_{k+1}=\sigma$
	  \item[$\gamma_{i}=\overline{x}y$]:
	    A proof of the conclusion is:
	    \begin{center}
	      $P_{1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{1}|Q_{1} 
		  \cdots
			      \stackrel{\epsilon}{\longmapsto} L_{i-1}|Q_{1} 
			      \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}
			      \stackrel{\gamma_{i+1}}{\longmapsto} L_{i+1}|Q_{1}^{'}
		  \cdots 
			      \stackrel{\gamma_{k}}{\longmapsto} L_{k}|Q_{1}^{'}
			      \stackrel{\gamma_{k+1}}{\longmapsto} P_{1}^{'}|Q_{1}^{'}$	  
	    \end{center}
	    we derive the transition $ L_{i-1}|Q_{1} \stackrel{\epsilon}{\longmapsto} L_{i}|Q_{1}^{'}$ with rule $Com2L$, whether for the other transactions of the premises we use the rule $Par1L$.
	  \item[$\gamma_{k+1}=\overline{x}y$]: cannot happen because $\sigma$ is not empty.
	\end{description}
    \end{description}
  \end{proof}
\end{proposition}


We would like to prove the converse of the previous proposition, namely: if there exist $L_{1}$, $\cdots$, $L_{k}$ and $\gamma_{1}$, $\cdots$, $\gamma_{k+1}$ with $k\geq 0$ such that 
  \begin{center}
    \begin{tabular}{lll}
      $P \stackrel{\gamma_{1}}{\longmapsto} L_{1}  \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
    &
      and
    &
      $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$  
    \end{tabular}
  \end{center}
  then $P\xrightarrow{\sigma} Q$. But this is false as shown by those examples:

\begin{example}Interleaving
  \begin{center}
  $\inferrule* [left=\bf{Par1L}]{
    \inferrule* [left=\bf{Com3L}]{
	\inferrule* [left=\bf{SOutLow}]{
	}{
	  \underline{\overline{x}y}.\underline{\overline{a}b}.\overline{x}y.0 
	    \stackrel{\overline{x}y}{\longmapsto} 
	      *\underline{\overline{a}b}.\overline{x}y.0 
	}
      \\
	\inferrule* [left=\bf{EInp}]{
	}{
	  x(y).0
	    \stackrel{xy}{\longmapsto} 
	      0 
	}
    }{
      \underline{\overline{x}y}.\underline{\overline{a}b}.\overline{x}y.0 | x(y).0 
	\stackrel{\epsilon}{\longmapsto} 
	  *\underline{\overline{a}b}.\overline{x}y.0 | 0 
    }
  }{
    \underline{\overline{x}y}.\underline{\overline{a}b}.\overline{x}y.0 | x(y).0 | x(y).0 
      \stackrel{\epsilon}{\longmapsto} 
	*\underline{\overline{a}b}.\overline{x}y.0 | 0 | x(y).0
  }$
  \end{center}
  \begin{center}
  $\inferrule* [left=\bf{Par1L}]{
    \inferrule* [left=\bf{Par1L}]{
    \inferrule* [left=\bf{StarOut}]{
	\inferrule* [left=\bf{SOutLow}]{
	}{
	  \underline{\overline{a}b}.\overline{x}y.0 
	    \stackrel{\overline{a}b}{\longmapsto} 
	      *\overline{x}y.0 
	}
    }{
      *\underline{\overline{a}b}.\overline{x}y.0 
	\stackrel{\overline{a}b}{\longmapsto} 
	  *\overline{x}y.0 
    }
  }{
    *\underline{\overline{a}b}.\overline{x}y.0 | 0 
      \stackrel{\overline{a}b}{\longmapsto} 
	*\overline{x}y.0 | 0 
  }
  }{
    *\underline{\overline{a}b}.\overline{x}y.0 | 0 | x(y).0 
      \stackrel{\overline{a}b}{\longmapsto} 
	*\overline{x}y.0 | 0 | x(y).0
  }$
  \end{center}
  \begin{center}
  $\inferrule* [left=\bf{Com4L}]{
    \inferrule* [left=\bf{Par1L}]{
	\inferrule* [left=\bf{StarOut}]{
	  \inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.0
	      \stackrel{\overline{x}y}{\longmapsto} 
		0
	  }
	}{
	  *\overline{x}y.0
	    \stackrel{\overline{x}y}{\longmapsto} 
	      0
	}
    }{
    *\overline{x}y.0 | 0
      \stackrel{\overline{x}y}{\longmapsto} 
	0 | 0
    }
    \\
	\inferrule* [left=\bf{EInp}]{
	}{
	  x(y).0
	    \stackrel{xy}{\longmapsto} 
	      0 
	}      
  }{
    *\overline{x}y.0 | 0 | x(y).0 
      \stackrel{\tau}{\longmapsto} 
	0 | 0 | 0
  }$
  \end{center}
  this prove:
  \begin{center}
    $\underline{\overline{x}y}.\underline{\overline{a}b}.\overline{x}y.0 | x(y).0 | x(y).0 
      \stackrel{\epsilon}{\longmapsto} 
	*\underline{\overline{a}b}.\overline{x}y.0 | 0 | x(y).0 
	  \stackrel{\overline{a}b}{\longmapsto} 
	    *\overline{x}y.0 | 0 | x(y).0 
	      \stackrel{\tau}{\longmapsto} 
		0 | 0 | 0$
  \end{center}
  but there is no way to prove 
  \begin{center}
    $\underline{\overline{x}y}.\underline{\overline{a}b}.\overline{x}y.0 | x(y).0 | x(y).0 
      \xrightarrow{\overline{a}b}
	0 | 0 | 0$
  \end{center}
  \end{example}

\begin{example}Transactional synchronization
  \begin{center}
    $\inferrule*[left=\bf{Com3L}]{
      \inferrule*[left=\bf{SOutLow}]{
      }{
	\underline{\overline{x}y}.\overline{x}y.0 
	  \stackrel{\overline{x}y}{\longmapsto}
	    *\overline{x}y.0
      } 
    \\
      \inferrule*[left=\bf{EInp}]{	
      }{
	x(y).x(y).0
	  \stackrel{xy}{\longmapsto}
	    x(y).0
      }
    }{
      \underline{\overline{x}y}.\overline{x}y.0 | x(y).x(y).0
	\stackrel{\epsilon}{\longmapsto}
	  *\overline{x}y.0 | x(y).0
    }$
  \end{center}
  \begin{center}
    $\inferrule*[left=\bf{Com4L}]{
      \inferrule*[left=\bf{StarOut}]{
	\inferrule*[left=\bf{Out}]{
	}{
	  \overline{x}y.0 
	    \stackrel{\overline{x}y}{\longmapsto}
	      0
	} 
      }{
	  *\overline{x}y.0 
	    \stackrel{\overline{x}y}{\longmapsto}
	      0
      }
    \\
      \inferrule*[left=\bf{EInp}]{	
      }{
	x(y).0
	  \stackrel{xy}{\longmapsto}
	    0
      }
    }{
      *\overline{x}y.0 | x(y).0
	\stackrel{\tau}{\longmapsto}
	  0 | 0
    }$
  \end{center}
  this prove:
  \begin{center}
    $\underline{\overline{x}y}.\overline{x}y.0 | x(y).x(y).0
	\stackrel{\epsilon}{\longmapsto}
	  *\overline{x}y.0 | x(y).0
	    \stackrel{\tau}{\longmapsto}
	      0 | 0$
  \end{center}
  but we cannot derive 
  \begin{center}
    $\underline{\overline{x}y}.\overline{x}y.0 | x(y).x(y).0
      \xrightarrow{\tau}
	0 | 0$
  \end{center}
  also we do not want to derive this transaction because the second process does not start with a strong prefix.
\end{example}


There is a much weaker propositions we can prove:
\begin{proposition}
  Let $\rightarrow$ be the relation defined in table \ref{multipiearlywith}. Let $\alpha$ be an action. If $P \stackrel{\alpha}{\longmapsto} Q$ then $P\xrightarrow{\alpha} Q$.
  \begin{proof}
    The proof is by induction the depth of the derivation of $P \stackrel{\alpha}{\longmapsto} Q$:
    \begin{description}
      \item[base case]
	in this case the derivation of this transition has depth one. The last(and only) rule used can be: $Out$, $EInp$ or $Tau$; these rules are also in table \ref{multipisoloinputearlywith} so we can derive $P\xrightarrow{\alpha} Q$. 
      \item[inductive case]
	in this case the last rule in the derivation can be: $Sum$, $Com1$, $Res$, $Par1L$, $Par1R$, $Cong$:
	\begin{description}
	  \item[$Com1$]:
	    \begin{center}
	      $\inferrule* [left=\bf{Com1}]{
		  P_{1} \stackrel{\overline{x}y}{\longmapsto} Q_{1}
		\\
		  P_{2} \stackrel{xy}{\longmapsto} Q_{2}
	      }{
		P_{1}|P_{2} \stackrel{\tau}{\longmapsto} Q_{1}|Q_{2}
	      }$ 
	    \end{center}
	    for inductive hypothesis $P_{1} \xrightarrow{\overline{x}y} Q_{1}$ and $P_{2} \xrightarrow{xy} Q_{2}$ so for rule $Com$ $P_{1}|P_{2} \xrightarrow{\tau} Q_{1}|Q_{2}$
	  \item[$Sum$]:
	    \begin{center}
	      $\inferrule* [left=\bf{Sum}]{
		P_{1} \stackrel{\alpha}{\longmapsto} Q
	      }{
		P_{1}+P_{2} \stackrel{\alpha}{\longmapsto} Q
	      }$ 
	    \end{center}
	    for inductive hypothesis $P_{1} \xrightarrow{\alpha} Q$ and for rule $Sum$ $P_{1}+P_{2} \xrightarrow{\alpha} Q$.
	      \item[$Res$] the first transition is:
		\begin{center}
		  $\inferrule* [left=\bf{Res}]{
			P_{1} \stackrel{\alpha}{\longmapsto} Q_{1}
		      \\
			z\notin n(\gamma_{1})
		    }{
		      (\nu z) P_{1} \stackrel{\alpha}{\longmapsto} (\nu z)Q_{1}
		  }$ 
		\end{center}		
		for inductive hypothesis $P_{1} \xrightarrow{\alpha} Q_{1}$ and for rule $Res$ $(\nu z)P_{1} \xrightarrow{\alpha} (\nu z)Q_{1}$.
	      \item[$others$]: other cases are similar.
	    \end{description}	    
    \end{description}	    
  \end{proof}
\end{proposition}


Since it's important to give a low level semantic which is equivalent to the high level one, we can propose a change to the low level semantic that gets closer to our purpose. We replace the rule $Com3L$, $Com3R$, $Com2L$ and $Com2R$ with:
\begin{center}
  \begin{tabular}{ll}
	  $\inferrule* [left=\bf{Com2LStop}]{
	      L_{1} \stackrel{\overline{x}y}{\longmapsto} L_{2}
	    \\
	      P \stackrel{xy}{\longmapsto} Q
	  }{
	    L_{1}|P \stackrel{\epsilon}{\longmapsto} L_{2}|stop(Q)
	  }$
	  &
	  $\inferrule* [left=\bf{Com2RStop}]{
	      P \stackrel{xy}{\longmapsto} Q
	    \\
	      L_{1} \stackrel{\overline{x}y}{\longmapsto} L_{2}
	  }{
	    P|L_{1} \stackrel{\epsilon}{\longmapsto} stop(Q)|L_{2}
	  }$
      \\\\
	  $\inferrule* [left=\bf{Com3LStop}]{
	      P \stackrel{\overline{x}y}{\longmapsto} L
	    \\
	      Q \stackrel{xy}{\longmapsto} Q^{'}
	  }{
 	    P|Q \stackrel{\epsilon}{\longmapsto} L|stop(Q^{'})
	  }$
	  &
 	  $\inferrule* [left=\bf{Com3RStop}]{
 	      P \stackrel{xy}{\longmapsto} P^{'}
 	    \\
 	      Q \stackrel{\overline{x}y}{\longmapsto} L
 	  }{
 	    P|Q \stackrel{\epsilon}{\longmapsto} stop(P^{'})|L
 	  }$
  \end{tabular}
\end{center}
where $stop(P)$ is a multi $\pi$ process which cannot make any transition.


\begin{definition}
  The \emph{erase function} $er$ is a function that eliminates the $stop$ mark on processes. Its definition is straightforward.
\end{definition}


\begin{proposition}
  Let $\rightarrow$ be the relation defined in table \ref{multipiearlywith}.
  \begin{itemize}
    \item
      If $P\xrightarrow{\sigma} Q$ then there exist $L_{1}, \cdots, L_{k}$ with $k\geq 0$ such that 
      \begin{center}
	\begin{tabular}{lllll}
	  $P 
	    \stackrel{\gamma_{1}}{\longmapsto} 
	      L_{1}  
		\stackrel{\gamma_{2}}{\longmapsto} 
		  L_{2} 
		    \cdots 
		      L_{k-1} 
			\stackrel{\gamma_{k}}{\longmapsto} 
			  L_{k} 
			    \stackrel{\gamma_{k+1}}{\longmapsto} 
			      Q^{'}$ 
	&
	  and
	&
	  $\gamma_{1} \cdot \ldots \cdot \gamma_{k+1} =  \sigma$  
	&
	  and
	&
	  $er(Q^{'})=Q$
	\end{tabular}
      \end{center}
    \item 
      If there exist $L_{1}$, $\cdots$, $L_{k}$ with $k\geq 1$ such that
      \begin{center}
	  $P 
	    \stackrel{\gamma_{1}}{\longmapsto} 
	      L_{1}  
		\stackrel{\gamma_{2}}{\longmapsto} 
		  L_{2} 
		    \cdots 
		      L_{k-1} 
			\stackrel{\gamma_{k}}{\longmapsto} 
			  L_{k} 
			    \stackrel{\gamma_{k+1}}{\longmapsto} 
			      Q$ 
      \end{center}
      where at most one $\gamma$ is an output whether all the other $\gamma$s are $\epsilon$ or $\tau$ then $P\xrightarrow{\tau} er(Q)$ or if there is an output $\overline{x}y$ in the $\gamma$s then $P\xrightarrow{\overline{x}y} er(Q)$. 
  \end{itemize}
  \begin{proof}
    The proof of the first part of this proposition is almost exactly as the proof of proposition \ref{equivalencehightolow}. The proof of the second part is by induction on the depth of the derivation of the first transition:
    \begin{description}
      \item[base case]
 	The last rule in the derivation of $P \stackrel{\gamma_{1}}{\longmapsto} L_{1}$ can be only $SOutLow$:
	    \begin{center}
 		  $\inferrule* [left=\bf{SOutLow}]{
 		    }{
 		      \underbrace{\underline{\overline{x}y}.P_{1}}_{P} \stackrel{\overline{x}y}{\longmapsto} \underbrace{* P_{1}}_{L_{1}}
 		  }$ 
	    \end{center}
	    since $*P_{1}$ has a mark at the top level, the last rule used to derive $*P_{1}\stackrel{\gamma_{2}}{\longmapsto}$ has to be $StarEps$ so we have $P_{1}\stackrel{\gamma_{2}}{\longmapsto}L_{2}$ or $P_{1}\stackrel{\gamma_{2}}{\longmapsto}Q$ depending on $k$. We can build the following chain of transition:
	    \begin{center}
	      $P_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	    \end{center}
	    since $\gamma_{1}$ is an output, the other $\gamma$s are $\epsilon$ or $\tau$, then we can apply the inductive hypothesis to get $P_{1} \xrightarrow{\tau} er(Q)$. Now a proof of the conclusion is
	    \begin{center}
	    $\inferrule* [left=\bf{SOutTau}]{
	      P_{1} \xrightarrow{\tau} er(Q)
	    }{
	      \underline{\overline{x}y}.P_{1} \xrightarrow{\overline{x}y} er(Q)
	    }$
	    \end{center}
      \item[inductive case]
	The last rule in the derivation of $P \stackrel{\gamma_{1}}{\longmapsto} L_{1}$ can be:
	\begin{description}
	  \item[$Sum$] the first transition is:
	    \begin{center}
		  $\inferrule* [left=\bf{Sum}]{
		      P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
		    }{
		      P_{1}+P_{2} \stackrel{\gamma_{1}}{\longmapsto} L_{1}
		  }$ 
	    \end{center}
	    so we can build the following chain of transition:
	    \begin{center}
	      $P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1} \stackrel{\gamma_{2}}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\gamma_{k}}{\longmapsto} L_{k} \stackrel{\gamma_{k+1}}{\longmapsto} Q$ 
	    \end{center}
	    apply the inductive hypothesis to get $P_{1} \xrightarrow{\alpha} er(Q)$ where $\alpha$ is $\tau$ or an output. Now a proof of the conclusion is
	    \begin{center}
	    $\inferrule* [left=\bf{Sum}]{
	      P_{1} \xrightarrow{\alpha} er(Q)
	    }{
	      P_{1}+P_{2} \xrightarrow{\alpha} er(Q)
	    }$
	    \end{center}
	  \item[$Res$] the first transition is:
	    \begin{center}
	      $\inferrule* [left=\bf{Res}]{
		  P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}^{'}
		\\
		  z\notin n(\gamma_{1})
	      }{
		(\nu z) P_{1} \stackrel{\gamma_{1}}{\longmapsto} (\nu z)L_{1}^{'}
	      }$ 
	    \end{center}
	    given that $L_{1}$ has a restriction at the top level, all the other intermediate processes $L_{2}, \cdots, L_{k}$ and $Q$ have the same restriction at the top level. This is because the only rule whose conclusion is a transition that start from a possibly marked process with a restriction at its top level is $Res$. So the last rule used to prove all transition is $Res$.
	    \begin{center}
	      \begin{tabular}{ll}
		$\inferrule* [left=\bf{Res}]{
 			L_{k}^{'} \stackrel{\gamma_{k+1}}{\longmapsto} Q^{'}
 		      \\
 			z\notin n(\tau)
 		    }{
 		      (\nu z)L_{k}^{'} \stackrel{\gamma_{k+1}}{\longmapsto} (\nu z)Q^{'}
 		}$
		&
		$\inferrule* [left=\bf{Res}]{
 			L_{i}^{'} \stackrel{\gamma_{i}}{\longmapsto} L_{i+1}^{'}
 		      \\
 			z\notin n(\epsilon)
 		}{
 		      (\nu z)L_{i}^{'} \stackrel{\gamma_{i}}{\longmapsto} (\nu z)L_{i+1}^{'}
 		}$
	      \end{tabular}
	    \end{center}
	    we can build the following chain of transitions:
	    \begin{center}
	      $P_{1} 
		\stackrel{\gamma_{1}}{\longmapsto} 
		  L_{1}^{'} 
		    \stackrel{\gamma_{2}}{\longmapsto} 
		      L_{2}^{'} 
			\cdots 
			  L_{k-1}^{'} 
			    \stackrel{\gamma_{k}}{\longmapsto} 
			      L_{k}^{'}
				\stackrel{\gamma_{k+1}}{\longmapsto} 
				  Q^{'}$ 
	    \end{center}
	    then apply the inductive hypothesis to get $P_{1} \xrightarrow{\alpha} er(Q^{'})$. A proof of the conclusion can be
	    \begin{center}
	      $\inferrule* [left=\bf{Res}]{
		  P_{1} \xrightarrow{\alpha} er(Q^{'})
		\\
		  z\notin n(\tau)
	      }{
		(\nu z)P_{1} \xrightarrow{\alpha} (\nu z)er(Q^{'})=er((\nu z)Q^{'})
	      }$
	    \end{center}
	  \item[$Cong$]
	    the last rule of the derivation of the first transition is:
	    \begin{center}
	      $\inferrule* [left=\bf{Cong}]{
		  P^{'} \equiv P
		\\
		  \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	      }{
		P \stackrel{\gamma_{1}}{\longmapsto} L_{1}
	      }$ 		      
	    \end{center}
	    We derive the following chain of transition:
	    \begin{center}
 		  $P^{'} 
 		    \stackrel{\gamma_{1}}{\longmapsto} 
 		      L_{1} 
 			\stackrel{\gamma_{2}}{\longmapsto} 
 			  L_{2} 
 			    \cdots 
 			      L_{k-1} 
 				\stackrel{\gamma_{k}}{\longmapsto} 
 				  L_{k}
 				    \stackrel{\gamma_{k+1}}{\longmapsto} 
 				      Q$
	    \end{center}
	    for inductive hypothesis $P^{'} \xrightarrow{\alpha} er(Q)$. A proof of the conclusion is
	    \begin{center}
	      $\inferrule* [left=\bf{Cong}]{
		  P^{'} \equiv P
		\\
		  P^{'} \xrightarrow{\alpha} er(Q)
	      }{
		P \xrightarrow{\alpha} er(Q)
	      }$ 
	    \end{center}
	  \item[$Com3LStop$]: 
	    the last part of the derivation of the first transition is:
	    \begin{center}
	    $\inferrule* [left=\bf{Com3LStop}]{
		P_{1} \stackrel{\overline{x}y}{\longmapsto} L_{1}^{'}
	      \\
		P_{2} \stackrel{xy}{\longmapsto} Q_{2}
	    }{
	      P_{1}|P_{2} \stackrel{\epsilon}{\longmapsto} L_{1}^{'}|stop(Q_{2})
	    }$ 		      
	    \end{center}
	    the derivations of all other transitions can end only with an instance of $Par1L$ so we have:
	    \begin{center}
	      \begin{tabular}{ll}
		  $\inferrule* [left=\bf{Par1L}]{
		    L_{i}^{'} \stackrel{\gamma_{i}}{\longmapsto} L_{i+1}^{'}
		  }{
		    L_{i}^{'}|stop(Q_{2})
		      \stackrel{\gamma_{i}}{\longmapsto} 
			L_{i+1}^{'}|stop(Q_{2})
		  }$ 	
		&
		  $\inferrule* [left=\bf{Par1L}]{
		    L_{k}^{'} \stackrel{\gamma_{k+1}}{\longmapsto} Q_{1}
		  }{
		    L_{i}^{'}|stop(Q_{2})
		      \stackrel{\gamma_{k+1}}{\longmapsto} 
			Q_{1}|stop(Q_{2})
		  }$ 	
	      \end{tabular}
	    \end{center}
	    We derive the following chain of transition:
	    \begin{center}
	      $P_{1} 
		\stackrel{\overline{x}y}{\longmapsto} 
		  L_{1}^{'} 
		    \stackrel{\gamma_{2}}{\longmapsto} 
		      L_{2}^{'} 
			\cdots 
			  L_{k-1}^{'} 
			    \stackrel{\gamma_{k}}{\longmapsto} 
			      L_{k}^{'}
				\stackrel{\gamma_{k+1}}{\longmapsto} 
				  Q_{1}$
	    \end{center}
	    for inductive hypothesis $P_{1} \xrightarrow{\overline{x}y} er(Q_{1})$. A proof of the conclusion is
	    \begin{center}
	    $\inferrule* [left=\bf{EComSeq}]{
		P_{1} \xrightarrow{\overline{x}} er(Q_{1})
	      \\
		P_{2}\xrightarrow{xy} Q_{2}
	    }{
	      P_{1}|P_{2} \xrightarrow{\tau} er(Q_{1})|Q_{2}
	    }$ 
	    \end{center}
	  \item[$Par1L$]: 
	    the last part of the derivation of the first transition is:
	    \begin{center}
	      $\inferrule* [left=\bf{Par1L}]{
		      P_{1} \stackrel{\gamma_{1}}{\longmapsto} L_{1}^{'}
		  }{
		    P_{1}|P_{2} \stackrel{\gamma_{1}}{\longmapsto} L_{1}^{'}|P_{2}
	      }$
	    \end{center}
	    there can be three cases:
	    \begin{itemize}
	      \item 
		the derivations of all the other transitions end with an instance of $Par1L$. We derive the following chain of transition:
 		    \begin{center}
 		      $P_{1} 
 			\stackrel{\gamma_{1}}{\longmapsto} 
 			  L_{1}^{'} 
 			    \stackrel{\gamma_{2}}{\longmapsto} 
 			      L_{2}^{'} 
 				\cdots 
 				  L_{k-1}^{'} 
 				    \stackrel{\gamma_{k}}{\longmapsto} 
 				      L_{k}^{'}
 					\stackrel{\gamma_{k}}{\longmapsto} 
 					  Q_{1}$
 		    \end{center}
 		    for inductive hypothesis $P_{1} \xrightarrow{\alpha} er(Q_{1})$. A proof of the conclusion is
 		    \begin{center}
 		      $\inferrule* [left=\bf{Par}]{
			  P_{1} \xrightarrow{\alpha} er(Q_{1})
 		      }{
 			P_{1}|P_{2} \xrightarrow{\alpha} er(Q_{1})|P_{2}^{'}
 		      }$ 
 		    \end{center}
	      \item 
		there is one derivation that ends with an instance of $Com2LStop$ and the derivations of all the other transitions end with an instance of $Par1L$. We present here the case when the second transition ends with a $Com2LStop$, the other cases are similar. So  
 		    \begin{center}
 		      $\inferrule* [left=\bf{Com2LStop}]{
 			  L_{2}^{'} \xrightarrow{\overline{x}y} L_{2}^{'}
 			\\
 			  P_{2}\xrightarrow{xy} P_{2}^{'}
 		      }{
 			L_{2}^{'}|P_{2} \xrightarrow{\epsilon} L_{2}^{'}|stop(P_{2}^{'})
 		      }$ 
 		    \end{center}
		We derive the following chain of transition:
 		    \begin{center}
 		      $P_{1} 
 			\stackrel{\epsilon}{\longmapsto} 
 			  L_{1}^{'} 
 			    \stackrel{\overline{x}y}{\longmapsto} 
 			      L_{2}^{'} \stackrel{\epsilon}{\longmapsto} 
 				\cdots 
 				  \stackrel{\epsilon}{\longmapsto}  L_{k-1}^{'} 
 				    \stackrel{\epsilon}{\longmapsto} 
 				      L_{k}^{'}
 					\stackrel{\tau}{\longmapsto} 
 					  Q_{1}$
 		    \end{center}
 		    for inductive hypothesis $P_{1} \xrightarrow{\overline{x}y} er(Q_{1})$. A proof of the conclusion is
 		    \begin{center}
 		      $\inferrule* [left=\bf{EComSeq}]{
 			  P_{1} \xrightarrow{\overline{x}y} er(Q_{1})
 			\\
 			  P_{2}\xrightarrow{xy} P_{2}^{'}
 		      }{
 			P_{1}|P_{2} \xrightarrow{\tau} er(Q_{1})|P_{2}^{'}
 		      }$ 
 		    \end{center}
	      \item 
		the derivation of the last transition ends with an instance of $Com4L$ and the derivations of all the other transitions end with an instance of $Par1L$. We derive the following chain of transition:
 		    \begin{center}
 		      $P_{1} 
 			\stackrel{\epsilon}{\longmapsto} 
 			  L_{1}^{'} 
 			    \stackrel{\epsilon}{\longmapsto} 
 			      L_{2}^{'} 
 				\cdots 
 				  L_{k-1}^{'} 
 				    \stackrel{\epsilon}{\longmapsto} 
 				      L_{k}^{'}
 					\stackrel{\overline{x}y}{\longmapsto} 
 					  Q_{1}$
 		    \end{center}
 		    for inductive hypothesis $P_{1} \xrightarrow{\overline{x}y} er(Q_{1})$. A proof of the conclusion is
 		    \begin{center}
 		      $\inferrule* [left=\bf{EComSeq}]{
 			  P_{1} \xrightarrow{\overline{x}y} er(Q_{1})
 			\\
 			  P_{2}\xrightarrow{xy} P_{2}^{'}
 		      }{
 			P_{1}|P_{2} \xrightarrow{\tau} er(Q_{1})|P_{2}^{'}
 		      }$ 
 		    \end{center}
	    \end{itemize} 		
      \end{description}
    \end{description}
  \end{proof}
\end{proposition}



% \begin{proposition}
%   Let $\rightarrow$ be the relation defined in table \ref{lowleveltransitionrelationearlyoutonly}. If there exist $L_{1}$, $\cdots$, $L_{k}$ with $k\geq 1$ such that
%   \begin{center}
%     $P \stackrel{\epsilon}{\longmapsto} L_{1}  \stackrel{\epsilon}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\epsilon}{\longmapsto} L_{k} \stackrel{\tau}{\longmapsto} Q$ 
%   \end{center}
%   then $P\xrightarrow{\tau} Q$. 
%   \begin{proof}
%     The proof is by induction on $k$ plus the depth of the derivation of the first transition:
%     \begin{description}
%       \item[base case $k=1$]
%     \end{description}
%  
%     \begin{description}
%       \item[inductive case $k>1$]
%     \end{description}
% 	The last rule in the derivation of $P \stackrel{\gamma_{1}}{\longmapsto} L_{1}$ can be:
% 	\begin{description}
% 	      \item[$Sum$] the first transition is:
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Sum}]{
% 		      P_{1} \stackrel{\epsilon}{\longmapsto} L_{1}
% 		    }{
% 		      P_{1}+P_{2} \stackrel{\epsilon}{\longmapsto} L_{1}
% 		  }$ 
% 		\end{center}
% 		so we can build the following chain of transition:
% 		\begin{center}
% 		  $P_{1} \stackrel{\epsilon}{\longmapsto} L_{1} \stackrel{\epsilon}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\epsilon}{\longmapsto} L_{k} \stackrel{\tau}{\longmapsto} Q$ 
% 		\end{center}
% 		apply the inductive hypothesis to get $P_{1} \xrightarrow{\tau} Q$. Now a proof of the conclusion can be
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Sum}]{
% 		      P_{1} \xrightarrow{\tau} Q
% 		    }{
% 		      P_{1}+P_{2} \xrightarrow{\tau} Q
% 		  }$
% 		\end{center}
% 	      \item[$Res$] the first transition is:
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Res}]{
% 			P_{1} \stackrel{\epsilon}{\longmapsto} L_{1}^{'}
% 		      \\
% 			z\notin n(\epsilon)
% 		    }{
% 		      (\nu z) P_{1} \stackrel{\epsilon}{\longmapsto} (\nu z)L_{1}^{'}
% 		  }$ 
% 		\end{center}
% 		given that $L_{1}$ has a restriction at the top level, all the other intermediate processes $L_{2}, \cdots, L_{k}$ and $Q$ have the same restriction at the top level. This is because the only rule whose conclusion is a transition that start from a possibly marked process with a restriction at its top level is $Res$. So the last rule used to prove all transition is $Res$.
% 		\begin{center}
% 		\begin{tabular}{ll}
% 		    $\inferrule* [left=\bf{Res}]{
% 			L_{k}^{'} \stackrel{\tau}{\longmapsto} Q^{'}
% 		      \\
% 			z\notin n(\tau)
% 		    }{
% 		      (\nu z)L_{k}^{'} \stackrel{\tau}{\longmapsto} (\nu z)Q^{'}
% 		    }$
% 		  &
% 		    $\inferrule* [left=\bf{Res}]{
% 			L_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}
% 		      \\
% 			z\notin n(\epsilon)
% 		    }{
% 		      (\nu z)L_{i}^{'} \stackrel{\epsilon}{\longmapsto} (\nu z)L_{i+1}^{'}
% 		    }$
% 		\end{tabular}
% 		\end{center}
% 		we can build the following chain of transitions:
% 		\begin{center}
% 		  $P_{1} 
% 		    \stackrel{\epsilon}{\longmapsto} 
% 		      L_{1}^{'} 
% 			\stackrel{\epsilon}{\longmapsto} 
% 			  L_{2}^{'} 
% 			    \cdots 
% 			      L_{k-1}^{'} 
% 				\stackrel{\epsilon}{\longmapsto} 
% 				  L_{k}^{'}
% 				    \stackrel{\tau}{\longmapsto} 
% 				      Q^{'}$ 
% 		\end{center}
% 		then apply the inductive hypothesis to get $P_{1} \xrightarrow{\tau} Q^{'}$. A proof of the conclusion can be
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Res}]{
% 			  P_{1} \xrightarrow{\tau} Q^{'}
% 			\\
% 			  z\notin n(\tau)
% 		  }{
% 			(\nu z)P_{1} \xrightarrow{\tau} (\nu z)Q^{'}
% 		  }$
% 		\end{center}
% 	      \item[$Cong$]: 
% 		the last rule of the derivation of the first transition is:
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Cong}]{
% 		      P^{'} \equiv P
% 		    \\
% 		      P^{'} \stackrel{\epsilon}{\longmapsto} L_{1}
% 		  }{
% 		    P \stackrel{\epsilon}{\longmapsto} L_{1}
% 		  }$ 		      
% 		\end{center}
% 		We derive the following chain of transition:
% 		\begin{center}
% 		  $P^{'} 
% 		    \stackrel{\epsilon}{\longmapsto} 
% 		      L_{1} 
% 			\stackrel{\epsilon}{\longmapsto} 
% 			  L_{2} 
% 			    \cdots 
% 			      L_{k-1} 
% 				\stackrel{\epsilon}{\longmapsto} 
% 				  L_{k}
% 				    \stackrel{\tau}{\longmapsto} 
% 				      Q$
% 		\end{center}
% 		for inductive hypothesis $P^{'} \xrightarrow{\tau} Q$. A proof of the conclusion is
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Cong}]{
% 		      P^{'} \equiv P
% 		    \\
% 		      P^{'} \xrightarrow{\tau} Q
% 		  }{
% 		    P \xrightarrow{\tau} Q
% 		  }$ 
% 		\end{center}
% 	      \item[$Com3L$]: 
% 		the last part of the derivation of the first transition is:
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Com3L}]{
% 		      P_{1} \stackrel{\overline{x}y}{\longmapsto} L_{1}^{'}
% 		    \\
% 		      P_{2} \stackrel{xy}{\longmapsto} P_{2}^{'}
% 		  }{
% 		    P_{1}|P_{2} \stackrel{\epsilon}{\longmapsto} L_{1}^{'}|P_{2}^{'}
% 		  }$ 		      
% 		\end{center}
% 		the derivations of all the transitions $L_{1} \stackrel{\epsilon}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\epsilon}{\longmapsto} L_{k}$ can end with an instance of $Par1L$ or $Com2L$ so for each $1 < i \leq k$ we have one of the following:
% 		\begin{center}
% 		\begin{tabular}{ll}
% 		  $\inferrule* [left=\bf{Par1L}]{
% 		      L_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}
% 		  }{
% 		    L_{i}^{'}|P_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}|P_{i}^{'}
% 		  }$ 		      		  
% 		&
% 		  $\inferrule* [left=\bf{Com2L}]{
% 		      L_{i}^{'} \stackrel{\overline{a}b}{\longmapsto} L_{i+1}^{'}
% 		    \\
% 		      P_{i}^{'} \stackrel{ab}{\longmapsto} P_{i+1}^{'}
% 		  }{
% 		    L_{i}^{'}|P_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}|P_{i+1}^{'}
% 		  }$ 		      		  
% 		\end{tabular}
% 		\end{center}
% 		    We derive the following chain of transition:
% 		    \begin{center}
% 		      $P_{1} \stackrel{xy}{\longmapsto} L_{1}^{'} \stackrel{\gamma_{2}}{\longmapsto} L_{2}^{'} \cdots L_{k-1}^{'} \stackrel{\gamma_{k}}{\longmapsto} L_{k}^{'}\stackrel{\gamma_{k+1}}{\longmapsto} Q_{1}$
% 		    \end{center}
% 		    for inductive hypothesis $P_{1} \xrightarrow{\sigma} Q_{1}$. A proof of the conclusion is
% 		    \begin{center}
% 		      $\inferrule* [left=\bf{EComSeq}]{
% 			  P_{1} \xrightarrow{xy \cdot \gamma_{2}\cdot \ldots \cdot \gamma_{k+1}} Q_{1}
% 			\\
% 			  P_{2}\xrightarrow{\overline{x}y} P_{2}^{'}
% 		      }{
% 			P_{1}|P_{2} \xrightarrow{\gamma_{2}\cdot \ldots \cdot \gamma_{k+1}} Q_{1}|P_{2}^{'}
% 		      }$ 
% 		    \end{center}
% 		    and $\gamma_{2}\cdot \ldots \cdot \gamma_{k+1}=\sigma$ because the first action $\gamma_{1}$ is $\epsilon$.
% 	      \item[$Par1L$]: 
% 		the last part of the derivation of the first transition is:
% 		\begin{center}
% 		  $\inferrule* [left=\bf{Par1L}]{
% 		      P_{1} \stackrel{\epsilon}{\longmapsto} L_{1}^{'}
% 		  }{
% 		    P_{1}|P_{2} \stackrel{\epsilon}{\longmapsto} L_{1}^{'}|P_{2}
% 		  }$ 		      
% 		\end{center}
% 		the derivations of all the transitions $L_{1} \stackrel{\epsilon}{\longmapsto} L_{2} \cdots L_{k-1} \stackrel{\epsilon}{\longmapsto} L_{k}$ can end with an instance of $Par1L$ or $Com2L$ so for each $1 < i \leq k$ we have one of the following:
% 		\begin{center}
% 		\begin{tabular}{ll}
% 		  $\inferrule* [left=\bf{Par1L}]{
% 		      L_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}
% 		  }{
% 		    L_{i}^{'}|P_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}|P_{i}^{'}
% 		  }$ 		      		  
% 		&
% 		  $\inferrule* [left=\bf{Com2L}]{
% 		      L_{i}^{'} \stackrel{\overline{a}b}{\longmapsto} L_{i+1}^{'}
% 		    \\
% 		      P_{i}^{'} \stackrel{ab}{\longmapsto} P_{i+1}^{'}
% 		  }{
% 		    L_{i}^{'}|P_{i}^{'} \stackrel{\epsilon}{\longmapsto} L_{i+1}^{'}|P_{i+1}^{'}
% 		  }$ 		      		  
% 		\end{tabular}
% 		\end{center}
% 		the last rule used to derive $L_{k} \xrightarrow{\tau} Q$ can be $Par1L$ or $Com4$:
% 		\begin{center}
% 		\begin{tabular}{ll}
% 		  $\inferrule* [left=\bf{Par1L}]{
% 		      L_{k}^{'} \stackrel{\tau}{\longmapsto} Q_{1}
% 		  }{
% 		    L_{k}^{'}|Q_{2} \stackrel{\tau}{\longmapsto} Q_{1}|Q_{2}
% 		  }$ 		      		  
% 		&
% 		  $\inferrule* [left=\bf{Com4L}]{
% 		      L_{k}^{'} \stackrel{\overline{a}b}{\longmapsto} Q_{1}
% 		    \\
% 		      P_{k}^{'} \stackrel{ab}{\longmapsto} Q_{2}
% 		  }{
% 		    L_{k}^{'}|P_{k}^{'}
% 		      \stackrel{\tau}{\longmapsto} 
% 			Q_{1}|Q_{2}
% 		  }$ 		      		  
% 		\end{tabular}
% 		\end{center}
% 
% 		    We derive the following chain of transition:
% 		    \begin{center}
% 		      $P_{1} 
% 			\stackrel{\epsilon}{\longmapsto} 
% 			  L_{1}^{'} 
% 			    \stackrel{\epsilon}{\longmapsto} 
% 			      L_{2}^{'} 
% 				\cdots 
% 				  L_{k-1}^{'} 
% 				    \stackrel{\epsilon}{\longmapsto} 
% 				      L_{k}^{'}
% 					\stackrel{\tau}{\longmapsto} 
% 					  Q_{1}$
% 		    \end{center}
% 		    for inductive hypothesis $P_{1} \xrightarrow{\sigma} Q_{1}$. A proof of the conclusion is
% 		    \begin{center}
% 		      $\inferrule* [left=\bf{EComSeq}]{
% 			  P_{1} \xrightarrow{xy \cdot \gamma_{2}\cdot \ldots \cdot \gamma_{k+1}} Q_{1}
% 			\\
% 			  P_{2}\xrightarrow{\overline{x}y} P_{2}^{'}
% 		      }{
% 			P_{1}|P_{2} \xrightarrow{\gamma_{2}\cdot \ldots \cdot \gamma_{k+1}} Q_{1}|P_{2}^{'}
% 		      }$ 
% 		    \end{center}
% 		    and $\gamma_{2}\cdot \ldots \cdot \gamma_{k+1}=\sigma$ because the first action $\gamma_{1}$ is $\epsilon$.
% 		
% 	    \end{description}	    
%   \end{proof}
% \end{proposition}


% \section{Bisimilarity, congruence and equivalence}
% 
% 
% 
% \section{Bisimilarity, congruence and equivalence}
% 
% We present here some behavioural equivalences and some of their properties. In the following we will use the phrase $bn(\alpha)$ is fresh in a definition to mean that the name in $bn(\alpha)$, if any, is different from any free name occurring in any of the agents in the definition. We write $\rightarrow_{E}$ for the early semantic and $\rightarrow_{L}$ for the late semantic.
% 
% 
% \subsection{Late bisimilarity}
% 
% \begin{definition}
%   A \emph{strong late bisimulation} is a binary simmetric relation $\mathbf{S}$ on processes such that for each process $P$ and $Q$, $P\mathbf{S}Q$ implies:
%   \begin{itemize}
%     \item
%       if $P \xrightarrow{a(x)}_{L} P^{'}$ and $x\notin fn(P)\cup fn(Q)$ then there exists a process $Q^{'}$ such that $Q \xrightarrow{a(x)}_{L} Q^{'}$ and for all $u$ $P^{'}\{u/x\}\mathbf{S}Q^{'}\{u/x\}$
%     \item
%       if $P \xrightarrow{\gamma}_{L} P^{'}$, $\gamma$ is a non-input action or a sequence of actions and $bn(\gamma) \cap (fn(P)\cup fn(Q)) = \emptyset$ then there exists a process $Q^{'}$ such that $Q \xrightarrow{\gamma}_{L} Q^{'}$ and $P^{'}\mathbf{S}Q^{'}$
%   \end{itemize}
%   $P$ and $Q$ are \emph{late bisimilar} written $P\dot{\sim}_{L}Q$ if there exists a strong late bisimulation $\mathbf{S}$ such that $P\mathbf{S}Q$.
% \end{definition}
% 
% \begin{example}
%   Strong late bisimulation is not closed under substitution in general:
%   \[
%     a(u).0|\overline{b}v.0\; \dot{\sim}_{L}\; a(u).\overline{b}v.0 + \overline{b}v.a(u).0
%   \]
%   and the bisimulation(without the simmetric part) is  the following:
%   \[
%     \{(a(u).0|\overline{b}v.0, a(u).\overline{b}v.0 + \overline{b}v.a(u).0),\;\; (a(u).0|0,a(u).0),\;\; (0|0,0),\;\; (0|\overline{b}v.0,\overline{b}v.0)\} 
%   \]
%   If we apply the substitution $\{a/b\}$ to each process then they are not strongly bisimilar anymore because $(a(u).0|\overline{b}v.0)\{a/b\}$ is $a(u).0|\overline{a}v.0$ and this process can perform an invisible action whether $(a(u).\overline{b}v.0 + \overline{b}v.a(u).0)\{a/b\}$ cannot.
% \end{example}
% 
% We refer to strong late bisimulation as strong \emph{ground} late bisimulation, because it is not preserved by substitution.
% 
% There can be also an alternative definition of strong late bimisimulation:
% \begin{definition}
%   Let $\mathbb{P}$ be the set of processes. Then we define $\mathbf{B}_{0}=\mathbb{P}^{2}$ and for all $i>0$ we define $\mathbf{B}_{i}$ as the relation that contains every pair $(P,Q)\in \mathbf{B}_{i-1}$ such that:
%   \begin{itemize}
%     \item
%       if $P \xrightarrow{a(x)}_{L} P^{'}$ and $x\notin fn(P)\cup fn(Q)$ then there exists a process $Q^{'}$ such that $Q \xrightarrow{a(x)}_{L} Q^{'}$ and for all $u$ $P^{'}\{u/x\}  \mathbf{B}_{i-1} Q^{'}\{u/x\}$
%     \item
%       if $P \xrightarrow{\gamma}_{L} P^{'}$, $\gamma$ is a non-input action or a sequence of actions and $bn(\gamma) \cap (fn(P)\cup fn(Q)) = \emptyset$ then there exists a process $Q^{'}$ such that $Q \xrightarrow{\gamma}_{L} Q^{'}$ and $P^{'}\mathbf{B}_{i-1}Q^{'}$
%   \end{itemize}
%   Finally $\mathbf{B}=\cap_{i\in \mathbb{N}} \mathbf{B}_{i}$ and we can say that $P$ and $Q$ are \emph{late bisimilar} written $P\sim_{L}Q$ if $P \mathbf{B} Q$.
% \end{definition}
% 
% \begin{lemma}
%   For all process $P$ and $Q$: $P\dot{\sim}Q$ if and only if $P\mathbf{B}Q$
% \end{lemma}
% 
% 
% \begin{lemma}
%   If $P\xrightarrow{\gamma}_{L}Q$ and $\sigma$ is an injective substitution then $P\sigma \xrightarrow{\gamma\sigma}_{L} Q\sigma$
% \end{lemma}
% 
% 
% \begin{proposition}
%   Let $\mathbf{T}$ be $\{(P\sigma,Q\sigma):P\dot{\sim}_{L}Q, \sigma\; injective\}$ then $\mathbf{T}$ is a bisimulation.
%   \begin{proof}:
%     Let $P$ and $Q$ be processes such that $P\dot{\sim}_{L}Q$ and let $\sigma$ be an injective substitution of names. We suppose that the application of $\sigma$ to both $P$ and $Q$ does not affect bound names. Now we have two cases according to the definition of bisimulation:
%     \begin{itemize}
%       \item:
% 	\begin{center}
% 	  \begin{tabular}{ll}
% 	      $P\sigma \xrightarrow{a(x)}_{L}P^{'}$ and $x\notin (fn(P\sigma) \cup fn(Q\sigma))$
% 	    &
% 	  \\
% 	      $\Rightarrow P \xrightarrow{b(x)}_{L}P^{'}\sigma^{-1}$ and $x\notin (fn(P) \cup fn(Q))$ where $b=a\sigma^{-1}$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists Q^{'}:\; Q \xrightarrow{b(x)}_{L}Q^{'}$ and $\forall u.$ $P^{'}\sigma^{-1}\{u/x\} \dot{\sim}_{L} Q^{'}\{u/x\}$
% 	    &
% 	  \\
% 	      $\Rightarrow Q\sigma \xrightarrow{(b(x))\sigma}_{L}Q^{'}\sigma$ and $\forall u.$ $P^{'}\sigma^{-1}\{u/x\}\sigma \mathbf{T} Q^{'}\{u/x\}\sigma$
% 	    &
% 	  \\
% 	      $\Rightarrow Q\sigma \xrightarrow{a(x)}_{L}Q^{'}\sigma$ and $\forall u.$ $P^{'}\{u/x\} \mathbf{T} Q^{'}\sigma\{u/x\}$
% 	    &
% 	  \\
% 	  \end{tabular}
% 	\end{center}
%       \item:
% 	\begin{center}
% 	  \begin{tabular}{ll}
% 	      $P\sigma \xrightarrow{\gamma}_{L}P^{'}$ and $bn(\gamma)\cap (fn(P\sigma) \cup fn(Q\sigma))=\emptyset$
% 	    &
% 	  \\
% 	      $\Rightarrow P \xrightarrow{\gamma\sigma^{-1}}_{L}P^{'}\sigma^{-1}$ and $bn(\gamma)\cap (fn(P) \cup fn(Q))=\emptyset$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists Q^{'}:\; Q \xrightarrow{\gamma\sigma^{-1}}_{L}Q^{'}$ and $P^{'}\sigma^{-1} \dot{\sim}_{L} Q^{'}$
% 	    &
% 	  \\
% 	      $\Rightarrow Q\sigma \xrightarrow{\gamma\sigma^{-1}\sigma}_{L}Q^{'}\sigma$ and $P^{'}\sigma^{-1}\sigma \mathbf{T} Q^{'}\sigma$
% 	    &
% 	  \\
% 	      $\Rightarrow Q\sigma \xrightarrow{\gamma}_{L}Q^{'}\sigma$ and $P^{'} \mathbf{T} Q^{'}\sigma$
% 	    &
% 	  \\
% 	  \end{tabular}
% 	\end{center}
%     \end{itemize}
%   \end{proof}
% \end{proposition}
% 
% 
% \begin{proposition}
%   If $P \dot{\sim}_{L} Q$ and $\sigma$ is an injective substitution then $P\sigma \dot{\sim}_{L} Q\sigma$.
% \end{proposition}
% 
% \begin{proposition}
%   $\dot{\sim}_{L}$ is an equivalence.
%   \begin{proof}
%     Reflexivity is immediate. Symmetry holds because bisimulation is symmetric. Transitivity holds because $\dot{\sim}_{L} \dot{\sim}_{L}$ is a bisimulation: we prove this by induction on $\mathbf{B}_{i}$. Let $P,Q,R$ be processes such that $P \mathbf{B} Q \mathbf{B} R$. If $i=0$ it is clear from the definition of $\mathbf{B}_{0}$ that $P \mathbf{B}_{0} R$. If $i>0$ then according to the definition of $\mathbf{B}_{i}$ we have two cases:
%     \begin{itemize}
%       \item:
% 	\begin{center}
% 	  \begin{tabular}{ll}
% 	      $P\sigma \xrightarrow{a(x)}_{L}P^{'}$ and $x\notin (fn(P) \cup fn(Q))$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists Q^{'}:\; Q \xrightarrow{a(x)}_{L}Q^{'}$ and $\forall u.$ $P^{'}\{u/x\} \mathbf{B}_{i-1} Q^{'}\{u/x\}$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists R^{'}:\; R \xrightarrow{a(x)}_{L}R^{'}$ and $\forall u.$ $Q^{'}\{u/x\} \mathbf{B}_{i-1} R^{'}\{u/x\}$
% 	    &
% 	  \\
% 	      $\Rightarrow \forall u.$ $P^{'}\{u/x\} \mathbf{B}_{i-1} R^{'}\{u/x\}$
% 	    &
% 	  \\
% 	  \end{tabular}
% 	\end{center}
%       \item:
% 	\begin{center}
% 	  \begin{tabular}{ll}
% 	      $P \xrightarrow{\gamma}_{L}P^{'}$ and $bn(\gamma)\cap (fn(P) \cup fn(Q))=\emptyset$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists Q^{'}:\; Q \xrightarrow{\gamma}_{L}Q^{'}$ and $P^{'} \mathbf{B}_{i-1} Q^{'}$
% 	    &
% 	  \\
% 	      $\Rightarrow \exists R^{'}:\; R \xrightarrow{\gamma}_{L}R^{'}$ and $Q^{'} \mathbf{B}_{i-1} R^{'}$
% 	    &
% 	  \\
% 	      $\Rightarrow P^{'} \mathbf{B}_{i-1} R^{'}$
% 	    &
% 	  \\
% 	  \end{tabular}
% 	\end{center}
%     \end{itemize}
%   \end{proof}
% \end{proposition}
% 
% \begin{definition}
%   An occurrence of a process $Q$ inside a process $P$ is \emph{guarded} if it is a proper subterm of a prefix form in $P$. Otherwise it is \emph{unguarded}.
% \end{definition}
% 
% \begin{definition}
%   A process is \emph{normal} if it is $(\nu \tilde{x})P$ where all bound names are distinct and $P$ has no unguarded restrictions, i.e., every occurrence of a process $(\nu \tilde{y})Q$ inside $P$ is guarded.
% \end{definition}
% 
% \begin{proposition}
%   Every process is structurally congruent to a normal process.
% \end{proposition}
% 
% \begin{lemma}\label{reductiontonormalform}
%   If $P\xrightarrow{\gamma}_{L}Q$ and $P\equiv N$ where $N$ is normal then by an inference of no greater depth, $N\xrightarrow{\gamma}_{L}M$ and $Q\equiv M$
% \end{lemma}
% 
% \begin{definition}
%   A \emph{strong late bisimulation up to $\dot{\sim}_{L}$} is a binary simmetric relation $\mathbf{S}$ on processes such that for each process $P$ and $Q$, $P\mathbf{S}Q$ implies:
%   \begin{itemize}
%     \item
%       if $P \xrightarrow{a(x)}_{L} P^{'}$ and $x\notin fn(P)\cup fn(Q)$ then there exists a process $Q^{'}$ such that $Q \xrightarrow{a(x)}_{L} Q^{'}$ and for all $u$ there exist processes $A,B$ such that $P^{'}\{u/x\}\dot{\sim}_{L}A\mathbf{S}B\dot{\sim}_{L}Q^{'}\{u/x\}$
%     \item
%       if $P \xrightarrow{\gamma}_{L} P^{'}$, $\gamma$ is a non-input action or a sequence of actions and $bn(\gamma) \cap (fn(P)\cup fn(Q)) = \emptyset$ then there exist processes $A,B,Q^{'}$ such that $Q \xrightarrow{\gamma}_{L} Q^{'}$ and $P^{'}\dot{\sim}_{L}A\mathbf{S}B \dot{\sim}_{L}Q^{'}$
%   \end{itemize}
% \end{definition}
% 
% \begin{proposition}
%   If two processes $P$ and $Q$ are strong late bisimilar up to $\dot{\sim}_{L}$ then they are also strong late bisimilar.
% \end{proposition}
% 
% 
% \begin{lemma}\label{a}
%   $\{((\nu \tilde{x})(P|Q),(\nu \tilde{x})(P^{'}|Q^{'})): P\dot{\sim} P^{'}, Q\dot{\sim}Q^{'}\}$ is a bisimulation up to $\dot{\sim}_{L}$
% \end{lemma}
% 
% 
% \begin{proposition}
%   $\dot{\sim}_{L}$ is preserved by all operators except input prefix.
%   \begin{proof}
%     We have to prove the proposition for every operator in turn except for input prefix. If we take $P=P^{'}=0$ in lemma \ref{a} then the proposition holds for restriction. If we take $\tilde{x}$ to be the empty sequence in lemma \ref{a} then the proposition holds for parallel. The proof for sum is easy: $\{(P+R, Q+R): P\dot{\sim}_{L}Q\}$ is a bisimulation up to $\dot{\sim}_{L}$. The case for prefixes is also easy. We show just the case of strong output. Let $P\dot{\sim}_{L}Q$ then we want to prove that $\underline{\overline{x}y}.P$ and $\underline{\overline{x}y}.Q$ are bisimilar up to $\dot{\sim}_{L}$. We have two cases:
%     \begin{itemize}
%       \item 
% 	There are no transitions starting from $P$ that are labeled with an output or a sequence of outputs. In this case there are no transition starting from $\underline{\overline{x}y}.P$ or $\underline{\overline{x}y}.Q$ so they are bisimilar.
%       \item 
% 	$P\xrightarrow{\sigma}P^{'}$ and $\sigma$ is an output or a sequence of outputs. Then the only transition starting from $\underline{\overline{x}y}.P$ is $\underline{\overline{x}y}.P\xrightarrow{\overline{x}y \cdot \sigma} P^{'}$. So we do not have to check the first part of the definition of bisimulation but only the second one: $P\xrightarrow{\sigma}P^{'}$ implies that $Q\xrightarrow{\sigma}Q^{'}$ and the processes $P^{'}$ and $Q^{'}$ are bisimilar up to $\dot{\sim}_{L}$. So for rule $SOutSeq$ or $SOut$: $\underline{\overline{x}y}.Q\xrightarrow{\overline{x}y \cdot \sigma} Q^{'}$.
%     \end{itemize}
%     The input prefix does not preserve $\dot{\sim}_{L}$ and the following example is a proof: AGGIUNGERE ESEMPIO
%   \end{proof}
% \end{proposition}
% 
% \begin{definition}
%   Two processes $P$ and $Q$ are \emph{strong late equivalent} written $P\sim_{L}Q$ is for each substitution $\sigma$ $P\sigma \dot{\sim}_{L}Q\sigma$
% \end{definition}
% 
% % \begin{example}
% %   If $z\notin fn(R)\cup \{x\}$ then $x(y).R \dot{\sim}_{L} (z)x(y).R$
% % \end{example}
% 
% 
% \subsection{Early bisimilarity}
% 
% \begin{definition}
%   A \emph{strong early bisimulation}(according to \cite{parrow})is a symmetric binary relation $\mathbf{S}$ on processes such that for each process $P$ and $Q$:
%   \begin{center}
%     $P\mathbf{S} Q$, $P \xrightarrow{\gamma}_{E} P^{'}$ and $bn(\gamma) \cap (fn(P) \cup fn(Q))=\emptyset$
%   \end{center} 
%   implies that
%   \begin{center}
%     there exists $Q^{'}$ such that $Q \xrightarrow{\gamma}_{E} Q^{'}$ and $P^{'}\mathbf{S}Q^{'}$
%   \end{center} 
%   $P$ and $Q$ are \emph{early bisimilar} written $P\dot{\sim}_{E}Q$ if there exists a strong early bisimulation $\mathbf{S}$ such that $P\mathbf{S}Q$
% \end{definition}
% 
% \begin{definition}
%   Two processes $P$ and $Q$ are \emph{strong early equivalent} written $P\sim_{E}Q$ if for each substitution $\sigma$ $P\sigma \dot{\sim}_{E}Q\sigma$
% \end{definition}
% 
% 
% % \begin{proposition}
% %   Early bisimilarity is preserved by all operators except input prefix. 
% % \end{proposition}
% % 
% % \begin{proposition}
% %   The early congruence is the largest congruence in $\dot{\sim}_{E}$.  
% % \end{proposition}
% 
% % In the following definition we consider a subcalculus without restriction. 
% % \begin{definition}
% %   A \emph{strong open bisimulation} is a symmetric binary relation $\mathbb{R}$ on agents satisfying the following for all substitutions $\sigma$: $P\mathbb{R} Q$ and $P\sigma\; \xrightarrow{\alpha}_{E}\; P^{'}$ where $bn(\alpha)$ is fresh implies that
% %   \begin{center}
% %     $\exists Q^{'}:\;\; Q\sigma\xrightarrow{\alpha}_{E}Q^{'}\; \wedge\; P^{'}\mathbb{R}Q^{'}$
% %   \end{center}
% %   $P$ and $Q$ are strongly open bisimilar, written $P\; \dot{\sim}_{O}\; Q$ if they are related by an open bisimulation.
% % \end{definition}
% % 
% % \begin{proposition}
% %   strong open bisimulation is also a late bisimulation, is closed under substitution, is an equivalence and a congruence
% % \end{proposition}
% 
% 
% \subsection{Congruence}
% 
% \begin{definition}
%   We say that two agents $P$ and $Q$ are \emph{strongly congruent}, written $P\sim Q$ if
%   \begin{center}
%     $P\sigma \dot{\sim} Q\sigma$ for all substitution $\sigma$    
%   \end{center}
% \end{definition}
% 
% \begin{proposition}
%   Strong congruence is the largest congruence in bisimilarity.
% \end{proposition}
% 
% 
% \subsection{Open bisimilarity}
% 
% \begin{definition}
%   A \emph{distinction} is a finite symmetric and irreflexive binary relation on names. A substitution $\sigma$ \emph{respects} a distinction $D$ if for each name $a,b$ $aDb$ implies $\sigma(a)\neq \sigma(b)$. We write $D\sigma$ for the composition of the two relation.
% \end{definition}
% 
% 
% % \begin{definition}
% %   An \emph{strong open simulation}(according to \cite{parrow}) is $\{S_{D}\}_{D\in \mathbb{D}}$ a family of binary relations on processes such that for each process $P, Q$, for each distinction $D\in \mathbb{D}$, for each name substitution $\sigma$ which respects $D$ if $P S_{D} Q$, $P\sigma \xrightarrow{\gamma} P^{'}$ and $bn(\gamma)\cap (fn(P\sigma)\cup fn(Q\sigma))=\emptyset$ then:
% %   \begin{itemize}
% %     \item 
% %       if $\gamma=\overline{a}(x)$ then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\overline{a}(x)} Q^{'}$ and $P^{'} S_{D^{'}} Q^{'}$ where $D^{'}=D\sigma \cup \{x\}\times (fn(P\sigma)\cup fn(Q\sigma)) \cup  (fn(P\sigma)\cup fn(Q\sigma))\times\{x\}$
% %     \item
% %       if $\gamma$ is not a bound output then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\gamma} Q^{'}$ and $P^{'} S_{D\sigma} Q^{'}$
% %   \end{itemize}
% %   $P$ and $Q$ are \emph{open D bisimilar}, written $P \dot{\sim}_{O}^{D} Q$ if there exists a member $S_{D}$ of an open bisimulation such that $P S_{D} Q$; they are \emph{open bisimilar} if they are open $\emptyset$ bisimilar, written $P \dot{\sim}_{O} D$.
% % \end{definition}
% 
% % \begin{definition}
% %   A \emph{strong open simulation}(according to \cite{parrow}) is $\{S_{D}\}_{D\in \mathbb{D}}$ a family of binary relations on processes such that for each process $P, Q$, for each distinction $D\in \mathbb{D}$, for each name substitution $\sigma$ which respects $D$ if $P S_{D} Q$, $P\sigma \xrightarrow{\alpha} P^{'}$ and $bn(\alpha)\cap (fn(P\sigma)\cup fn(Q\sigma))=\emptyset$ then:
% %   \begin{itemize}
% %     \item 
% %       if $\alpha=\overline{a}(x)$ then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\overline{a}(x)} Q^{'}$ and $P^{'} S_{D^{'}} Q^{'}$ where $D^{'}=D\sigma \cup \{x\}\times (fn(P\sigma)\cup fn(Q\sigma)) \cup  (fn(P\sigma)\cup fn(Q\sigma))\times\{x\}$
% %     \item
% %       if $\alpha$ is not a bound output then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\alpha} Q^{'}$ and $P^{'} S_{D\sigma} Q^{'}$
% %   \end{itemize}
% %   $P$ and $Q$ are \emph{open D bisimilar}, written $P \dot{\sim}_{O}^{D} Q$ if there exists a member $S_{D}$ of an open bisimulation such that $P S_{D} Q$; they are \emph{open bisimilar} if they are open $\emptyset$ bisimilar, written $P \dot{\sim}_{O} D$.
% % \end{definition}
% % 
% % For now we consider a semantic where we do not allow the use of the rule $Opn$ so there is no concern for bound output.
% % \begin{definition}
% %   An \emph{strong open simulation} is $\{S_{D}\}_{D\in \mathbb{D}}$ a family of binary relations on processes such that for each process $P, Q$, for each distinction $D\in \mathbb{D}$, for each name substitution $\sigma$ which respects $D$ 
% %   \begin{center}
% %     if $P S_{D} Q$, $P\sigma \xrightarrow{\gamma} P^{'}$ and $bn(\gamma)\cap (fn(P\sigma)\cup fn(Q\sigma))=\emptyset$
% %   \end{center}
% %   then:
% %   \begin{center}
% %     there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\gamma} Q^{'}$ and $P^{'} S_{D\sigma} Q^{'}$
% %   \end{center}
% %   $P$ and $Q$ are \emph{open D bisimilar}, written $P \dot{\sim}_{O}^{D} Q$ if there exists a member $S_{D}$ of an open bisimulation such that $P S_{D} Q$; they are \emph{open bisimilar} if they are open $\emptyset$ bisimilar, written $P \dot{\sim}_{O} D$.
% % \end{definition}
% % 
% % 
% % \begin{proposition}
% %   Open bisimilarity is a congruence for multi $\pi$ calculus with strong output.
% %   \begin{proof}
% %     Let $P \dot{\sim}_{O}^{D} Q$ and let $\{S_{D}\}_{D\in \mathbb{D}}$ be the bisimilarity that relates $P$ and $Q$.
% %     We have to prove that each operator preserves bisimilarity:
% %     \begin{description}
% %       \item[$\overline{x}y$]: Let $\{S_{D}\}_{D\in \mathbb{D}}$ be a bisimilarity that relates $P$ and $Q$. Then we claim that 
% %       \begin{center}
% % 	$\{S_{D}\cup \{(\overline{x}y.P, \overline{x}y.Q),(\overline{x}y.Q, \overline{x}y.P)\}\}_{D\in \mathbb{D}}$ 
% %       \end{center}
% %       is a strong bisimilarity. Take $D\in \mathbb{D}$ such that $P S_{D} Q$ and let $\sigma$ be a substitution that respects $D$. There are transitions
% %       \begin{center}
% % 	\begin{tabular}{ll}
% % 	    $(\overline{x}y.P)\sigma \xrightarrow{(\overline{x}y)\sigma} P\sigma$
% % 	  &
% % 	    $(\overline{x}y.Q)\sigma \xrightarrow{(\overline{x}y)\sigma} Q\sigma$
% % 	\end{tabular}
% %       \end{center}
% %     \end{description}
% %    \end{proof}
% % \end{proposition}
% 
% 
% \begin{definition}
%   Two processes $P$ and $Q$ are \emph{strongly $D$ equivalent}(according to \cite{milnerparrowwalker}) written $P \sim_{D} Q$ if for each name substitution $\sigma$ respecting $D$: $P\sigma \dot{\sim}_{L} Q\sigma$.
% \end{definition}
% 
% \begin{proposition}
%   $\sim_{D}$ is a congruence.
%   \begin{proof}
%     Let $\sigma$ be a substitution that respects $D$. We have to prove that every operator preserves $\sim_{D}$:
%     \begin{description}
%       \item[$Summation$]
% 	Let $R$ be a process. We have to prove that $(P+R)\sigma \dot{\sim}_{L} (Q+R)\sigma$. So we have four cases:
% 	\begin{itemize}
% 	  \item 
% 	    $(P+R)\sigma \xrightarrow{a(x)} P^{'}$ and $P\sigma \xrightarrow{a(x)} P^{'}$. Since $P\sigma \dot{\sim}_{L} Q\sigma$ then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{a(x)} Q^{'}$ and for each $u$ we have $P^{'}\{u/x\}\dot{\sim}_{L}Q^{'}\{u/x\}$
% 	  \item 
% 	    $(P+R)\sigma \xrightarrow{a(x)} R^{'}$ and $R\sigma \xrightarrow{a(x)} R^{'}$. Also $(Q+R)\sigma$ can make this transition to $R^{'}$ and for each $u$ we have $R^{'}\{u/x\}\dot{\sim}_{L}R^{'}\{u/x\}$.
% 	  \item 
% 	    $(P+R)\sigma \xrightarrow{\gamma} P^{'}$ and $P\sigma \xrightarrow{\gamma} P^{'}$ where $\gamma$ is not an input. Since $P\sigma \dot{\sim}_{L} Q\sigma$ then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{a(x)} Q^{'}$ and for $P^{'} \dot{\sim}_{L} Q^{'}$
% 	  \item 
% 	    $(P+R)\sigma \xrightarrow{\gamma} R^{'}$ and $R\sigma \xrightarrow{\gamma} R^{'}$ where $\gamma$ is not an input. This is similar to the previous cases.
% 	\end{itemize}
%       \item[$Parallel\; composition$]
% 	Let $R$ be a process. We have to prove that $(P|R)\sigma \dot{\sim}_{L} (Q|R)\sigma$. So we proceed by cases on the last rule that can be applied to $(P|R)\sigma$ in order to derive a transition:
% 	\begin{description}
% 	  \item[$Par$] 
% 	    $(P|R)\sigma \xrightarrow{\gamma} P^{'}$ and $P\sigma \xrightarrow{\gamma} P^{'}$. Since $P\sigma \dot{\sim}_{L} Q\sigma$ then there exists $Q^{'}$ such that $Q\sigma \xrightarrow{\gamma} Q^{'}$ and $Q^{'}$ satisfies the conditions of late bisimulation. So thanks to rule $Par1L$, $(Q|R)\sigma$ can respond with the same transition.
% 	  \item[$LCom$] 
% 	    the last part of the derivation is:
% 	    \begin{center}
% 	      $\inferrule* [left=\bf{LCom}]{
% 		P\sigma \xrightarrow{x(y)} P^{'}
% 	      \\
% 		R\sigma \xrightarrow{\overline{x}z} R^{'}
% 	      }{
% 		(P|R)\sigma \xrightarrow{\tau} P^{'}\{z/y\}|R^{'}
% 	      }$
% 	    \end{center}
% 	    Since $P\sigma \xrightarrow{x(y)} P^{'}$ and $P\sigma \dot{\sim}_{L} Q\sigma$ then $Q\sigma \xrightarrow{x(y)} Q^{'}$ and for each $u$, $P^{'}\{u/y\} \dot{\sim}_{L} Q^{'}\{u/y\}$. For rule $LCom$, $(Q|R)\sigma \xrightarrow{\tau} Q^{'}\{z/y\}|R^{'}$ and because $\dot{\sim}_{L}$ is preserved by parallel composition then $P^{'}\{z/y\}|R^{'} \dot{\sim}_{L} Q^{'}\{z/y\}|R^{'}$.
% 	  \item[$LComSeq$]
% 	    the last part of the derivation is:
% 	    \begin{center}
% 	      $\inferrule* [left=\bf{LComSeq}]{
% 		P\sigma \xrightarrow{x(y)} P^{'}
% 	      \\
% 		R\sigma \xrightarrow{\overline{x}z \cdot \gamma} R^{'}
% 	      }{
% 		(P|R)\sigma \xrightarrow{\gamma} P^{'}\{z/y\}|R^{'}
% 	      }$
% 	    \end{center}
% 	    Since $P\sigma \xrightarrow{x(y)} P^{'}$ and $P\sigma \dot{\sim}_{L} Q\sigma$ then $Q\sigma \xrightarrow{x(y)} Q^{'}$ and for each $u$, $P^{'}\{u/y\} \dot{\sim}_{L} Q^{'}\{u/y\}$. For rule $LCom$, $(Q|R)\sigma \xrightarrow{\gamma} Q^{'}\{z/y\}|R^{'}$ and because $\dot{\sim}_{L}$ is preserved by parallel composition then $P^{'}\{z/y\}|R^{'} \dot{\sim}_{L} Q^{'}\{z/y\}|R^{'}$	    
% 	\end{description}
%       \item[$Restriction$]
%       \item[$Output\; prefixing$]
%       \item[$Strong\; output\; prefixing$]
%       \item[$Input\; prefixing$]
%     \end{description}
%   \end{proof}
% \end{proposition}
% 
% 
% 
% 
% 









\subsection{Early operational semantic without structural congruence}

\begin{definition}
  The \emph{late transition relation without structural congruence} is the smallest relation induced by the rules in table \ref{multipioutearlywithout}.
  \begin{table}
    \begin{tabular}{lll}
      \hline\\
	  $\inferrule* [left=\bf{Out}]{
	  }{
	    \overline{x}y.P \xrightarrow{\overline{x}y} P
	  }$
	&
	  $\inferrule* [left=\bf{EInp}]{
	    w \notin (fn(P)-\{z\})
	  }{
	    x(z).P \xrightarrow{xw} P\{w/z\}
	  }$
	&
	  $\inferrule* [left=\bf{Tau}]{
	  }{
	    \tau.P \xrightarrow{\tau} P
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{SOut}]{
	      P \xrightarrow{\sigma} P^{'}
	  }{
	      \underline{\overline{x}y}.P \xrightarrow{\overline{x}y \cdot \sigma} P^{'}
	  }$
	&
	  $\sigma$ is a non empty sequence of outputs
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{EComSeq}]{
	      P \xrightarrow{\overline{x}y\cdot \sigma} P^{'}
	    \\
	      Q\xrightarrow{xy} Q^{'}
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q^{'}
	  }$
	&
	  $\inferrule* [left=\bf{ECom}]{
	      P \xrightarrow{\overline{x}y} P^{'}
	    \\
	      Q\xrightarrow{xy} Q^{'}
	  }{
	    P|Q \xrightarrow{\tau} P^{'}|Q^{'}
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	  $\inferrule* [left=\bf{ParL}]{
	      P \xrightarrow{\sigma} P^{'}
% 	    \\
% 	      bn(\sigma)\cap fn(Q)=\emptyset	  
	  }{
	    P|Q \xrightarrow{\sigma} P^{'}|Q
	  }$
	&
	  $\inferrule* [left=\bf{ParR}]{
	      Q \xrightarrow{\sigma} Q^{'}
% 	    \\
% 	      bn(\sigma)\cap fn(P)=\emptyset	  
	  }{
	    P|Q \xrightarrow{\sigma} P|Q^{'}
	  }$
      \\\\
	  $\inferrule* [left=\bf{Res}]{
	      P \xrightarrow{\sigma} P^{'} 
	    \\
	      z\notin n(\sigma)
	  }{
	    (\nu z) P \xrightarrow{\sigma} (\nu z) P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{Ide}]{
	      A(\tilde{x}) \stackrel{def}{=} P
	    \\
	      P\{\tilde{y}/\tilde{x}\} \xrightarrow{\sigma} Q
	  }{
	      A \xrightarrow{\sigma} Q
	  }$

% 	  $\inferrule* [left=\bf{Cong}]{
% 	      P\equiv P^{'}
% 	    \\
% 	      P^{'} \xrightarrow{\sigma} Q
% 	  }{
% 	      P \xrightarrow{\sigma} Q
% 	  }$
      \\\\
	  $\inferrule* [left=\bf{SumL}]{
	    P \xrightarrow{\sigma} P^{'}
	  }{
	    P+Q \xrightarrow{\sigma} P^{'}
	  }$
	&
	  $\inferrule* [left=\bf{SumR}]{
	    Q \xrightarrow{\sigma} Q^{'}
	  }{
	    P+Q \xrightarrow{\sigma} Q^{'}
	  }$
%       \\
%     \end{tabular}
%       \\
%     \begin{tabular}{l}
%       \\	
% 	  $\inferrule* [left=\bf{Opn}]{
% 	      P\{z/y\} \xrightarrow{\sigma\{z/y\}} P^{'}
% 	    \\
% 	      y \in obj(\sigma)
% 	    \\
% 	      z \notin sbj(\sigma)
% 	  }{
% 	    (\nu z)P \xrightarrow{opn(\sigma, z, y)} P^{'}
% 	  }$
% 	  $\inferrule* [left=\bf{Opn}]{
% 	      P \xrightarrow{\sigma} P^{'}
% 	    \\
% 	      y \in obj(\sigma)
% 	    \\
% 	      y \notin sbj(\sigma)
% 	  }{
% 	    (\nu y)P \xrightarrow{opn(\sigma, y)} P^{'}
% 	  }$
%       \\
%     \end{tabular}
%       \\
%     \begin{tabular}{ll}
%       \\	
% 	  $\inferrule* [left=\bf{Cls}]{
% 	      P \xrightarrow{\overline{x}(z)} P^{'}
% 	    \\
% 	      Q \xrightarrow{xz} Q^{'}
% 	  }{
% 	      P|Q \xrightarrow{\tau} (\nu z)(P^{'}|Q^{'})
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{ClsSeq}]{
% 	      P \xrightarrow{\overline{x}(z) \cdot \sigma} P^{'}
% 	    \\
% 	      Q \xrightarrow{xz} Q^{'}
% 	  }{
% 	      P|Q \xrightarrow{\sigma} (\nu z)(P^{'}|Q^{'})
% 	  }$
%       \\
%     \end{tabular}
%       \\
%     \begin{tabular}{ll}
%       \\
% 	$opn(\overline{x}y, w)=\overline{x}y$
%       &
% 	$opn(\overline{x}y \cdot \sigma, w)=\overline{x}y \cdot opn(\sigma, w)$
%     \\
% 	$opn(\overline{x}w, w)=\overline{x}(w)$
%       &
% 	$opn(\overline{x}w \cdot \sigma, w)=\overline{x}(w) \cdot opn(\sigma, w)$
%     \\
      \\\\\hline
    \end{tabular}
    \caption{Multi$\pi$ early semantic without structural congruence}
    \label{multipioutearlywithout}
  \end{table}
  

\end{definition}

\begin{example} Scope extrusion with strong prefixing(1).
  $x\notin fn(y(z).Q|a(b).R|y(z).S)$. The following is the desired transition:
  \begin{center}
    $(\nu x)(\underline{\overline{y}x}.\underline{\overline{a}b}.\underline{\overline{y}x}.\overline{a}b.P)|y(z).Q|a(b).R|y(z).S|a(b).T 
      \xrightarrow{\tau} 
	(\nu x)(
	  P
	  | Q\{x/z\}
	  | S\{x/z\}
	)
	| R
	| T$
  \end{center}
  It is possible to infer this transition in the semantic with structural congruence. But without structural congruence and the following spoce extrusion rules
  \begin{center}
        \begin{tabular}{l}
      \\	
% 	  $\inferrule* [left=\bf{Opn}]{
% 	      P\{z/y\} \xrightarrow{\sigma\{z/y\}} P^{'}
% 	    \\
% 	      y \in obj(\sigma)
% 	    \\
% 	      z \notin sbj(\sigma)
% 	  }{
% 	    (\nu z)P \xrightarrow{opn(\sigma, z, y)} P^{'}
% 	  }$
	  $\inferrule* [left=\bf{Opn}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      y \in obj(\sigma)
	    \\
	      y \notin sbj(\sigma)
	  }{
	    (\nu y)P \xrightarrow{opn(\sigma, y)} P^{'}
	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\	
	  $\inferrule* [left=\bf{Cls}]{
	      P \xrightarrow{\overline{x}(z)} P^{'}
	    \\
	      Q \xrightarrow{xz} Q^{'}
	  }{
	      P|Q \xrightarrow{\tau} (\nu z)(P^{'}|Q^{'})
	  }$
	&
	  $\inferrule* [left=\bf{ClsSeq}]{
	      P \xrightarrow{\overline{x}(z) \cdot \sigma} P^{'}
	    \\
	      Q \xrightarrow{xz} Q^{'}
	  }{
	      P|Q \xrightarrow{\sigma} (\nu z)(P^{'}|Q^{'})
	  }$
      \\
    \end{tabular}
  \end{center}
  we can only infer 
  \begin{center}
    $(\nu x)(\underline{\overline{y}x}.\underline{\overline{a}b}.\underline{\overline{y}x}.\overline{a}b.P)|y(z).Q|a(b).R|y(z).S|a(b).T 
      \xrightarrow{\tau} 
	(\nu x)(
	  (\nu x)(
	    P
	    | Q\{x/z\}
	  )
	  | R
	  | S\{x/z\}
	)
	| T$
  \end{center}
  This transition is not what we want because now the scope of the inner $\nu x$ hides in $P$ the scope of the outer $\nu x$, so $P$ and $S$ cannot use $x$ to communicate. But whit these rules:
  \begin{center}
    \begin{tabular}{ll}
      \\	
% 	  $\inferrule* [left=\bf{Opn}]{
% 	      P\{z/y\} \xrightarrow{\sigma\{z/y\}} P^{'}
% 	    \\
% 	      y \in obj(\sigma)
% 	    \\
% 	      z \notin sbj(\sigma)
% 	  }{
% 	    (\nu z)P \xrightarrow{opn(\sigma, z, y)} P^{'}
% 	  }$
	  $\inferrule* [left=\bf{Opn}]{
	      P \xrightarrow{\sigma} P^{'}
	    \\
	      y \in obj(\sigma)
	    \\
	      y \notin sbj(\sigma)
	  }{
	    (\nu y)P \xrightarrow{opn(\sigma, y) (\nu y)} P^{'}
	  }$
	&
% 	\\\\
% 	  $\inferrule* [left=\bf{Cls}]{
% 	      P \xrightarrow{(\nu y)} Q
% 	  }{
% 	      P \xrightarrow{\tau} (\nu y)Q
% 	  }$
% 	&
% 	  $\inferrule* [left=\bf{ClsSeq}]{
% 	      P \xrightarrow{(\nu y) \cdot \sigma} Q
% 	  }{
% 	      P \xrightarrow{\sigma} (\nu y)Q
% 	  }$
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\	
	  $\inferrule* [left=\bf{Cls}]{
	      P \xrightarrow{\overline{x}(y) \cdot (\nu y)} P^{'}
	    \\
	      Q \xrightarrow{xy} Q^{'}
	  }{
	      P|Q \xrightarrow{\tau} (\nu y)(P^{'}|Q^{'})
	  }$
	&
	  $\inferrule* [left=\bf{ClsSeq1}]{
	      P \xrightarrow{\overline{x}(y) \cdot (\nu y) \cdot \sigma} P^{'}
	    \\
	      Q \xrightarrow{xy} Q^{'}
	  }{
	      P|Q \xrightarrow{\sigma} (\nu y)(P^{'}|Q^{'})
	  }$
      \\
	  $\inferrule* [left=\bf{ClsSeq2}]{
	      P \xrightarrow{\overline{x}(y) \cdot \sigma} P^{'}
	    \\
	      Q \xrightarrow{xy} Q^{'}
	  }{
	      P|Q \xrightarrow{\sigma} P^{'}|Q^{'}
	  }$
	&
	  $\sigma$ does not start with $\nu $
      \\
    \end{tabular}
      \\
    \begin{tabular}{ll}
      \\
	$opn(\overline{x}y, y)=\overline{x}(y) \cdot (\nu y)$
	&
	$opn(\overline{x}y \cdot \sigma, y)= \left\{\begin{array}{ll}
	  \overline{x}(y)  \cdot opn(\sigma, y) & if\; y\in obj(\sigma)
	\\
	  \overline{x}(y) \cdot (\nu y) \cdot opn(\sigma, y) & if\; y\notin obj(\sigma)
	\end{array}\right.$
      \\
	$opn(\overline{x}z, y)=\overline{x}z$
	&
	$opn(\overline{x}z \cdot \sigma, y)=\overline{x}z \cdot opn(\sigma, y)$
      \\
	$opn((\nu z), y)=(\nu z)$
	&
	$opn((\nu z) \cdot \sigma, y)=(\nu z) \cdot opn(\sigma, y)$
      \\
    \end{tabular}
  \end{center}
  The following transition can be inferred:
  \begin{center}
    $(\nu x)(\underline{\overline{y}x}.\underline{\overline{a}b}.\underline{\overline{y}x}.\overline{a}b.P)
      | y(z).Q
      | a(b).R
      | y(z).S
      | a(b).T 
      \xrightarrow{\tau} 
	(\nu x)(
	  P
	  | Q\{x/z\}
	  | R
	  | S\{x/z\}
	)
	| T$
  \end{center}
\end{example}

\begin{example} Scope intrusion without strong prefixing.
  \begin{center}
    $\overline{y}x.P|(\nu x)(y(z).Q) \xrightarrow{\tau} P|(\nu w)(Q\{w/x\}\{x/z\})$
  \end{center}
  This transition cannot be derived without $alpha$ conversion.
\end{example}

\begin{example} Scope extrusion without strong prefixing.
  \begin{center}
  $
    \inferrule* [left=\bf{Cls}]{
      \inferrule* [left=\bf{Opn}]{
	\inferrule* [left=\bf{Out}]{
	}{
	  \overline{y}x.P
	    \xrightarrow{\overline{y}x} 
	      P
	}
      }{
	(\nu x)(\overline{y}x.P)
	  \xrightarrow{\overline{y}(x) (\nu x)} 
	    P
      }
      \\
      \inferrule* [left=\bf{EInp}]{
	x\notin (fn(Q)-\{z\})
      }{
	y(z).Q 
	  \xrightarrow{yx} 
	    Q\{x/z\}
      }
  }{
    (\nu x)(\overline{y}x.P)|y(z).Q 
	\xrightarrow{\tau} 
	  (\nu x)(P|Q\{x/z\})
  }$
  \end{center}
\end{example}


\begin{example} Scope extrusion with strong prefixing(2).
  $x\in fn(y(z).Q|a(b).R|y(z).S)$ and  $x^{'}\notin fn(y(z).Q|a(b).R|y(z).S)$
  \begin{center}
    $(\nu x)(\underline{\overline{y}x}.\underline{\overline{a}b}.\underline{\overline{y}x}.\overline{a}b.P)|y(z).Q|a(b).R|y(z).S|a(b).T \xrightarrow{\tau} 
      (\nu x^{'})(P\{x^{'}/x\}|Q\{x^{'}/z\}|R|S\{x^{'}/z\})|T
    $
  \end{center}
  This transition cannot be derived without $\alpha$ conversion.
\end{example}


\begin{example} Scope intrusion with strong prefixing.
  \begin{center}
    $\underline{\overline{y}x}.\overline{a}b.P|(\nu x)(y(z).Q)|(\nu b)(a(c).R) \xrightarrow{\tau} P|(\nu w)(Q\{w/x\}\{x/z\})|(\nu d)(R\{d/b\}\{b/c\})$
  \end{center}
  This transition cannot be derived without $\alpha$ conversion.
\end{example}

% It is now natural to ask what the semantic of
% \begin{center}
%   $\underline{\overline{x}y}.(\nu x) \overline{y}x.P | (\nu y)x(z).Q | y(w).R$
% \end{center}
% should be

% \begin{example}Multi-party synchronization. 
%   We show an example of a derivation of three processes that synchronize in the late semantic.
% \begin{center}
% $\inferrule* [left=\bf{Res}]{
%     x\notin n(\tau)
%    \\
%     \inferrule* [left=\bf{LComSeq}]{
% 	  \underline{\overline{x}y}.\overline{x}y.0|x(y).0
% 	    \xrightarrow{\overline{x}y}
% 	      0|0
%       \\
% 	\inferrule* [left=\bf{Pref}]{
% 	}{
% 	  x(y).0	
% 	    \xrightarrow{x(y)} 
% 	      0
% 	}
%     }{
%       ((\underline{\overline{x}y}.\overline{x}y.0|x(y).0)|x(y).0)
% 	\xrightarrow{\tau}
% 	  ((0|0)|0)
%     }
%   }{
%     (\nu x)((\underline{\overline{x}y}.\overline{x}y.0|x(y).0)|x(y).0)
%       \xrightarrow{\tau}
% 	(\nu x)((0|0)|0)
% }$
% \end{center}
% 
% \begin{center}
% $\inferrule* [left=\bf{LComSng}]{
%   \inferrule* [left=\bf{SOut}]{
%     \inferrule* [left=\bf{Pref}]{
%     }{
%       \overline{x}y.0
% 	\xrightarrow{\overline{x}y}
% 	  0
%     }
%   }{
%     \underline{\overline{x}y}.\overline{x}y.0
%       \xrightarrow{\overline{x}y\cdot \overline{x}y}
% 	0
%   }
%   \\
%     \inferrule* [left=\bf{Pref}]{
%     }{
%       x(y).0 \xrightarrow{x(y)} 0
%     }
% }{
%   \underline{\overline{x}y}.\overline{x}y.0|x(y).0
%     \xrightarrow{\overline{x}y}
%       0|0
% }$
% \end{center}
% 
% \end{example}



\section{Strong bisimilarity and equivalence}
\subsection{Strong bisimilarity}

In the following section, $\rightarrow$ is the transition relation defined in table \ref{multipioutearlywithout}.

\begin{definition}\label{strongEarlyBisimulation}
  A \emph{strong early bisimulation} is a simmetric binary relation $\mathbf{S}$ on multi $\pi$ processes such that for all $P$ and $Q$: $P \mathbf{S} Q$, $P \xrightarrow{\gamma} P^{'}$ and $bn(\gamma)$ is fresh imply that
  \begin{center}
    $\exists Q^{'}:$ $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'}\mathbf{S} Q^{'}$
  \end{center}
  The \emph{strong early bisimilarity}, written $\dot{\sim}_{E}$, is the union of all strong early bisimulation. Two processes $P,Q$ are \emph{strong early bisimilar}, written $P \dot{\sim}_{E} Q$, if they are related by the strong early bisimilarity.
\end{definition}

\begin{proposition}
  The strong early bisimilarity is a strong early bisimulation.
\end{proposition}

\begin{proposition}
  $\dot{\sim}_{E}$ is an equivalence relation.
  \begin{proof}:
    \begin{description}
      \item[Reflexivity]
	The identity relation on processes is a strong early bisimulation.
      \item[Simmetry]
	It is in the definition.
      \item[Transitivity]
	The composition $\dot{\sim}_{E} \dot{\sim}_{E}$ is a strong early bisimulation.
    \end{description}
  \end{proof}
\end{proposition}


\begin{definition}\label{strongEarlyBisimulationUpTo}
  A \emph{strong early bisimulation up to $\dot{\sim}_{E}$} is a simmetric binary relation $\mathbf{S}$ on multi $\pi$ processes such that for all $P$ and $Q$: $P \mathbf{S} Q$, $P \xrightarrow{\gamma} P^{'}$ and $bn(\gamma)$ is fresh imply that
  \begin{center}
    $\exists P^{''},Q^{'},Q^{''}:$ $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'} \dot{\sim}_{E} P^{''} \mathbf{S} Q^{''} \dot{\sim}_{E} Q^{'} $
  \end{center}
  Two processes $P,Q$ are \emph{strong early bisimilar up to $\dot{\sim}_{E}$}, written $P \dot{\sim}_{E}^{up} Q$, if they are related by a strong early bisimulation up to $\dot{\sim}_{E}$.
\end{definition}

\begin{proposition}
  $P \dot{\sim}_{E}^{up} Q$ imply $P \dot{\sim}_{E} Q$.
  \begin{proof}
    Let $\mathbf{S}$ be a bisimulation up to $\dot{\sim}_{E}$ such that $P \mathbf{S} Q$. It can be proved that $\dot{\sim}_{E} \mathbf{S} \dot{\sim}_{E}$ is a bisimulation: let $A \dot{\sim}_{E} B \mathbf{S} C \dot{\sim}_{E} D$
    \begin{center}
      \begin{tabular}{l}
	$A \xrightarrow{\gamma} A^{'}$ $\wedge$ $A \dot{\sim}_{E} B$ $\wedge$ definition \ref{strongEarlyBisimulation} 
      
	$\Rightarrow \exists B^{'}:$ $B \xrightarrow{\gamma} B^{'}$ $\wedge$ $A^{'}\dot{\sim}_{E} B^{'}$
      \\
	$B \mathbf{S} C$ $\wedge$ definition \ref{strongEarlyBisimulationUpTo}
      
	$\Rightarrow \exists C^{'} C^{''} B^{''}:$ $C \xrightarrow{\gamma} C^{'}$ $\wedge$ $B^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} C^{'}$
      \\
	$C \xrightarrow{\gamma} C^{'}$ $\wedge$ $C \dot{\sim}_{E} D$ $\wedge$ definition \ref{strongEarlyBisimulation} 
      
	$\Rightarrow \exists D^{'}:$ $D \xrightarrow{\gamma} D^{'}$ $\wedge$ $C^{'}\mathbf{S} D^{'}$
      \\
	$A^{'} \dot{\sim}_{E} B^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} C^{'} \dot{\sim}_{E} D^{'}$ $\wedge$ transitivity of $\dot{\sim}_{E}$
	$\Rightarrow$ $A^{'} \dot{\sim}_{E} B^{''} \mathbf{S} C^{''} \dot{\sim}_{E} D^{'}$
      \end{tabular}
    \end{center}
    It is easy to see that the simmetric also holds.
  \end{proof}
\end{proposition}


\begin{proposition}
  $\equiv_{\alpha}$ is a strong bisimulation.
  \begin{proof}
    We prove that if $P \equiv_{\alpha} Q$ and $P \xrightarrow{\gamma} P^{'}$ then $Q \xrightarrow{\gamma} Q^{'}$ and $P^{'}\equiv_{\alpha} Q^{'}$. The simmetric holds because $\alpha$ equivalence is simmetric. The proof proceed by induction on the derivation of $P \xrightarrow{\gamma} P^{'}$. The last rule used can be:
    \begin{description}
      \item[Out]:
	$P$ is $\overline{x}y.P_{1}$ and $\gamma$ is $\overline{x}y$ for some names $x,y$ and process $P_{1}$. $P \equiv_{\alpha} Q$ and the inversion lemma for $\alpha$ equivalence imply $Q$ is $\overline{x}y.Q_{1}$ and $P_{1}\equiv_{\alpha}Q_{1}$ for a process $Q_{1}$. Rule $Out$ proves $\overline{x}y.Q_{1} \xrightarrow{\overline{x}y} Q_{1}$
      \item[EInp]:
	$P$ is $x(y).P_{1}$ and $\gamma$ is $xz$ for some names $x,y,z$ and process $P_{1}$ such that $z\notin (fn(P_{1})-\{y\})$.
	$P \equiv_{\alpha} Q$ and the inversion lemma for $\alpha$ equivalence imply $Q$ is $x(w).Q_{1}$ and $P_{1}\equiv_{\alpha}Q_{1}\{y/w\}$ for a process $Q_{1}$ such that $y\notin fn(Q_{1})$ and a name $w$ which is not necessarily different from $y$. Rule $EInp$ proves $x(w).Q_{1} \xrightarrow{xz} Q_{1}$
      \item[Res]: similar to the previous case.
      \item[Tau]:
	$P$ is $\tau.P_{1}$ and $\gamma$ is $\tau$ for some process $P_{1}$. $P \equiv_{\alpha} Q$ and the inversion lemma for $\alpha$ equivalence imply $Q$ is $\tau.Q_{1}$ and $P_{1}\equiv_{\alpha}Q_{1}$ for a process $Q_{1}$. Rule $Tau$ proves $\tau.Q_{1} \xrightarrow{\tau} Q_{1}$
      \item[SOut]:
	$P$ is $\underline{\overline{x}y}.P_{1}$ and $\gamma$ is $\overline{x}y \cdot \gamma^{'}$ for some names $x,y$, process $P_{1}$ and a non empty sequence of outputs $\gamma^{'}$. $P \equiv_{\alpha} Q$ and the inversion lemma for $\alpha$ equivalence imply $Q$ is $\underline{\overline{x}y}.Q_{1}$ and $P_{1}\equiv_{\alpha}Q_{1}$ for a process $Q_{1}$. The premise is $P_{1} \xrightarrow{\gamma^{'}} P_{1}^{'}$, for inductive hypothesis $Q_{1} \xrightarrow{\gamma^{'}} Q_{1}^{'}$ and $P_{1}^{'} \equiv_{\alpha} Q_{1}^{'}$. Rule $SOut$ proves $\underline{\overline{x}y}.Q_{1} \xrightarrow{\overline{x}y \cdot \gamma^{'}} Q_{1}$
%       \item[EComSeq]:
% 	\begin{center}
% 	  $\inferrule* {
% 	      P_{1} \xrightarrow{xy} P_{1}^{'}
% 	    \\
% 	      P_{2}\xrightarrow{\overline{x}y\cdot \sigma} P_{2}^{'}
% 	  }{
% 	    \underbrace{P_{1}|P_{2}}_{P} \xrightarrow{\sigma} \underbrace{P_{1}^{'}|P_{2}^{'}}_{P^{'}}
% 	  }$
% 	\end{center}
% 	The conclusion follows for inversion lemma of $\alpha$ conversion, inductive hypothesis and rule $EComSeq$
      \item[EComSeq, ECom, ParL, ParR, SumL, SumR, Ide]: similar to the previous case.
      \item[Opn]:
      \item[Cls]:
      \item[ClsSeq1]:
      \item[ClsSeq2]:
    \end{description}
  \end{proof}
\end{proposition}


\begin{proposition}
  $\dot{\sim}_{E}$ is preserved by all operators except input prefixing.
  \begin{proof}
    The proof goes by cases on operators:
    \begin{description}
      \item[Output prefixing]
	The relation $\{(\overline{x}y.P, \overline{x}y.Q): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation.
      \item[Strong output prefixing]
	The relation $\{(\underline{\overline{x}y}.P, \underline{\overline{x}y}.Q): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation.
      \item[Tau prefixing]
	The relation $\{(\tau.P, \tau.Q): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation.
      \item[Summation]
	The relation $\{(P+R, Q+R): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation.
      \item[Restriction]
	The relation $\{((\nu x)P, (\nu x)Q): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation.
      \item[Parallel composition]
	The relation $\{(P|R, Q|R): P\dot{\sim}_{E} Q\} \cup \dot{\sim}_{E}$ is a strong early bisimulation. The last rule applicable to $P|R$ can be:
	\begin{description}
	  \item[ECom]:
	    \begin{center}
	      $\inferrule* {
		  P \xrightarrow{\overline{x}y} P^{'}
		\\
		  R \xrightarrow{xy} R^{'}
	      }{
		P|R \xrightarrow{\tau} P^{'}|R^{'}
	      }$
	    \end{center}
	    $P \xrightarrow{\overline{x}y} P^{'}$ and $P\dot{\sim}_{E} Q$ imply that there exists a process $Q^{'}$ such that $Q \xrightarrow{\overline{x}y} Q^{'}$ and $P^{'}\dot{\sim}_{E} Q^{'}$. So for rule $ECom$: $Q|R \xrightarrow{\tau} Q^{'}|R^{'}$ and $P^{'}|R^{'}\dot{\sim}_{E} Q^{'}|R^{'}$
	  \item[Cls]:
	    \begin{center}
	      $\inferrule* {
		  P \xrightarrow{\overline{x}(y) \cdot (\nu y)} P^{'}
		\\
		  R \xrightarrow{xy} R^{'}
	      }{
		P|R \xrightarrow{\tau} (\nu y)(P^{'}|R^{'})
	      }$
	    \end{center}
	    $P \xrightarrow{\overline{x}(y) \cdot (\nu y)} P^{'}$ and $P\dot{\sim}_{E} Q$ imply that there exists a process $Q^{'}$ such that $Q \xrightarrow{\overline{x}y \cdot (\nu y)} Q^{'}$ and $P^{'}\dot{\sim}_{E} Q^{'}$. So for rule $Cls$: $Q|R \xrightarrow{\tau} (\nu y)(Q^{'}|R^{'})$ and $(\nu y)(P^{'}|R^{'}) \dot{\sim}_{E} (\nu y)(Q^{'}|R^{'})$
	  \item[EComSeq1, EComSeq2, ParL, ParR] similar.
	\end{description}
    \end{description}
  \end{proof}
\end{proposition}



